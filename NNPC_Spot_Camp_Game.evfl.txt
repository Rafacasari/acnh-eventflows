flow CheckTool():
    switch MainNpc.CheckCamperNpcHandheldItem():
        case 0:
            System.EventFlags['cPlayerTemp:CampSetTool'] = 1
        case 1:
            System.EventFlags['cPlayerTemp:CampSetTool'] = 2
        case 2:
            System.EventFlags['cPlayerTemp:CampSetTool'] = 3
        case 3:
            System.EventFlags['cPlayerTemp:CampSetTool'] = 4
        case 4:
            System.EventFlags['cPlayerTemp:CampSetTool'] = 5
        case 5:
            System.EventFlags['cPlayerTemp:CampSetTool'] = 6

flow Game01_Begin():
    EventFlowSystemActor.SystemDecideFaceCard('cSelectType')
    MainNpc.CharacterEmoticonAction('NpcHoldout', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    EventFlowSystemActor.UIMiniGameHighAndLowHandling('cFaceCardStart')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:101', false)
    switch EventFlowSystemActor.GeneralTalkChoice4():
        case 0, 1, 2, 3:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:005', false)
            EventFlowSystemActor.UIMiniGameHighAndLowHandling('cFaceCardOpen')
            if EventFlowSystemActor.SystemIsCorrectFaceCard():
                EventFlowSystemActor.SoundTriggerEmit('Success_Level3', -1)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:102_01', false)
                run Game_SucessEnd()
            else:
                EventFlowSystemActor.SoundTriggerEmit('Fail', -1)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:102_02', false)
                run Game_FailEnd()

flow Game02_Begin():
    EventFlowSystemActor.SystemDecideFaceCard('cSelectColor')
    MainNpc.CharacterEmoticonAction('NpcHoldout', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    EventFlowSystemActor.UIMiniGameHighAndLowHandling('cFaceCardStart')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:201', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:005', false)
        EventFlowSystemActor.UIMiniGameHighAndLowHandling('cFaceCardOpen')
        if EventFlowSystemActor.SystemIsCorrectFaceCard():
            EventFlowSystemActor.SoundTriggerEmit('Success_Level3', -1)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:202_01', false)
            run Game_SucessEnd()
        else:
            EventFlowSystemActor.SoundTriggerEmit('Fail', -1)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:202_02', false)
            run Game_FailEnd()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:005', false)
        EventFlowSystemActor.UIMiniGameHighAndLowHandling('cFaceCardOpen')
        if EventFlowSystemActor.SystemIsCorrectFaceCard():
            EventFlowSystemActor.SoundTriggerEmit('Success_Level3', -1)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:202_03', false)
            run Game_SucessEnd()
        else:
            EventFlowSystemActor.SoundTriggerEmit('Fail', -1)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:202_04', false)
            run Game_FailEnd()

flow Game_FailEnd():
    if System.EventFlags['cPlayerTemp:CampInviteInProgress']:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Invite:204', false)
        EventFlowSystemActor.UIMiniGameHighAndLowHandling('cGameEnd')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Invite:205', false)
        System.EventFlags['cPlayerTemp:CampInviteInProgress'] = false
        System.EventFlags['cPlayerTemp:CampInviteRejected'] = true
        run SetTool()
    else:
        System.EventFlags['cPlayer:CampGameClear'] += 1
        EventFlowSystemActor.UIMiniGameHighAndLowHandling('cGameEnd')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:006_03', false)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:007_03', false)
        run SetTool()

flow Game_SucessEnd():
    if System.EventFlags['cPlayerTemp:CampInviteInProgress']:
        EventFlowSystemActor.UIMiniGameHighAndLowHandling('cGameEnd')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Invite:206', true)
        EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
        EventFlowSystemActor.WaitFrame(60)
        EventFlowSystemActor.FadeIn(true)
        if EventFlowSystemActor.NpcHouseNum('cSold') < 10:
            run NNPC_Spot_Camp_Invite::CheckOffice()
        else:
            if EventFlowSystemActor.NpcHouseNum('cAbandonedHouse') < 1:
                run NNPC_Spot_Camp_Invite::CheckOffice_Move()
            else:
                run NNPC_Spot_Camp_Invite::CheckOffice_EmptyHouse()
        System.EventFlags['cPlayerTemp:CampInviteInProgress'] = false
        run SetTool()
    else:
        MainNpc.SetDeliveryItem(1, true)
        System.EventFlags['cPlayer:CampGameClear'] += 1
        if System.EventFlags['cPlayerTemp:CampGameHitRare']:
            System.EventFlags['cPlayer:CampGameGetRare'] = true
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:006_02', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:006_01', false)
        EventFlowSystemActor.UIMiniGameHighAndLowHandling('cGameEnd')
        MainNpc.NpcDelivery(1, 'Default')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:007_01', false)
        run SetTool()

flow Root():
    run CheckTool()
    if System.EventFlags['cPlayerTemp:CampInviteInProgress']:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Invite:203_01', true)
        MainNpc.NpcChangeHandTool(65534, 'cPutAway', false)
        MainNpc.CharacterEmoticonAction('NpcShuffle', true, '', 0, false)
        EventFlowSystemActor.WaitFrame(30)
        if EventFlowSystemActor.RandomChoice2(2) == 0:
            run Game01_Begin()
        else:
            run Game02_Begin()
    else:
        System.EventFlags['cPlayerTemp:CampGameHitRare'] = false
        if (not System.EventFlags['cPlayer:CampGameGetRare']) and (EventFlowSystemActor.PercentChoice(50)):
            System.EventFlags['cPlayerTemp:CampGameHitRare'] = true
            EventFlowSystemActor.SelectRewardItemCampGame('cVeryGood')
        else:
            EventFlowSystemActor.SelectRewardItemCampGame('cNormal')
        MainNpc.SetItemName(1, 0, 0)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:001', false)
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:003', false)
        elif EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:002', false)
            System.EventFlags['cPlayerTemp:CampGameStartFailed'] = false
            MainNpc.NpcChangeHandTool(65534, 'cPutAway', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                if EventFlowSystemActor.RandomChoice2(2) == 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:100', false)
                    run Game01_Begin()
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:200', false)
                    run Game02_Begin()
            elif EventFlowSystemActor.RandomChoice2(2) == 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:004', false)
                run Game01_Begin()
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:004', false)
                run Game02_Begin()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Game:008', false)
            System.EventFlags['cPlayerTemp:CampGameStartFailed'] = true

flow SetTool():
    MainNpc.MessageSuspend()
    if System.EventFlags['cPlayerTemp:CampSetTool'] == 1:
        MainNpc.NpcChangeHandTool(7756, 'cNone', false)
    elif System.EventFlags['cPlayerTemp:CampSetTool'] == 2:
        MainNpc.NpcChangeHandTool(7397, 'cNone', false)
    elif System.EventFlags['cPlayerTemp:CampSetTool'] == 3:
        MainNpc.NpcChangeHandTool(7398, 'cNone', false)
    elif System.EventFlags['cPlayerTemp:CampSetTool'] == 4:
        MainNpc.NpcChangeHandTool(7399, 'cNone', false)
    elif System.EventFlags['cPlayerTemp:CampSetTool'] == 5:
        MainNpc.NpcChangeHandTool(7669, 'cNone', false)
    elif System.EventFlags['cPlayerTemp:CampSetTool'] == 6:
        MainNpc.NpcChangeHandTool(4388, 'cNone', false)

