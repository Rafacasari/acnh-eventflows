flow AirPort():
    EventFlowSystemActor.CameraSetDemoParam('Cut0', 'cDefault', 'CameraTag:Root', false, false, false, 0)
    EventFlowSystemActor.WaitFrame(20)
    EventFlowSystemActor.OpenVillageGate(true)
    Player.PlayerMoveToTarget(false, 160.0, 125.0, 0.0, 0.0, false, 'cAutoWait')
    Npc_1.TurnNeck(11, false)
    fork:
        branch:
            Player.PlayerMoveToTarget(false, 215.0, 125.0, 0.0, 0.0, false, 'cAutoWait')
        branch:
            EventFlowSystemActor.WaitFrame(30)
            MainNpc.NpcRailMove(0, true, false, -1, -1, 1)
    fork:
        branch:
            Npc_1.TurnBody(0, 0.0)
        branch:
            MainNpc.TurnBody(1, 0.0)
    EventFlowSystemActor.WaitFrame(25)
    fork:
        branch:
            Npc_1.CharacterEmoticonAction('DodRoger', true, '', 0, false)
        branch:
            MainNpc.CharacterEmoticonAction('DodRoger', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(20)
    EventFlowSystemActor.BGMPropertyControl(143)
    EventFlowSystemActor.SoundTriggerEmit('Airplane_Takeoff', -1)
    EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:ChocolateDemo', '', false)
    EventFlowSystemActor.SystemRequestChangeStage('cWherearenGrowUp', 'cDALWherearenWithLoadWait', 'cCircle', 'cBlack', 1.0, 1.0)

flow AirPort_Init():
    MainNpc.NpcAITalkSubCastEntry('dod', 1)

flow Check_Mnc():
    if (System.EventFlags['cWherearenPlayer:MncMovetoBridge']) and ((not System.EventFlags['cWherearenPlayer:SeqDIYCatalogOngoing']) or (System.EventFlags['cWherearenPlayer:SeqMncTalkDIYCatalog'])):
        SubflowResults[0] = 1

flow Chocolate():
    MainNpc.NpcAddFriendship(1)
    MainNpc.EventFlags['cNpcMemory:IsReceiptWrappingItem'] = true
    EventFlowSystemActor.SystemDeletePlayerItem('cItemWindowSub', 1)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:601', false)
    MainNpc.NpcDelivery(3, '"Default"')
    if not EventFlowSystemActor.IsWherearenAocAvailable():
        run NoVisit()
    elif EventFlowSystemActor.NetIsConnected():
        run NoVisit()
    elif EventFlowSystemActor.IsSharePlay(0):
        run NoVisit()
    elif not EventFlowSystemActor.SaveHasWherearenIslands():
        run NoVisit()
    elif not System.EventFlags['cWherearenPlayer:TutorialDone']:
        run NoVisit()
    elif MainNpc.WherearenIsSuspendedNpc():
        run NoVisit()
    elif EventFlowSystemActor.PlayerHouseLevel() == `Homeless`:
        run NoVisit()
    elif (System.EventFlags['cLand:VillageDaysCount'] < 1) and (not System.EventFlags['cLand:IslandProducedByPlayerMoving']):
        run NoVisit()
    elif MainNpc.WherearenIsBuiltNpc():
        if System.EventFlags['cWherearenPlayer:Unlock_MncBridgeBoat']:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:601_02', false)
            run Sub_grp_Event4()
        else:
            run NoVisit()
    elif MainNpc.EventFlags['cNpcMemory:WHEREAREN_VisitWherearenWithPlayer']:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:601_04', false)
        run Sub_grp_Event4()
    else:
        if MainNpc.EventFlags['cNpcMemory:WHEREAREN_GetChocolate']:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:601_05', false)
        else:
            MainNpc.EventFlags['cNpcMemory:WHEREAREN_GetChocolate'] = true
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:601_01', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:602_01', true)
            run Sub_Event31()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:603_01', false)

flow KeepFaderOff_Wherearen():
    EventFlowSystemActor.SetChocolateDemoWherearenScene()
    EventFlowSystemActor.WaitFrame(30)
    EventFlowSystemActor.SystemFaderRelease()

flow NoVisit():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:601_03', false)

local flow Sub_Event31():
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.SetChocolateDemoNpc()
    System.EventFlags['cPlayerTemp:WHEREAREN_ChocolateDemoReserve'] = true
    System.EventFlags['cPlayerTemp:WHEREAREN_DocMainEreaFirstTalkDone'] = true
    System.EventFlags['cPlayer:EquipLicenseHelmet'] = false
    EventFlowSystemActor.StartMeasurePlayTime('cWherearenIslands')
    EventFlowSystemActor.SystemRequestChangeStage('cChocolateDemoAirPort', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)

local flow Sub_grp_Event125():
    if SubflowResults@2[0] == 0:
        EventFlowSystemActor.StoreNormalCamera(false, '')
    else:
        System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_Bridge'] = true

local flow Sub_grp_Event4():
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:602', true)
        run Sub_Event31()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Select/BO_Select_Present:603', false)

flow WherearenDemo():
    run Check_Mnc()
    MainNpc.TurnNeck(11, false)
    if SubflowResults@2[0] != 0:
        Npc_2.TurnNeck(0, false)
    if (not MainNpc.WherearenIsBuiltNpc()) and (not MainNpc.EventFlags['cNpcMemory:WHEREAREN_VisitWherearenWithPlayer']):
        MainNpc.EventFlags['cNpcMemory:WHEREAREN_VisitWherearenWithPlayer'] = true
        if SubflowResults@2[0] != 0:
            Npc_2.CharacterEmoticonAction('Smiling', true, '', 0, false)
        MainNpc.NpcStartAS('NpcFascinatedVisit', false, true)
        EventFlowSystemActor.WaitFrame(30)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:301', true)
        MainNpc.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
        MainNpc.TurnBody(10, 0.0)
        MainNpc.NpcWaitTurn()
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:302', true)
        MainNpc.TurnNeck(11, false)
    else:
        if SubflowResults@2[0] != 0:
            Npc_2.CharacterEmoticonAction('Smiling', true, '', 0, false)
        MainNpc.NpcStartAS('NpcFascinatedVisit', false, true)
        EventFlowSystemActor.WaitFrame(30)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:303', false)
        MainNpc.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
        MainNpc.TurnBody(10, 0.0)
        MainNpc.NpcWaitTurn()
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:304', false)
        MainNpc.TurnNeck(11, false)
    System.EventFlags['cPlayerTemp:WHEREAREN_ChocolateDemoReserve'] = false
    System.EventFlags['cWherearenPlayer:ChocolateDemoEnd'] = true
    System.EventFlags['cWherearenPlayer:IsChocolateDemoRun'] = true
    EventFlowSystemActor.ResetChocolateDemoHeadCtrlBeforeTalk()
    if MainNpc.IsExistNpcInWherearenFacility():
        MainNpc.MessageSuspend()
        fork:
            branch:
                EventFlowSystemActor.WaitFrame(60)
                EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, false)
            branch:
                MainNpc.NpcMoveDirection(180.0, 100.0, 1, false, false)
        MainNpc.NpcSetVisibleAction(false)
        run `00_Demo_Fade`::FadeIn_Cmn(IsWait=true)
        run Sub_grp_Event125()
    else:
        run Sub_grp_Event125()

flow WherearenDemo_Init():
    MainNpc.NpcAITalkSubCastEntry('doc', 1)
    if (System.EventFlags['cWherearenPlayer:MncMovetoBridge']) and ((not System.EventFlags['cWherearenPlayer:SeqDIYCatalogOngoing']) or (System.EventFlags['cWherearenPlayer:SeqMncTalkDIYCatalog'])):
        MainNpc.NpcAITalkSubCastEntry('mnc', 2)

