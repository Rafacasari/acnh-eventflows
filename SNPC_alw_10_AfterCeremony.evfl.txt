flow AfterRemakeCeremony():
    run SNPC_alw_01_Studio::Alw_DayChk()
    MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:100', false)
    run SNPC_alw_01_Studio::Alw_AfterClear_Flag()
    run SNPC_alw_01_Studio::Alw_GetItem()
    run SNPC_alw_01_Studio::Alw_ThanksMsg()
    System.EventFlags['cLandTemp:RemakeJuneBrideTalkTimeAfterNow'] = false

flow Get_Dish():
    MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:101', false)
    EventFlowSystemActor.SelectRewardItemDirect(12565, 1, 'cVillageRemakePattern', 0)
    if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
        MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:102_01', false)
        MainNpc.SetDeliveryItem(1, true)
        MainNpc.NpcDelivery(1, 'Default')
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:102_02', false)
        EventFlowSystemActor.SystemMailSend('cAlw_Alp', 'MAIL_SNpc_alw_JuneBride', 5, 'cNone', 'cFastTomorrow', 'cReward', false, false)
    MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:103', false)
    SubNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:104', false)
    MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:105', true)
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        fork:
            branch:
                MainNpc.TurnBody(2, 0.0)
                MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:106', false)
            branch:
                EventFlowSystemActor@alp.WaitFrame(5)
                SubNpc.TurnBody(2, 0.0)
            branch:
                EventFlowSystemActor@spn.WaitFrame(25)
                Npc_2.TurnBody(0, 0.0)
            branch:
                EventFlowSystemActor@poo.WaitFrame(30)
                Npc_3.TurnBody(0, 0.0)
            branch:
                EventFlowSystemActor@p.WaitFrame(30)
                Player.TurnBody(2, 0.0)
        run Sub_Event19()
    else:
        fork:
            branch:
                MainNpc.TurnBody(2, 0.0)
                MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:106', false)
            branch:
                EventFlowSystemActor@alp.WaitFrame(5)
                SubNpc.TurnBody(2, 0.0)
            branch:
                EventFlowSystemActor@spn.WaitFrame(25)
                Npc_2.TurnBody(0, 0.0)
            branch:
                EventFlowSystemActor@p.WaitFrame(30)
                Player.TurnBody(2, 0.0)
        run Sub_Event19()

flow Root():
    run SNPC_alw_01_Studio::Alw_DayChk()
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        fork:
            branch:
                MainNpc.TurnBody(10, 0.0)
                MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
            branch:
                SubNpc.TurnBody(10, 0.0)
                SubNpc.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
            branch:
                Npc_2.TurnBody(10, 0.0)
                Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
            branch:
                Npc_3.TurnBody(10, 0.0)
                Npc_3.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
        run Sub_Event67()
    else:
        fork:
            branch:
                MainNpc.TurnBody(10, 0.0)
                MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
            branch:
                SubNpc.TurnBody(10, 0.0)
                SubNpc.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
            branch:
                Npc_2.TurnBody(10, 0.0)
                Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
        run Sub_Event67()

flow Root_Init():
    MainNpc.NpcAITalkSubCastEntry('alp', 1)
    MainNpc.NpcAITalkSubCastEntry('spn', 2)
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        MainNpc.NpcAITalkSubCastEntry('pooB', 3)

local flow Sub_Event0():
    run SNPC_alw_01_Studio::Alw_GetItem()
    System.EventFlags['cPlayer:AlwJuneBrideQuestClearFlag'] = true
    run Get_Dish()
    EventFlowSystemActor.SystemRequestChangeStage('cPhotoStudioIslandHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)

local flow Sub_Event19():
    Npc_2.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:107', true)
    EventFlowSystemActor.WaitFrame(5)
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        fork:
            branch:
                MainNpc.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@alp.WaitFrame(5)
                SubNpc.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@spn.WaitFrame(7)
                Npc_2.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@poo.WaitFrame(7)
                Npc_3.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@p.WaitFrame(7)
                Player.TurnBody(0, 0.0)
        run Sub_grp_Event23()
    else:
        fork:
            branch:
                MainNpc.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@alp.WaitFrame(5)
                SubNpc.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@spn.WaitFrame(7)
                Npc_2.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@p.WaitFrame(7)
                Player.TurnBody(0, 0.0)
        run Sub_grp_Event23()

local flow Sub_Event67():
    EventFlowSystemActor.BGMPropertyControl(91)
    EventFlowSystemActor.CameraSetDemoParam('DemoJB_Cut2', 'cDefault', 'Npc:alw', false, false, false, 0)
    System.EventFlags['cLandTemp:JuneBrideCeremonyDemoAfterNow'] = false
    MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:100', false)
    run SNPC_alw_01_Studio::Alw_AfterClear_Flag()
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        fork:
            branch:
                Npc_2.CharacterEmoticonAction('EmotEnd', true, '', 60, false)
            branch:
                Npc_3.CharacterEmoticonAction('EmotEnd', true, '', 60, false)
        run Sub_Event0()
    else:
        Npc_2.CharacterEmoticonAction('EmotEnd', true, '', 60, false)
        run Sub_Event0()

local flow Sub_grp_Event23():
    if EventFlowSystemActor.EnvCheckBetweenDate(6, 30, 6, 30, 'cLastGrowUpTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:109_01', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:108', false)
    System.EventFlags['cPlayer:AlwJuneBrideLastDayTalkFlag'] = true
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkSNpc/alw/GEvent/SP_alw_GEvent_JuneBride:110', true)
        branch:
            SubNpc.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        fork:
            branch:
                MainNpc.CharacterEmoticonAction('Greeting', true, '', 60, false)
            branch:
                EventFlowSystemActor@alp.WaitFrame(3)
                SubNpc.CharacterEmoticonAction('Greeting', true, '', 60, false)
            branch:
                EventFlowSystemActor@spn.WaitFrame(5)
                Npc_2.CharacterEmoticonAction('Smiling', true, '', 0, true)
            branch:
                EventFlowSystemActor@poo.WaitFrame(5)
                Npc_3.CharacterEmoticonAction('Smiling', true, '', 0, true)
            branch:
                EventFlowSystemActor.WaitFrame(50)
        run Sub_grp_Event50()
    else:
        fork:
            branch:
                MainNpc.CharacterEmoticonAction('Greeting', true, '', 60, false)
            branch:
                EventFlowSystemActor@alp.WaitFrame(3)
                SubNpc.CharacterEmoticonAction('Greeting', true, '', 60, false)
            branch:
                EventFlowSystemActor@spn.WaitFrame(5)
                Npc_2.CharacterEmoticonAction('Smiling', true, '', 0, true)
            branch:
                EventFlowSystemActor.WaitFrame(50)
        run Sub_grp_Event50()

local flow Sub_grp_Event50():
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, true)
        branch:
            SubNpc.CharacterEmoticonAction('Smiling', true, '', 0, true)

