flow FunitureN_Chk():
    if (not MainNpc.IsNnpcTent()) and (EventFlowSystemActor.NowRoomFtrNum(1)):
        MainNpc.SelectFreeCFurnitureFurniture(0)
        MainNpc.SetItemName(13, 0, 0)
        if MainNpc.NpcHasFreeMessage('cFreeCFurniture'):
            MainNpc.NpcOpenFreeMessage('cFreeCFurniture')
            EventFlowSystemActor.ExitFlowchart()
        else:
            run RoomN_Chk()
    else:
        run RoomN_Chk()

flow FunitureP_Chk():
    if EventFlowSystemActor.ExistAnyItemInNowRoom():
        MainNpc.SelectFreeCFurnitureFurniture(1)
        MainNpc.SetItemName(13, 0, 0)
        if MainNpc.NpcHasFreeMessage('cFreeCFurniture'):
            MainNpc.NpcOpenFreeMessage('cFreeCFurniture')
            EventFlowSystemActor.ExitFlowchart()
        else:
            run RoomP()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomG:101', false)
        EventFlowSystemActor.ExitFlowchart()

flow Furniture_Chk():
    if EventFlowSystemActor.SystemCheckNowStage('cTalkingNpcHouse'):
        run FunitureN_Chk()
    elif EventFlowSystemActor.SystemCheckNowStage('cTalkingPlayerHouse'):
        run FunitureP_Chk()

flow RoomN_Chk():
    if EventFlowSystemActor.SystemCountPlayerNum() < 2:
        if MainNpc.NpcIsExistOtherNpc():
entrypoint Event4:
            MainNpc.SetNpcName(16, 1)
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
                case 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH:006', false)
                case 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH:007', false)
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH:008', false)
        else:
            MainNpc.NpcSelectFreeTalk('cWildCard', '', '', '', 'TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH', '', '', '', true)
    else:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
            case 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH:011', false)
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH:010', false)
            case 2:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeC_RoomH:009', false)
    EventFlowSystemActor.ExitFlowchart()

flow RoomN_withG():
    run Event4()

flow RoomP():
    MainNpc.NpcSelectFreeTalk('cWildCard', '', '', '', 'TalkNNpc/B1_Bo/Free/BO_FreeC_RoomG', '', '', '', true)
    MainNpc.EventFlags['cNpcMemory:TalkReSelectLast'] = 4
    EventFlowSystemActor.ExitFlowchart()

flow Room_Chk():
    if EventFlowSystemActor.SystemCheckNowStage('cTalkingNpcHouse'):
        run RoomN_Chk()
        MainNpc.EventFlags['cNpcMemory:TalkReSelectLast'] = 4
        EventFlowSystemActor.ExitFlowchart()
    elif EventFlowSystemActor.SystemCheckNowStage('cTalkingPlayerHouse'):
        run RoomP()
    else:
        run NNPC_FreeA::HouseQuestions_Chk()

