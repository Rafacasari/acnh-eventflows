flow GiveGift():
    run StandingUp_Chk()
    fork:
        branch:
            if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
        branch:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:002', false)
    if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:002_002', false)
        MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftFaild'] = true
        MainNpc.EventFlags['cWherearenNpcMemory:KeepStandingUpFlag'] = false
    else:
        run GiveGiftAction()

flow GiveGiftAction():
    MainNpc.NpcChangeHandTool(65534, 'cPutAway', false)
    MainNpc.SelectRewardItemWherearenNPC()
    MainNpc.SetItemName(14, 0, 0)
    MainNpc.NpcDelivery(1, 'Default')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:002_001', false)
    MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftDone'] = true
    MainNpc.EventFlags['cWherearenNpcMemory:KeepStandingUpFlag'] = false

flow GiveGiftRe():
    run StandingUp_Chk()
    fork:
        branch:
            if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
        branch:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:002_003', false)
    MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftFaild'] = false
    run GiveGiftAction()

flow Root():
    if EventFlowSystemActor.WherearenOrderStatus() in (0, 2, 3, 4, 5, 6, 7):
        run Sub_grp_Event13()
    else:
        switch MainNpc.WherearenNpcOrderRelationKind():
            case 0:
                MainNpc.TurnNeck(10, false)
                fork:
                    branch:
                        EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
                    branch:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:110', false)
                fork:
                    branch:
                        EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
                    branch:
                        MainNpc.MessageSuspend()
            case 1, 3:
                run Sub_grp_Event13()
            default:
                return

flow Root_Init():
    if ((not MainNpc.IsChocolateWherearenNpc()) or (MainNpc.EventFlags['cWherearenNpcMemory:Chocolate1stTalkDone'])) and (EventFlowSystemActor.WherearenKKFesStatus(false) == 2) and (EventFlowSystemActor.WherearenOrderStatus() == 0):
        MainNpc.NpcAISetting(2, false)
        MainNpc.NpcAISetting(3, false)

flow SalesTalk():
    run Demo_Common_Wherearen::KKFesCheck()
    run SeaNPC_Chk()
    if (not EventFlowSystemActor.IsWherearenWorkMode()) or (System.EventFlags['cWherearenPlayer:Prohibit_NewOrder']):
        if (EventFlowSystemActor.WherearenKKFesStatus(false) == 0) and (not MainNpc.WherearenNpcIsLocatedSea()):
            fork:
                branch:
                    EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
                branch:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:006', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:007', false)
                case 1:
                    if System.EventFlags['cWherearenPlayer:Prohibit_NewOrder']:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:008', false)
                    else:
                        run Sub_Event66()
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:012', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:006', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:007', false)
                case 1:
                    if System.EventFlags['cWherearenPlayer:Prohibit_NewOrder']:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:008', false)
                    else:
                        run Sub_Event66()
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:012', false)
    elif (MainNpc.WherearenIsNpcLiveTogether()) or (not System.EventFlags['cWherearenPlayer:Unlock_ShareHouse']):
        if (EventFlowSystemActor.WherearenKKFesStatus(false) == 0) and (not MainNpc.WherearenNpcIsLocatedSea()):
            fork:
                branch:
                    EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
                branch:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:004', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run Sub_Event66()
                case 1:
                    run NNPC_Spot_WherearenGarden::Reform()
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:012', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:004', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run Sub_Event66()
                case 1:
                    run NNPC_Spot_WherearenGarden::Reform()
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:012', false)
    elif (EventFlowSystemActor.WherearenKKFesStatus(false) == 0) and (not MainNpc.WherearenNpcIsLocatedSea()):
        fork:
            branch:
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
            branch:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:003', false)
        run Sub_grp_Event2()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:003', false)
        run Sub_grp_Event2()

flow SeaNPC_Chk():
    if (MainNpc.WherearenIsBuiltNpc()) and (EventFlowSystemActor.WherearenKKFesStatus(false) == 0) and (MainNpc.WherearenNpcIsLocatedSea()):
        fork:
            branch:
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
            branch:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:013', false)
        if not System.EventFlags['cPlayerTemp:WHEREAREN_SeaTalkedNow']:
            System.EventFlags['cPlayerTemp:WHEREAREN_SeaTalkedNow'] = true

flow SkipGiveItem():
    run Event70()

flow StandingUp_Chk():
    switch MainNpc.NpcIsSitting():
        case 0:
            fork:
                branch:
                    if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
                        EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
                branch:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:014', false)
            run Sub_Event40()
        case 1, 2, 3, 5:
            fork:
                branch:
                    if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
                        EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
                branch:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:015', false)
            run Sub_Event40()
        default:
            return

local flow Sub_Event40():
    MainNpc.EventFlags['cWherearenNpcMemory:StandingUpFlag'] = true
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
        fork:
            branch:
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
            branch:
                MainNpc.MessageSuspend()
        EventFlowSystemActor.ExitFlowchart()
    else:
        EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event66():
    System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_Garden'] = true
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:005', true)
        branch:
            EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
    MainNpc.WherearenSetNpcVisitInfo()
    EventFlowSystemActor.WherearenSetNpcGardenVisitBy('cTalkNpc')
    EventFlowSystemActor.PlayReport('cWherearenVisit', 0)
    run Demo_Common_Wherearen::SetCamera_GardenVisit()
    EventFlowSystemActor.SoundTriggerEmit('WherearenFade_Boat', -1)
    if MainNpc.IsWherearenMainFieldNpcShareHousePosition():
        MainNpc.ReserveEnterGardenPattern(3)
    else:
        MainNpc.ReserveEnterGardenPattern(2)
    EventFlowSystemActor.SystemRequestChangeStage('cWherearenNpcGarden', 'cWherearen', 'cWherearen', 'cBlack', 1.0, 1.0)

local flow Sub_grp_Event101():
    fork:
        branch:
            EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
        branch:
            MainNpc.MessageSuspend()

local flow Sub_grp_Event13():
    if (MainNpc.IsChocolateWherearenNpc()) and (not MainNpc.EventFlags['cWherearenNpcMemory:Chocolate1stTalkDone']):
        fork:
            branch:
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoAppear('cJpegMainNpcActor', 0, false, 0.0, 0.0, '')
            branch:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:305', false)
        fork:
            branch:
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
            branch:
                MainNpc.MessageSuspend()
        MainNpc.EventFlags['cWherearenNpcMemory:Chocolate1stTalkDone'] = true
    elif EventFlowSystemActor.WherearenKKFesStatus(false) != 0:
        run SkipGiveItem()
    elif MainNpc.WherearenNpcIsLocatedSea():
        run SkipGiveItem()
    elif not MainNpc.ExistSelectRewardItemWherearenNPC():
        run SkipGiveItem()
    elif MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftFaild']:
        if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
            run SkipGiveItem()
        else:
            run GiveGiftRe()
            run Sub_grp_Event101()
    elif MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftDone']:
        run SkipGiveItem()
    elif MainNpc.EventFlags['cWherearenNpcMemory:GiveDrinkDone']:
        run GiveGift()
        run Sub_grp_Event101()
    else:
entrypoint Event70:
        switch EventFlowSystemActor.WherearenOrderStatus():
            case 0:
                run SalesTalk()
                run Sub_grp_Event101()
            case 1:
                run NNPC_Spot_WherearenMainFieldVisitor::LookforHouseMate()
            default:
                return

local flow Sub_grp_Event2():
    switch EventFlowSystemActor.GeneralTalkChoice4():
        case 0:
            run Sub_Event66()
        case 1:
            run NNPC_Spot_WherearenGarden::Reform()
        case 2:
            run NNPC_Spot_WherearenGarden::StartShareHouse()
        case 3:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenMainField:012', false)

