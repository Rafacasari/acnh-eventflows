flow Root():
    if not System.EventFlags['cPlayer:BirthdayPCandleFlag']:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
            case 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:100', true)
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:101', true)
            case 2:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:102', true)
    elif System.EventFlags['cLandTemp:PlayerBirthdayPinataEnd']:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious5(5, true):
            case 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:103', true)
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:104', true)
            case 2:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:105', true)
            case 3:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:106', true)
            case 4:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:107', true)
    else:
        run Root_7_Cupcake_1()

flow Root_1_Field(TargetX: float = 0.0, TargetZ: float = 0.0, MiddleTargetX: float = 0.0, MiddleTargetZ: float = 0.0):
    switch EventFlowSystemActor.RandomChoice3(3):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:001', true)
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:002', true)
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:003', true)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayCall'] = false
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
    MainNpc.WarpPlayerBirthdayHouse(TargetX, TargetZ, MiddleTargetX, MiddleTargetZ)
    EventFlowSystemActor.RequestRecreateFtr()
    EventFlowSystemActor.WaitFrame(30)
    EventFlowSystemActor.FadeIn(true)
    EventFlowSystemActor.PlayerBirthdayStopOriginalBGM()
    MainNpc.CloseUmbrella()
    fork:
        branch:
            MainNpc.NpcEnterDoor(true)
            MainNpc.ChangeNpcPlace('cTalkNpcHouse')
            EventFlowSystemActor.WaitFrame(50)
            EventFlowSystemActor.SystemRequestChangeStage('cTalkNpcHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
        branch:
            EventFlowSystemActor.WaitFrame(50)
            Player.PlayerMoveToTarget(false, TargetX, TargetZ, 0.0, 0.0, true, 'cNoDoorIn')

flow Root_2_In():
    EventFlowSystemActor.SoundDuckingOn(21)
    EventFlowSystemActor.PlayerBirthdayStartBGM()
    EventFlowSystemActor.CameraSetDemoParam('cTalk', 'cTalk', 'cPlayer', false, false, false, 0)
    fork:
        branch:
            MainNpc.SetNpcFeel('cHappy', 3000, false)
        branch:
            Npc_1.SetNpcFeel('cHappy', 3000, false)
        branch:
            Npc_2.SetNpcFeel('cHappy', 3000, false)
    MainNpc.NpcChangeNameStatus(2)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Cheering', false, '', 0, false)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:005', true)
        branch:
            Npc_1.CharacterEmoticonAction('Cheering', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('Cheering', false, '', 0, false)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_1.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
    Player.PlayerMoveToTarget(false, 160.0, 185.0, 0.0, 0.0, true, 'cDemoTalk')
    Player.TurnBody(0, 0.0)
    MainNpc.NpcChangeNameStatus(0)
    fork:
        branch:
            MainNpc.TurnBody(10, 0.0)
            switch EventFlowSystemActor.PlayerBirthdayIsSpecialDay():
                case 0, 3, 4, 5, 6:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:006', true)
                case 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:007', true)
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:008', true)
            MainNpc.EventFlags['cNpcMemory:BirhdayPTalkFlag'] = true
        branch:
            Npc_1.TurnBody(10, 0.0)
            Npc_1.CharacterEmoticonAction('Clapping', false, '', 0, false)
            Npc_1.EventFlags['cNpcMemory:BirhdayPTalkFlag'] = true
        branch:
            Npc_2.TurnBody(10, 0.0)
            Npc_2.CharacterEmoticonAction('Clapping', false, '', 0, false)
            Npc_2.EventFlags['cNpcMemory:BirhdayPTalkFlag'] = true
    EventFlowSystemActor.WaitFrame(5)
    fork:
        branch:
            EventFlowSystemActor.WaitFrame(5)
            MainNpc.EquipCracker()
        branch:
            EventFlowSystemActor@sub1.WaitFrame(10)
            Npc_1.EquipCracker()
        branch:
            EventFlowSystemActor@sub2.WaitFrame(13)
            Npc_2.EquipCracker()
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.FadeOut('cNormalFader', 'cNormalFader', 'cBlack', 0.5, 1.0, false)
    MainNpc.PlayerBirthdayWarpNpcForCandleBlow()
    EventFlowSystemActor.BirthdaySwitchLight(0)
    EventFlowSystemActor.BirthdaySwitchCurtain(0)
    Player.PlayerBirthdayForbidStartUI(0)

flow Root_3_Stop():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:009', true)
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:010', true)
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:011', true)
    Player.PlayerDemoMove('cNextInfoAngle', 3)

flow Root_4_Main():
    Player.PlayerBirthdayTurnBodyToTable()
    Player.PlayerCandleBlow()
    Player.TurnNeck(11, false)
    EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            MainNpc.UseCracker()
            MainNpc.CharacterEmoticonAction('Clapping', true, '', 0, false)
        branch:
            Npc_1.UseCracker()
            Npc_1.CharacterEmoticonAction('Clapping', true, '', 0, false)
        branch:
            Npc_2.UseCracker()
            Npc_2.CharacterEmoticonAction('Clapping', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(40)
    fork:
        branch:
            MainNpc.SetNpcFeel('cNormal', 120, false)
        branch:
            Npc_1.SetNpcFeel('cNormal', 120, false)
        branch:
            Npc_2.SetNpcFeel('cNormal', 120, false)
    System.EventFlags['cPlayer:BirthdayPCandleFlag'] = true
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.SoundTriggerEmit('LightOn', -1)
    EventFlowSystemActor.BirthdaySwitchLight(1)
    EventFlowSystemActor.WaitFrame(45)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayPresent'] = true
    Player.SetDemoTalkTurnRate(0.10000000149011612)
    Player.PlayerBirthdayForbidStartUI(0)

flow Root_5_Present():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:013', false)
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:014', false)
            MainNpc.DecideEventReward('cPlayerBirthdayPresent')
            MainNpc.SetDeliveryItem(1, true)
            if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:017', true)
                MainNpc.WrapDeliveryItem('cPresentBox')
                MainNpc.NpcDelivery(1, 'Default')
                MainNpc.AddMemoryEventPlayerForNpc('Present_FromNNPC')
                MainNpc.SetBirthdayPresentFlag()
                Player.CharacterEmoticonAction('Smiling', false, '', 0, false)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:018', true)
            else:
                System.EventFlags['cPlayer:BirthdayPNotPresentFlag'] = true
                MainNpc.NpcMailSendRandom('MAIL_XX_BirthDayP', 1, 3, 'cNone', 'cFastToday', 'cReward', false)
                MainNpc.SetBirthdayPresentFlag()
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:019', true)
            EventFlowSystemActor.SoundDuckingOn(33)
            EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, false)
        branch:
            Npc_1.CharacterEmoticonAction('Smiling', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('Smiling', false, '', 0, false)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayRestoreCamera'] = 1
    MainNpc.Pinata(0)
    EventFlowSystemActor.BirthdaySwitchCurtain(2)
    Player.SetDemoTalkTurnRate(0.3199999928474426)

flow Root_6_Pinata_1():
    EventFlowSystemActor.CameraSetDemoParam('cPlayerBDPinataExplain', '', 'CameraTag:Pinata', false, true, false, 0)
    EventFlowSystemActor.SoundDuckingOff(33)
    EventFlowSystemActor.FadeIn(true)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:020', false)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayPinata2'] = true

flow Root_6_Pinata_2():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:021', false)
    MainNpc.SetDeliveryItemAtRandom(2829, false, 'cVillageRemakePattern', 0)
    MainNpc.NpcDelivery(1, 'Default')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:022', true)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayPinata2'] = false
    Player.PlayerBirthdayForbidStartUI(1)

flow Root_7_Cupcake_1():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:023', true)
    EventFlowSystemActor.CameraSetDemoParam('cRoomNormal', 'cPinataStart', 'CameraTag:Pinata', false, true, false, 0)
    Player.PlayerMoveToTarget(false, 160.0, 170.0, 0.0, 0.0, true, 'cDemoTalk')
    fork:
        branch:
            MainNpc.TurnBody(10, 0.0)
        branch:
            Npc_1.TurnBody(10, 0.0)
        branch:
            Npc_2.TurnBody(10, 0.0)
    Player.TurnBody(12, 180.0)
    EventFlowSystemActor.WaitFrame(30)
    Player.EquipPinataStick()
    run Root_7_Cupcake_2()

flow Root_7_Cupcake_2():
    EventFlowSystemActor.CameraSetDemoParam('cRoomNormal', '', 'CameraTag:Pinata', false, true, false, 0)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:024', true)
    MainNpc.Pinata(1)
    fork:
        branch:
            Player.PlayerPinataWait()
            System.EventFlags['cLandTemp:PlayerBirthdayPinataEnd'] = true
        branch:
            MainNpc.NpcPinataCheer()
        branch:
            Npc_1.NpcPinataCheer()
        branch:
            Npc_2.NpcPinataCheer()
    switch MainNpc.PinataResult():
        case 0:
            MainNpc.SetNumCupCake(10)
        case 1:
            MainNpc.SetNumCupCake(8)
        case 2:
            MainNpc.SetNumCupCake(6)
    MainNpc.Pinata(2)
    EventFlowSystemActor.CameraSetDemoParam('cPlayerBDPinataResult', 'cPinataStart', 'CameraTag:Pinata', false, true, false, 0)
    EventFlowSystemActor.WaitFrame(25)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Clapping', false, '', 30, false)
        branch:
            Npc_1.CharacterEmoticonAction('Clapping', false, '', 30, false)
        branch:
            Npc_2.CharacterEmoticonAction('Clapping', false, '', 30, false)
    switch MainNpc.PinataResult():
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:027', true)
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:026', true)
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:025', true)
    EventFlowSystemActor.SoundDuckingOn(33)
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, false)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('EmotEnd', false, '', 1, false)
        branch:
            Npc_1.CharacterEmoticonAction('EmotEnd', false, '', 1, false)
        branch:
            Npc_2.CharacterEmoticonAction('EmotEnd', false, '', 1, false)
    MainNpc.Pinata(3)
    Player.PutawayPinataStick()
    Player.TurnBody(0, 0.0)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayCupcake3'] = true

flow Root_7_Cupcake_3():
    MainNpc.DecideEventReward('cCupcake')
    MainNpc.SetDeliveryItem(1, false)
    MainNpc.NpcDelivery(17, 'Keep')
    EventFlowSystemActor.SoundDuckingOff(33)
    EventFlowSystemActor.FadeIn(true)
    if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:028', false)
        MainNpc.NpcDelivery(10, 'Default')
        MainNpc.SetEventRewardToPlayerBaggage('cFree')
        Player.CharacterEmoticonAction('Smiling', false, '', 0, false)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:029', false)
    else:
        if System.EventFlags['cPlayer:BirthdayPNotPresentFlag']:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:030', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:031', false)
        MainNpc.NpcMailSendRandom('MAIL_XX_BirthDayP', 4, 6, 'cNone', 'cFastToday', 'cReward', true)
        MainNpc.NpcDelivery(3, 'Default')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:032', true)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayCupcake3'] = false

flow Root_8_Out():
    fork:
        branch:
            MainNpc.SetNpcFeel('cNormal', 0, false)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:033', true)
        branch:
            Npc_1.SetNpcFeel('cNormal', 0, false)
            Npc_1.TurnBody(10, 0.0)
            Npc_1.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_2.SetNpcFeel('cNormal', 0, false)
            Npc_2.TurnBody(10, 0.0)
            Npc_2.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
    System.EventFlags['cLandTemp:CanSetPlayerBirthdayCallNpc'] = false
    EventFlowSystemActor.ReservePlayerMutterDemo('Player_Demo_BirthdayP', 'Root', 'cNextOutDoorEnd', false)
    EventFlowSystemActor.SoundDuckingOff(21)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Greeting', false, '', 0, false)
        branch:
            Npc_1.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
    EventFlowSystemActor.WaitFrame(20)
    Player.CharacterEmoticonAction('Greeting', false, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    Player.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            Player.PlayerDemoMove('cNextInfoAngle', -3)
        branch:
            EventFlowSystemActor.WaitFrame(5)
            EventFlowSystemActor.NextGoTo('Entrance', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)

flow Root_9_Stop2():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:035', true)
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:036', true)
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:037', true)
    Player.PlayerDemoMove('cNextInfoAngle', 3)

flow Root_Init():
    if (System.EventFlags['cPlayer:BirthdayPCandleFlag']) and (not System.EventFlags['cLandTemp:PlayerBirthdayPinataEnd']):
        MainNpc.NpcAITalkCastSetting('PlayerBirthday')

