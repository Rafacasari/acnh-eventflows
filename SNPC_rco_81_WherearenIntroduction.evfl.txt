flow Entry():
    fork:
        branch:
            Player.PlayerMoveToTarget(false, 170.0, 195.0, 0.0, 0.0, false, '')
            EventFlowSystemActor.CameraSetDemoParam('DemoTalk0', 'cDefault', 'Player', false, false, false, 0)
            Player.TurnNeck(11, false)
            Player.TurnBody(12, 180.0)
            Player.PlayerWaitTurn()
            Player.TurnBody(11, 0.0)
            EventFlowSystemActor.WaitFrame(30)
        branch:
            MainNpc.CharacterEmoticonAction('Eh', true, '', 0, false)
            EventFlowSystemActor.WaitFrame(30)
            MainNpc.TurnBody(10, 0.0)
            SubNpc.TurnBody(10, 0.0)

flow InviteRemakeWS():
    EventFlowSystemActor.MessageSuspend()
    MainNpc.CharacterEmoticonAction('IdeaBulb', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
    if System.EventFlags['cPlayer:RcoRemakeTrialOngoing']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:028', true)
    else:
        if (not System.EventFlags['cPlayer:RcoHeardInviteRemakeWS']) and (System.EventFlags['cPlayer:PAnnouceHeardRemakeWsNewsToday']):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:026', true)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:027', true)
    System.EventFlags['cPlayer:WHEREAREN_RcoHeardRemakeWS'] = true

flow OtgLeave():
    MainNpc.TurnBody(1, 0.0)
    Player.TurnNeck(1, false)
    SubNpc.CharacterEmoticonAction('Greeting', true, '', 0, false)
    EventFlowSystemActor@Leave.WaitFrame(45)
    SubNpc.TurnNeck(11, false)
    SubNpc.TurnBody(12, 180.0)
    SubNpc.NpcWaitTurn()
    EventFlowSystemActor@Leave.WaitFrame(5)
    EventFlowSystemActor@Leave.OpenVillageGate(true)
    SubNpc.NpcRailMove(2, false, false, -1, -1, 1)
    SubNpc.NpcRequestAction(3)
    EventFlowSystemActor@Leave.CloseVillageGate()

flow Root():
    run Entry()
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:001', false)
    MainNpc.TurnNeck(1, false)
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:002', true)
        branch:
            EventFlowSystemActor.WaitFrame(20)
            SubNpc.TurnNeck(0, false)
    EventFlowSystemActor.BGMPropertyControl(185)
    SubNpc.TurnNeck(10, false)
    EventFlowSystemActor.WaitFrame(8)
    fork:
        branch:
            EventFlowSystemActor.WaitFrame(4)
            MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
            EventFlowSystemActor.WaitFrame(40)
            MainNpc.CharacterEmoticonAction('Nodding', false, '', 0, false)
            EventFlowSystemActor.WaitFrame(60)
            MainNpc.CharacterEmoticonAction('EmotEnd', false, '', 0, false)
        branch:
            Player.TurnNeck(1, false)
            SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:003', false)
            SubNpc.TurnNeck(10, false)
            SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:004', true)
    MainNpc.TurnNeck(10, false)
    Player.TurnNeck(0, false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:005', false)
    MainNpc.TurnNeck(1, false)
    fork:
        branch:
            EventFlowSystemActor.WaitFrame(20)
            SubNpc.TurnNeck(0, false)
        branch:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:006', true)
    Player.TurnNeck(1, false)
    SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:007', false)
    SubNpc.TurnNeck(10, false)
    SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:008', false)
    SubNpc.TurnNeck(10, false)
    SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:010', false)
    MainNpc.TurnNeck(10, true)
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:011', false)
        branch:
            EventFlowSystemActor.WaitFrame(15)
            Player.TurnNeck(0, false)
    MainNpc.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:012', true)
    SubNpc.TurnNeck(10, false)
    fork:
        branch:
            SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:013', false)
        branch:
            EventFlowSystemActor.WaitFrame(15)
            Player.TurnNeck(1, false)
    if EventFlowSystemActor.GeneralTalkChoice2() != 0:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:015', true)
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:014', false)
            switch EventFlowSystemActor.GeneralTalkChoice2():
                default:
                    return
    SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:023', true)
    EventFlowSystemActor.SystemBGMVolumeFadeOut(5.0, 3, 0.0)
    run OtgLeave()
    EventFlowSystemActor.BGMPropertyControl(169)
    MainNpc.TurnBody(10, 0.0)
    Player.TurnNeck(0, false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:024', false)
    if System.EventFlags['cPlayer:EnableDiyRemake']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_81_WherearenIntroduction:025', true)
    else:
        run InviteRemakeWS()
    System.EventFlags['cPlayer:UnlockWherearen'] = true
    System.EventFlags['cPlayer:RcoTalkWithOtg'] = true
    System.EventFlags['cPlayer:WHEREAREN_OtgVisitThisIsland'] = true
    run `00_Demo_Fade`::FadeOut_Cmn(FadeType='cCircle', FadeColor='cBlack', FadeSpeed='cNormal', SoundDucking='cWorldDucking')
    EventFlowSystemActor.WaitFrame(20)
    MainNpc.NpcRequestAction(3)
    run `00_Demo_Fade`::FadeIn_Cmn(IsWait=true)

flow Root_Init():
    MainNpc.NpcAITalkSubCastEntry('otg', 1)

