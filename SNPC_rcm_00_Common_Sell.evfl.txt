flow CannotSellTurnip(SellTotal: int = 0):
    run Event92()

flow ChkSellSpecificItem():
    if EventFlowSystemActor.MultiKindItemSelectInclude('SculptureFake', 'PictureFake', '', '', '', '', '', '', 'cItemSelect'):
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:025', false)
        run Sell_NoSunday0()
        EventFlowSystemActor.ExitFlowchart()
    else:
        if EventFlowSystemActor.MultiKindItemSelectInclude('LostQuestDust', 'TreasureQuestDust', '', '', '', '', '', '', 'cItemSelect'):
            SubflowResults[2] = 1
        else:
            SubflowResults[2] = 0
        if EventFlowSystemActor.IsMyVillage():
            if (not System.EventFlags['cPlayer:HeardEatingHintAtShop']) and (EventFlowSystemActor.MultiItemSelectInclude(2287, 2214, 2285, 2286, 2213, 65534, 65534, 65534, 'cItemSelect')):
                System.EventFlags['cPlayerTemp:StoreSellFruitChk'] = true
            if (EventFlowSystemActor.ShopLevel() == `InResServiceTent`) and (System.EventFlags['cLand:VillageDaysCount'] <= 3) and (EventFlowSystemActor.MultiItemSelectInclude(4081, 1432, 3697, 65534, 65534, 65534, 65534, 65534, 'cItemSelect')):
                System.EventFlags['cPlayerTemp:RcmSellCampingStuff'] = true

flow Cmn_After_Sell_Confirm():
    if System.EventFlags['cPlayerTemp:RcmSellItemSingle']:
        MainNpc.NpcDelivery(3, 'Default')
        System.EventFlags['cPlayerTemp:RcmSellItemSingle'] = false
    if (EventFlowSystemActor.IsMyVillage()) and (not System.EventFlags['cPlayer:HeardEatingHintAtShop']) and (System.EventFlags['cPlayerTemp:StoreSellFruitChk']):
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:056_01', false)
        if System.EventFlags['cLand:MuseumBuilt']:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:056_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:056_02', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:056_04', false)
        System.EventFlags['cPlayer:HeardEatingHintAtShop'] = true
        System.EventFlags['cPlayerTemp:StoreSellFruitChk'] = false

flow MovingPlayer2P():
    run Event52()

flow RcmSellSeveralItemNormal():
    if EventFlowSystemActor.ItemValuables():
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:043', false)
        run Sub_grp_Event88()
    elif EventFlowSystemActor.DIYRecipeSelectInclude(13792, 65534, 65534, 65534, 65534, 65534, 65534, 65534, 'cItemSelect'):
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:043_01', false)
        run Sub_grp_Event88()
    else:
        run Event81()

flow RcmSellSingleItemNormal():
    run Event37()

flow Root(SellTotal: int = 0):
    if EventFlowSystemActor.ShopLevel() == `InResServiceTent`:
        run Sub_Event32(SellTotal=SellTotal)
    else:
        if EventFlowSystemActor.EnvDayOfWeek() != `Sunday`:
entrypoint Event1:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:021', false)
            MainNpc.SetKabuka()
            EventFlowSystemActor.UIItemSelectWindowHandling('cSell', 65534, '', '', 'cItemSelect', false)
        elif System.EventFlags['cPlayer:RcmNoTurnipSellToday']:
            run Sub_Event32(SellTotal=SellTotal)
        else:
            System.EventFlags['cPlayer:RcmNoTurnipSellToday'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:022', false)
            run Sell_Sunday(SellTotal=SellTotal)
    if EventFlowSystemActor.UIResultMenuDecide():
        switch EventFlowSystemActor.EnvDayOfWeek():
            case `Sunday`:
entrypoint Event92:
                if EventFlowSystemActor.MultiKindItemSelectInclude('Turnip', '', '', '', '', '', '', '', 'cItemSelect'):
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:024', false)
                    run Sell_Sunday()
                else:
                    run Sub_Event20(SellTotal=SellTotal)
            case `Monday`, `Tuesday`, `Wednesday`, `Thursday`, `Friday`:
                run Sub_Event20(SellTotal=SellTotal)
            case `Saturday`:
                if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
                    run Sub_Event20(SellTotal=SellTotal)
                else:
                    run CannotSellTurnip()
    else:
        run rcm_Sell_Cancel()

flow Sell_NoSunday0(SellTotal: int = 0):
    run Event1()

flow Sell_Sunday(SellTotal: int = 0):
    EventFlowSystemActor.UIItemSelectWindowHandling('cSellWithoutTurnip', 65534, '', '', 'cItemSelect', false)

local flow Sub_Event20(SellTotal: int):
    run ChkSellSpecificItem()
    MainNpc.ShopSellCalc(SellTotal, 1.0, true, false)
    EventFlowSystemActor.SetTagFromSystem('cFlow', 'cMoney', 0, SellTotal, '')
    if EventFlowSystemActor.UIResultItemWindowNumCheck(2, 'cItemSelect'):
        if EventFlowSystemActor.IsMyVillage():
            if System.EventFlags['cPlayer:RcmSellCampingStuffReaction']:
entrypoint Event81:
                if EventFlowSystemActor.ExpensivePurchase():
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:041_02', false)
entrypoint Event105:
                    if SubflowResults@2[2] == 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:042', false)
                        run rcm_Sell_Confirm()
                    elif EventFlowSystemActor.UICheckSelectedItemPrice('cItemSelect') < 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:046', false)
                        run rcm_Sell_Confirm()
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:045', false)
                        SubflowResults[2] = 0
                        run rcm_Sell_Confirm()
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:041', false)
entrypoint Event105:
                    if SubflowResults@2[2] == 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:042', false)
                        run rcm_Sell_Confirm()
                    elif EventFlowSystemActor.UICheckSelectedItemPrice('cItemSelect') < 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:046', false)
                        run rcm_Sell_Confirm()
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:045', false)
                        SubflowResults[2] = 0
                        run rcm_Sell_Confirm()
            else:
                if System.EventFlags['cPlayerTemp:RcmSellCampingStuff']:
                    System.EventFlags['cPlayer:RcmSellCampingStuffReaction'] = true
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:041_01', false)
entrypoint Event105:
                    if SubflowResults@2[2] == 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:042', false)
                        run rcm_Sell_Confirm()
                    elif EventFlowSystemActor.UICheckSelectedItemPrice('cItemSelect') < 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:046', false)
                        run rcm_Sell_Confirm()
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:045', false)
                        SubflowResults[2] = 0
                        run rcm_Sell_Confirm()
                else:
                    run RcmSellSeveralItemNormal()
        else:
            run RcmSellSeveralItemNormal()
    else:
        if EventFlowSystemActor.MultiKindItemSelectInclude('FlowerBud', '', '', '', '', '', '', '', 'cItemSelect'):
            MainNpc.SetDeliveryItemAtRandom(2626, false, 'cVillageRemakePattern', 0)
        else:
            MainNpc.SetDeliveryItem(4, false)
        MainNpc.NpcDelivery(0, 'Keep')
        EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
        System.EventFlags['cPlayerTemp:RcmSellItemSingle'] = true
        if System.EventFlags['cPlayer:RcmSellCampingStuffReaction']:
            run RcmSellSingleItemNormal()
        else:
            if System.EventFlags['cPlayerTemp:RcmSellCampingStuff']:
                System.EventFlags['cPlayer:RcmSellCampingStuffReaction'] = true
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:035', false)
            else:
entrypoint Event37:
                if EventFlowSystemActor.ItemValuables():
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:037', false)
                elif EventFlowSystemActor.DIYRecipeSelectInclude(13792, 65534, 65534, 65534, 65534, 65534, 65534, 65534, 'cItemSelect'):
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:037_01', false)
                elif EventFlowSystemActor.MultiKindItemSelectInclude('DIYRecipe', '', '', '', '', '', '', '', 'cItemSelect'):
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:036', false)
                elif EventFlowSystemActor.ExpensivePurchase():
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:122', false)
                elif SubflowResults@2[2] == 0:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:031', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:038', false)
            run rcm_Sell_Confirm()

local flow Sub_Event32(SellTotal: int):
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:021', false)
    run Sell_Sunday(SellTotal=SellTotal)

local flow Sub_Event5(SellTotal: int):
    System.EventFlags['cLifeSupportAchievement:SellItemRcm'] += 1
    run Cmn_After_Sell_Confirm()

local flow Sub_grp_Event88():
    if EventFlowSystemActor.GeneralTalkChoice2() != 0:
        run rcm_Sell_Cancel_GoldenToolRecipe()
    elif EventFlowSystemActor.ExpensivePurchase():
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:044_02', false)
        run Event105()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:044_01', false)
        run Event105()

flow rcm_Sell_Cancel():
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:901', false)
entrypoint Event78:
    System.EventFlags['cPlayerTemp:StoreSellFruitChk'] = false
    System.EventFlags['cPlayerTemp:RcmSellCampingStuff'] = false
    if System.EventFlags['cPlayerTemp:RcmSellItemSingle']:
        MainNpc.NpcDelivery(10, 'Default')
        System.EventFlags['cPlayerTemp:RcmSellItemSingle'] = false

flow rcm_Sell_Cancel_GoldenToolRecipe():
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:905', false)
    run Event78()

flow rcm_Sell_Confirm(SellTotal: int = 0):
    if EventFlowSystemActor.GeneralTalkChoice2() != 0:
        run rcm_Sell_Cancel()
    elif SubflowResults@2[2] == 0:
        MainNpc.ShopSellCalc(SellTotal, 1.0, true, false)
        switch EventFlowSystemActor.MoneyCapacity(SellTotal, 'cShop'):
            case 0:
                MainNpc.ShopSellDone(1.0, false)
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:051', false)
                run Sub_Event5(SellTotal=SellTotal)
            case 1:
                MainNpc.ShopSellDone(1.0, false)
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:052', false)
                run Sub_Event5(SellTotal=SellTotal)
            case 2:
                if EventFlowSystemActor.PlayerHouseLevel() != `Homeless`:
entrypoint Event52:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:053', true)
                    MainNpc.ShopSellDone(1.0, false)
                    run Sub_Event5(SellTotal=SellTotal)
                elif System.EventFlags['cPlayer:NotBuilt2PMyHomeAfterMoving']:
                    run MovingPlayer2P()
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:054', true)
                    if System.EventFlags['cPlayerTemp:RcmSellItemSingle']:
                        MainNpc.NpcDelivery(10, 'Default')
                        System.EventFlags['cPlayerTemp:RcmSellItemSingle'] = false
    else:
        MainNpc.ShopSellDone(1.0, false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:051_01', false)
        run Cmn_After_Sell_Confirm()

