flow Enter():
    Player.PlayerDemoMove('cForward', 1)
    fork:
        branch:
            EventFlowSystemActor.EmitDoorSound('cDoorEnter')
        branch:
            EventFlowSystemActor@pl.WaitFrame(20)
            Player.CharacterEmoticonAction('Eh', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            Player.PlayerDemoTurn('cSouth')
        branch:
            EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            EventFlowSystemActor.WaitFrame(5)
            Player.PlayerDemoTurn('cWest')
            EventFlowSystemActor.WaitFrame(5)
            Player.PlayerMoveToTarget(false, 150.0, 193.0, 0.0, 0.0, false, '')
            Player.TurnBody(0, 0.0)
        branch:
            MainNpc.NpcAISetting(12, true)
            MainNpc.NpcEnter('Entrance', 5, 0.0)
    MainNpc.TurnBody(10, 0.0)
    EventFlowSystemActor.WaitFrame(15)

flow Exit():
    System.EventFlags['cPlayer:SpnPhotoStudioGuideDone'] = true
    EventFlowSystemActor.SetCatalogFlagPhotoStudioPreset()
    MainNpc.NpcChangeWaitState('cWait', '', '', '', false, true, ArgFlag0=true, ArgInt0=0, ArgStr0='')
    if (EventFlowSystemActor.TermEventNow('JuneBride', false)) and (System.EventFlags['cPlayer:CommuneIslandAvailable']):
        EventFlowSystemActor.MessageSuspend()
        EventFlowSystemActor.FadeOut('cCircle', 'cHeartWipe', 'cBlack', 1.0, 1.0, true)
        MainNpc.NpcAISetting(12, false)
        if System.EventFlags['cPlayer:SpnJuneBrideTalkEventFrag']:
            run Sub_Event0()
        else:
            System.EventFlags['cPlayer:SpnJuneBrideTalkEventFrag'] = true
            EventFlowSystemActor.StoreNormalCamera(false, '')
            Player.PlayerMoveToTarget(true, 15.0, -40.0, 0.0, 0.0, false, 'cAutoWait')
            Player.TurnBody(12, 225.0)
            EventFlowSystemActor.FadeIn(true)
            EventFlowSystemActor.SetNpcAIBlackBoardByLabel('alw', 'DemoSpeak', 1, 1)
    else:
        EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
        MainNpc.NpcAISetting(12, false)
        run Sub_Event0()

flow Root():
    if (EventFlowSystemActor.TermEventNow('JuneBride', false)) and (System.EventFlags['cPlayer:CommuneIslandAvailable']) and (not System.EventFlags['cPlayer:SpnJuneBrideTalkEventFrag']):
        Player.TurnBody(0, 0.0)
        EventFlowSystemActor.WaitFrame(10)
    else:
        run Setup()
        run Enter()
    run Talk()
    run Exit()

flow Setup():
    return

flow Spn_Explain_Again():
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:105', false)
    run Event29()

flow Spn_Explain_Select():
    run Event29()

local flow Sub_Event0():
    EventFlowSystemActor.StoreNormalCamera(true, '')
    if System.EventFlags['cPlayer:PlayerMovingWithPFlag555']:
        System.EventFlags['cPlayer:PlayerMovingWithPFlag555'] = false
        EventFlowSystemActor.SystemReenterStage(6, 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    else:
        EventFlowSystemActor.FadeIn(true)

flow Talk():
    EventFlowSystemActor.BGMPropertyControl(174)
    if not EventFlowSystemActor.TermEventNow('JuneBride', false):
        System.EventFlags['cPlayer:SpnTodayExplainedPhotoStudio'] = true
        if System.EventFlags['cPlayer:SpnFirstTalkedAtCommuneIsland']:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:101', false)
        else:
            System.EventFlags['cPlayer:SpnFirstTalkedAtCommuneIsland'] = true
            System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
            if System.EventFlags['cPlayer:SpnTalkAtHomelandToday']:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_03_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_03_02', false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_04', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:103', false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:104', false)
entrypoint Event29:
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:111', false)
                    if System.EventFlags['cPlayer:EnableDiyRemake']:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:112_01', false)
                    else:
                        if System.EventFlags['cPlayer:RcoEnableRemakeTrial']:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:112_02', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:113', false)
                    run Spn_Explain_Again()
                case 1:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:121', false)
                    if System.EventFlags['cPlayer:EnableEmoticonUI']:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:122', false)
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:123', false)
                        run Spn_Explain_Again()
                    else:
                        run Spn_Explain_Again()
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:131', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:132', false)
                    run Spn_Explain_Again()
                case 3:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:141', false)
                    if System.EventFlags['cPlayer:EnableEmoticonUI']:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:142', false)
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:143', false)
                        run Spn_Explain_Again()
                    else:
                        run Spn_Explain_Again()
                case 4:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:102_01_02', false)
                    if not System.EventFlags['cPlayer:SpnPhotoStudioGuideDone']:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:102_02', true)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:102_01_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:102_02', true)
    elif System.EventFlags['cPlayer:CommuneIslandAvailable']:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:004', false)
        if System.EventFlags['cPlayer:SpnPhotoStudioGuideDone']:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:007', false)
        else:
            System.EventFlags['cPlayer:SpnTodayExplainedPhotoStudio'] = true
            System.EventFlags['cPlayer:SpnPhotoStudioGuideDone'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:005', false)
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:008', true)
        System.EventFlags['cPlayer:SpnFirstTalkedAtCommuneIsland'] = true
        System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
        System.EventFlags['cPlayer:PlayerPocketUIEnableInCommuneIsland'] = true

