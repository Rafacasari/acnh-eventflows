flow AfterRemodel_Force():
    System.EventFlags['cPlayerTemp:RcoTalkSceneFlag'] = true
    run SNPC_rco_01_Tent_1_Entries::RcoTent_Force_PlayerPos()
    run RcoAfterBuiltHouseEvent()

flow AfterRemodel_Force_Init():
    run SNPC_rco_01_Tent_1_Entries::RcoTent_Force_DisableTalkCamera()

flow GiveMileTicket():
    System.EventFlags['cPlayer:CanGetMileTicketTrialForMoving'] = false
    run Event24()

flow GiveMileTicketForMovingPlayer_Force():
    System.EventFlags['cPlayerTemp:RcoTalkSceneFlag'] = true
    run SNPC_rco_01_Tent_1_Entries::RcoTent_Force_PlayerPos()
    run Only_GiveMileTicket()

flow GiveMileTicketForMovingPlayer_Normal():
    if System.EventFlags['cPlayer:RcoAfterHouseRemodel']:
        switch EventFlowSystemActor.PlayerHouseLevel():
            case `BaseHouse`:
                run RcoAfterBuiltHouseEvent()
            case `HouseExpansion1`, `BackRoom`, `LeftRoom`, `RightRoom`, `SecondFloor`, `Basement`:
                run Only_GiveMileTicket()
            default:
                return
    else:
        run Only_GiveMileTicket()

flow Only_GiveMileTicket():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1101', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1102', false)
    switch EventFlowSystemActor.GeneralTalkChoice2():
        case 0, 1:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1103', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1105', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_06', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1104', false)
            System.EventFlags['cPlayer:RcoGetTvForCongratsHouse'] = true
            System.EventFlags['cPlayer:CanGetMileTicketTrialForMoving'] = false

flow RcoAfterBuiltHouseEvent():
    if not System.EventFlags['cPlayer:NotBuilt2PMyHomeAfterMoving']:
        if (not System.EventFlags['cPlayer:PlayerMovingOrderHouseBuilt']) and (not System.EventFlags['cPlayer:PlayerMovingAfterHouseRemodel']):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:011', false)
            run Sub_grp_Event2()
        else:
            switch EventFlowSystemActor.PlayerHouseLevel():
                case `BaseHouse`:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1002', false)
                    run Sub_Event118()
                case `HouseExpansion1`, `BackRoom`, `LeftRoom`, `RightRoom`, `SecondFloor`, `Basement`:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1003', false)
                    run Sub_Event118()
                default:
                    return

flow RcoRcmTalkAboutStoreMaterial_Force():
    run SNPC_rco_01_Tent_1_Entries::RcoTent_Force_PlayerPos()
    System.EventFlags['cPlayerTemp:RcoTalkSceneFlag'] = true
    System.EventFlags['cLand:RcoRcmTalkingAboutStoreMaterial'] = true
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:101', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:102', true)
    EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            MainNpc.TurnBody(10, 0.0)
            MainNpc.NpcWaitTurn()
        branch:
            Npc_1.TurnBody(10, 0.0)
            Npc_1.NpcWaitTurn()
    run GiveMileTicketForMovingPlayer_Normal()

flow RcoRcmTalkAboutStoreMaterial_Force_Init():
    run SNPC_rco_01_Tent_1_Entries::RcoTent_Force_DisableTalkCamera()
    MainNpc.NpcAITalkSubCastEntry('rcm', 1)
    MainNpc.NpcAISetting(2, false)
    MainNpc.NpcAISetting(3, false)
    MainNpc.NpcAISetting(3, false)

flow Root():
    if System.EventFlags['cPlayer:RcoAfterHouseRemodel']:
        run RcoAfterBuiltHouseEvent()

flow SkipMileTicket():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_07', false)
    EventFlowSystemActor.PlayerSetLoan(98000)
    run Sub_Event51()

local flow Sub_Event118():
    System.EventFlags['cPlayer:PlayerMovingOrderHouseBuilt'] = false
    System.EventFlags['cPlayer:PlayerMovingAfterHouseRemodel'] = false
    run Sub_grp_Event2()

local flow Sub_Event49():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:081_01', false)
    run Sub_Event50()

local flow Sub_Event50():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:081_02', false)
    run Sub_Event51()

local flow Sub_Event51():
    EventFlowSystemActor.UIMoneyDisappear()
    System.EventFlags['cPlayer:PlayerLoanRepaying'] = true
    System.EventFlags['cPlayer:RcoAfterHouseRemodel'] = false
    System.EventFlags['cPlayer:RcoWallFtrRemoveHouseRemodel'] = false
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_grp_Event2():
    switch EventFlowSystemActor.PlayerHouseLevel():
        case `BaseHouse`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_02', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_02_01', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_03', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_04_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_04_02', false)
            if not System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']:
entrypoint Event24:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_05', false)
                switch EventFlowSystemActor.GeneralTalkChoice2():
                    case 0, 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_06', false)
                        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:012_07', false)
                        EventFlowSystemActor.PlayerSetLoan(98000)
                        System.EventFlags['cPlayer:RcoGetTvForCongratsHouse'] = true
                        run Sub_Event51()
            elif System.EventFlags['cPlayer:CanGetMileTicketTrialForMoving']:
                run GiveMileTicket()
            else:
                run SkipMileTicket()
        case `HouseExpansion1`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:021_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:021_02', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:021_03', false)
            EventFlowSystemActor.PlayerSetLoan(198000)
            run Sub_Event49()
        case `BackRoom`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:031_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:031_02', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:031_03', false)
            EventFlowSystemActor.PlayerSetLoan(348000)
            run Sub_Event49()
        case `LeftRoom`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:041_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:041_02', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:041_03', false)
            EventFlowSystemActor.PlayerSetLoan(548000)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:081_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:041_04', false)
            run Sub_Event50()
        case `RightRoom`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:051_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:051_02', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:051_03', false)
            EventFlowSystemActor.PlayerSetLoan(758000)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:081_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:051_04', false)
            run Sub_Event50()
        case `SecondFloor`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:061_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:061_02', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:061_03', false)
            EventFlowSystemActor.PlayerSetLoan(1248000)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:081_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:061_05', false)
            System.EventFlags['cPlayer:CompleteNoticeChangeHouseForm'] = true
            run Sub_Event50()
        case `Basement`:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:071_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:071_02', false)
            EventFlowSystemActor.UIMoneyAppear()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:071_03', false)
            EventFlowSystemActor.PlayerSetLoan(2498000)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_02_Loan:1202', false)
            run Sub_Event51()
        default:
            return

