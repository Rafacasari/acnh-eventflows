flow AfterSetZociacRecipe():
    System.EventFlags['cPlayer:OwsPresentThisZodiacRecipe'] = true
    run Event33()

flow Chat():
    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:010', false)

flow ChkHaveZodiacPiece():
    run HaveZodiacChk()
    if SubflowResults@2[2] == 0:
        run Chat()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:011', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            EventFlowSystemActor.UIItemSelectWindowHandling('cAsterism', 65534, '', '', 'cItemSelect', false)
            if EventFlowSystemActor.UIResultMenuDecide():
                MainNpc.SetDeliveryItem(4, false)
                MainNpc.NpcDelivery(0, 'Keep')
                EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:012', false)
                run TalkAboutZodiac()
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:063', false)
                MainNpc.NpcDelivery(10, 'Default')
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:064', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:013', false)
        else:
            run Chat()

flow ChkZodiacRecipe():
    switch EventFlowSystemActor.EnvConstellation('cGrowUpTime'):
        case `Capricorn`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5957):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5957, false)
                run AfterSetZociacRecipe()
        case `Aquarius`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5956):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5956, false)
                run AfterSetZociacRecipe()
        case `Pisces`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5963):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5963, false)
                run AfterSetZociacRecipe()
        case `Aries`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5954):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5954, false)
                run AfterSetZociacRecipe()
        case `Taurus`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5961):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5961, false)
                run AfterSetZociacRecipe()
        case `Gemini`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5960):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5960, false)
                run AfterSetZociacRecipe()
        case `Cancer`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5959):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5959, false)
                run AfterSetZociacRecipe()
        case `Leo`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5964):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5964, false)
                run AfterSetZociacRecipe()
        case `Virgo`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5955):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5955, false)
                run AfterSetZociacRecipe()
        case `Libra`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 3774):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(3774, false)
                run AfterSetZociacRecipe()
        case `Scorpius`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5962):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5962, false)
                run AfterSetZociacRecipe()
        case `Sagittarius`:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 5958):
                run NotSetZodiacRecipe()
            else:
                MainNpc.NpcSetRewardRecipe(5958, false)
                run AfterSetZociacRecipe()

flow GetStarPiece():
    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:014', false)
    switch EventFlowSystemActor.PercentChoice3(60, 20, 20):
        case 0:
            MainNpc.SetDeliveryItemAtRandom(5983, false, 'cVillageRemakePattern', 0)
            EventFlowSystemActor.SetItemToPocket(5983, 5)
            run Event36()
        case 1:
            MainNpc.SetDeliveryItemAtRandom(5984, true, 'cVillageRemakePattern', 0)
            run Event36()
        case 2:
            run SetZodiacStarPiece()
            run Event36()

flow HaveZodiacChk():
    SubflowResults[2] = 1
    if (not EventFlowSystemActor.HasTargetItem(5985, 1)) and (not EventFlowSystemActor.HasTargetItem(5957, 1)) and (not EventFlowSystemActor.HasTargetItem(5986, 1)) and (not EventFlowSystemActor.HasTargetItem(5956, 1)) and (not EventFlowSystemActor.HasTargetItem(5987, 1)) and (not EventFlowSystemActor.HasTargetItem(5963, 1)) and (not EventFlowSystemActor.HasTargetItem(5988, 1)) and (not EventFlowSystemActor.HasTargetItem(5954, 1)) and (not EventFlowSystemActor.HasTargetItem(5989, 1)) and (not EventFlowSystemActor.HasTargetItem(5961, 1)) and (not EventFlowSystemActor.HasTargetItem(5990, 1)) and (not EventFlowSystemActor.HasTargetItem(5960, 1)) and (not EventFlowSystemActor.HasTargetItem(5991, 1)) and (not EventFlowSystemActor.HasTargetItem(5959, 1)) and (not EventFlowSystemActor.HasTargetItem(5992, 1)) and (not EventFlowSystemActor.HasTargetItem(5964, 1)) and (not EventFlowSystemActor.HasTargetItem(5993, 1)) and (not EventFlowSystemActor.HasTargetItem(5955, 1)) and (not EventFlowSystemActor.HasTargetItem(5994, 1)) and (not EventFlowSystemActor.HasTargetItem(3774, 1)) and (not EventFlowSystemActor.HasTargetItem(5995, 1)) and (not EventFlowSystemActor.HasTargetItem(5962, 1)) and (not EventFlowSystemActor.HasTargetItem(5996, 1)) and (not EventFlowSystemActor.HasTargetItem(5958, 1)):
        SubflowResults[2] = 0

flow NotSetZodiacRecipe():
    run Event39()

flow PresentRecipe():
    if not System.EventFlags['cPlayer:OwsPresentFirstRecipe']:
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:108', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:109', false)
        MainNpc.NpcSetRewardRecipe(2544, false)
        MainNpc.SetDeliveryItem(1, true)
        MainNpc.NpcDelivery(1, 'Default')
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:110', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:111', false)
        System.EventFlags['cPlayer:OwsPresentFirstRecipe'] = true
        System.EventFlags['cPlayer:OwsPresentTodayRecipe'] = true
    elif System.EventFlags['cPlayer:OwsPresentThisZodiacRecipe']:
entrypoint Event39:
        if EventFlowSystemActor.PlayerHasCraftRecipe('Ows01', 65534):
            run GetStarPiece()
        else:
            MainNpc.DecideEventRewardDIYRecipe('Ows01')
entrypoint Event33:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:003', false)
            MainNpc.SetDeliveryItem(1, true)
entrypoint Event36:
            MainNpc.NpcDelivery(1, 'Default')
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:004', false)
            System.EventFlags['cPlayer:OwsPresentTodayRecipe'] = true
    else:
        run ChkZodiacRecipe()

flow Root(ItemPrice: int = 0):
    if not System.EventFlags['cPlayer:OwsFirstTalk']:
        System.EventFlags['cPlayer:OwsTalkedToday'] = true
        System.EventFlags['cPlayer:OwsFirstTalk'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:101', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:102', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:103', false)
        if EventFlowSystemActor.EnvSpecialWeather() in (`NormalWeather`, `HeavyShower_MorningBefore`, `HeavyShower_AfternoonBefore`, `Rainbow`, `DoubleRainbow`, `AuroraBorealis_Before1800`, `AuroraBorealis`, `SpecialWeather8`, `SpecialWeather9`):
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:104', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:105', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:106', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:104_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:105', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:106_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:107', false)
        if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:112', false)
        else:
            run PresentRecipe()
    elif not System.EventFlags['cPlayer:OwsTalkedToday']:
        System.EventFlags['cPlayer:OwsTalkedToday'] = true
        if EventFlowSystemActor.EnvSpecialWeather() in (`NormalWeather`, `HeavyShower_MorningBefore`, `HeavyShower_AfternoonBefore`, `Rainbow`, `DoubleRainbow`, `AuroraBorealis_Before1800`, `AuroraBorealis`, `SpecialWeather8`, `SpecialWeather9`):
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:001', false)
            if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:004', false)
            else:
                run PresentRecipe()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:002', false)
            if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') >= 1:
                run PresentRecipe()
    elif System.EventFlags['cPlayer:OwsPresentTodayRecipe']:
        run ChkHaveZodiacPiece()
    elif EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
        run ChkHaveZodiacPiece()
    else:
        run PresentRecipe()

flow SetZodiacStarPiece():
    switch EventFlowSystemActor.EnvConstellation('cGrowUpTime'):
        case `Capricorn`:
            MainNpc.SetDeliveryItemAtRandom(5985, true, 'cVillageRemakePattern', 0)
        case `Aquarius`:
            MainNpc.SetDeliveryItemAtRandom(5986, true, 'cVillageRemakePattern', 0)
        case `Pisces`:
            MainNpc.SetDeliveryItemAtRandom(5987, true, 'cVillageRemakePattern', 0)
        case `Aries`:
            MainNpc.SetDeliveryItemAtRandom(5988, true, 'cVillageRemakePattern', 0)
        case `Taurus`:
            MainNpc.SetDeliveryItemAtRandom(5989, true, 'cVillageRemakePattern', 0)
        case `Gemini`:
            MainNpc.SetDeliveryItemAtRandom(5990, true, 'cVillageRemakePattern', 0)
        case `Cancer`:
            MainNpc.SetDeliveryItemAtRandom(5991, true, 'cVillageRemakePattern', 0)
        case `Leo`:
            MainNpc.SetDeliveryItemAtRandom(5992, true, 'cVillageRemakePattern', 0)
        case `Virgo`:
            MainNpc.SetDeliveryItemAtRandom(5993, true, 'cVillageRemakePattern', 0)
        case `Libra`:
            MainNpc.SetDeliveryItemAtRandom(5994, true, 'cVillageRemakePattern', 0)
        case `Scorpius`:
            MainNpc.SetDeliveryItemAtRandom(5995, true, 'cVillageRemakePattern', 0)
        case `Sagittarius`:
            MainNpc.SetDeliveryItemAtRandom(5996, true, 'cVillageRemakePattern', 0)

flow ShowZodiacChk():
    SubflowResults[1] = 0
    SubflowResults[0] = 0
    if (EventFlowSystemActor.UIPocketMenuItemSelected(5985, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5957, 1, true)):
        SubflowResults[0] = 1
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5986, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5956, 1, true)):
        SubflowResults[0] = 2
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5987, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5963, 1, true)):
        SubflowResults[0] = 3
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5988, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5954, 1, true)):
        SubflowResults[0] = 4
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5989, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5961, 1, true)):
        SubflowResults[0] = 5
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5990, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5960, 1, true)):
        SubflowResults[0] = 6
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5991, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5959, 1, true)):
        SubflowResults[0] = 7
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5992, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5964, 1, true)):
        SubflowResults[0] = 8
    elif (not EventFlowSystemActor.UIPocketMenuItemSelected(5993, 1, true)) and (not EventFlowSystemActor.UIPocketMenuItemSelected(5955, 1, true)):
        SubflowResults[1] = 1
        if (EventFlowSystemActor.UIPocketMenuItemSelected(5994, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(3774, 1, true)):
            SubflowResults[0] = 0
        elif (EventFlowSystemActor.UIPocketMenuItemSelected(5995, 1, true)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5962, 1, true)):
            SubflowResults[0] = 1
        elif (not EventFlowSystemActor.UIPocketMenuItemSelected(5996, 1, true)) and (not EventFlowSystemActor.UIPocketMenuItemSelected(5958, 1, true)):
            SubflowResults[1] = 0
            SubflowResults[0] = 0
        else:
            SubflowResults[0] = 2
    else:
        SubflowResults[0] = 9

flow TalkAboutZodiac():
    run ShowZodiacChk()
    if SubflowResults@2[1] == 0:
        switch SubflowResults@10[0]:
            case 1:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:051', false)
            case 2:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:052', false)
            case 3:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:053', false)
            case 4:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:054', false)
            case 5:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:055', false)
            case 6:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:056', false)
            case 7:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:057', false)
            case 8:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:058', false)
            case 9:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:059', false)
            default:
                return
    else:
        switch SubflowResults@10[0]:
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:060', false)
            case 1:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:061', false)
            case 2:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:062', false)
            default:
                return

