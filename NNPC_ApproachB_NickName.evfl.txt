flow Cancell():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:110', true)
    run Event21()

flow CopyName():
    MainNpc.NpcSetNicknameToTag('cOtherNpc')
    if MainNpc.CheckNpcApproachType():
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:003', false)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:006', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.NpcSaveNickname('cOtherNpc')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:200', false)
        MainNpc.EventFlags['cNpcMemory:InputNickname'] = true
        System.EventFlags['cPlayer:InputApproachBanCount'] = 1
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:201', true)
        System.EventFlags['cPlayer:InputApproachBanCount'] = 2

flow NewName():
    fork:
        branch:
            EventFlowSystemActor.CandNicknamePattern()
        branch:
            if MainNpc.CheckNpcApproachType():
                if MainNpc.EventFlags['cNpcMemory:InputNickname']:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:002', false)
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:001', false)
            elif MainNpc.EventFlags['cNpcMemory:InputNickname']:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:005', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:004', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.NpcSetNicknameToTag('cPattern')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:100', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:102', false)
            MainNpc.NpcSaveNickname('cPattern')
            MainNpc.EventFlags['cNpcMemory:InputNickname'] = true
            System.EventFlags['cPlayer:InputApproachBanCount'] = 1
        elif EventFlowSystemActor.PercentChoice(50):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:103', true)
entrypoint Event21:
            EventFlowSystemActor.UISoftwareKeyboardHandling('cNicname', true)
            if EventFlowSystemActor.UIResultMenuDecide():
                EventFlowSystemActor.SetTagFromUIResult('cNickname', 0)
                if MainNpc.NpcCheckSameWordFromSwkbd('cNickname'):
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:105', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:108', false)
                        System.EventFlags['cPlayer:InputApproachBanCount'] = 1
                    else:
                        run Retype()
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:106', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        if MainNpc.IsEqualPlayerNameAndSwkbdInput():
                            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:111', false)
                            EventFlowSystemActor.SaveSetFromUIResult('cNickname')
                            MainNpc.EventFlags['cNpcMemory:InputNickname'] = false
                        else:
                            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:109', false)
                            EventFlowSystemActor.SaveSetFromUIResult('cNickname')
                            MainNpc.EventFlags['cNpcMemory:InputNickname'] = true
                        System.EventFlags['cPlayer:InputApproachBanCount'] = 1
                    else:
                        run Retype()
            else:
                run Cancell()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:104', false)
            System.EventFlags['cPlayer:InputApproachBanCount'] = 2
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:101', false)
        System.EventFlags['cPlayer:InputApproachBanCount'] = 2

flow Retype():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:107', true)
    run Event21()

