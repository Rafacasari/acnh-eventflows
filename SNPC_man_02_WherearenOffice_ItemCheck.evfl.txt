flow CheckChoco():
    SubflowResults[2] = 1
    run PreCheck()
    if not System.EventFlags['cWherearenPlayer:SeqManTalkAboutChocolate']:
        System.EventFlags['cWherearenPlayer:SeqManTalkAboutChocolate'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:007', true)
    run PreProcess()
    EventFlowSystemActor.SetTagFromUIResult('cWherearenItem3Price', 1)
    MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:005', false)
    switch EventFlowSystemActor.GeneralTalkChoice3():
        case 0:
entrypoint Event37:
            if not EventFlowSystemActor.ShoppingCapacity('cWherearenItem', 65534):
                run Sub_Event43()
            elif MainNpc.ShopHasBellCount(1.0):
                MainNpc.ShopBuyDone(false, false, false, false)
                run Sub_Event15()
            else:
                run Sub_Event42()
        case 1:
            if not EventFlowSystemActor.ShoppingCapacity('cWherearenItem3', 65534):
                run Sub_Event43()
            elif MainNpc.ShopHasBellCount(3.0):
                MainNpc.ShopBuyDone(false, false, false, true)
                run Sub_Event15()
            else:
                run Sub_Event42()
        case 2:
            MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:002', true)

flow PreCheck():
    if System.EventFlags['cWherearenPlayer:ManGenerateInFieldTemp']:
        MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:103', true)
        EventFlowSystemActor.ExitFlowchart()
    elif not System.EventFlags['cWherearenPlayer:OtgGetStartingSalary']:
        MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:101', true)
        EventFlowSystemActor.ExitFlowchart()

flow PreProcess():
    MainNpc.ShopCheckItemSet('CheckItemIndex', 'cWherearenOffice')
    EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
    EventFlowSystemActor.SetTagFromUIResult('cWherearenItemPrice', 0)
    MainNpc.TurnNeck(10, false)
    Player.TurnNeck(13, false)

flow Root():
    SubflowResults[2] = 0
    run PreCheck()
    run SNPC_man_01_WherearenOffice::DeferredPaymentChk()
    if SubflowResults@2[1] != 0:
        System.EventFlags['cWherearenPlayer:Unlock_ManDeferredPayment'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:009', true)
    run PreProcess()
    MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:001', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run Event37()
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:002', true)

flow SetTalkCamera():
    EventFlowSystemActor.StoreNormalCamera(false, '')
    EventFlowSystemActor.WaitFrame(25)

local flow Sub_Event15():
    EventFlowSystemActor.MessageSuspend()
    run SetTalkCamera()
    MainNpc.NpcSetAIBlackBoard('IsNodding', 1)
    run Sub_Event35()

local flow Sub_Event35():
    run SNPC_man_01_WherearenOffice::ManCatalogChk()
    if SubflowResults@2[0] == 1:
        MainNpc.NpcSetAIBlackBoard('IsNodding', 0)
        System.EventFlags['cPlayer:OtgTipsExplainManCatalog'] = true
        System.EventFlags['cWherearenPlayer:SeqManTalkAboutCatalogShop'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:008', true)

local flow Sub_Event42():
    MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:003', true)
    if (SubflowResults@2[2] == 0) and (System.EventFlags['cWherearenPlayer:Unlock_ManDeferredPayment']) and (not EventFlowSystemActor.WherearenShopLoan()):
        run SetTalkCamera()
        MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:004', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.ShopBuyDone(false, false, true, false)
            MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:010', false)
            run Sub_Event35()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:012', true)

local flow Sub_Event43():
    MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:004', true)
    run SetTalkCamera()
    MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:005', true)

