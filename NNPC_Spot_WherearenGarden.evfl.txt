flow ChackNpcFace():
    switch MainNpc.IsNpcType():
        case 0:
            if (not MainNpc.NpcRace('bul')) and (not MainNpc.NpcRace('ant')) and (not MainNpc.NpcRace('elp')):
                SubflowResults[1] = 0
            else:
                SubflowResults[1] = 1
        case 1:
            if (not EventFlowSystemActor.WherearenNpcFreeQuery2('cml', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('alp', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('ttlA', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('plo', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('plk', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('plm', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('ott', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('dod', 'cCustomer')) and (not EventFlowSystemActor.WherearenNpcFreeQuery2('doc', 'cCustomer')):
                SubflowResults[1] = 0
            else:
                SubflowResults[1] = 1
        default:
            return

flow EndShareHouse():
    run Demo_Common_Wherearen::StoryEventChk_StartingWork()
    if SubflowResults@9[16] == 0:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:114', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:115', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run ShareHouseTag()
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:116', true)
                MainNpc.WherearenSetNpcVisitInfo()
                if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
                    System.EventFlags['cWherearenPlayer:RequestEndShareHouseDemo'] = 1
                    MainNpc.MessageSuspend()
                    run `00_Demo_Fade`::FadeOut_Cmn(FadeType='cNormalFader', FadeSpeed='cSlow', FadeColor='cBlack', SoundDucking='cWorldDucking')
                    EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cEraseForNpcOrder')
                    EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cUnregistAmiibo')
                    EventFlowSystemActor.WaitFrame(3)
                else:
                    System.EventFlags['cWherearenPlayer:RequestEndShareHouseDemo'] = 2
                    System.EventFlags['cLandTemp:ReserveFaderKeep'] = true
                    EventFlowSystemActor.ReserveSystemFlowDemo('NNPC_Spot_WherearenEndShareHouseDemo', 'KeepFaderOff_FromHouse', false, false, false)
                    EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cUnregistAmiibo')
                    run `00_System_StageChange`::ChangeStage(TargetStage='cWherearenNpcGarden', FadeColorString='cBlack', FadeInKindString='cNormalFader', FadeInSpeed='cSlow', FadeOutKindString='cCircle', FadeOutSpeed=0.0)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:117', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:118', false)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:114_01', false)

flow EnterGarden(Main: actor, Sub: actor):
    MainNpc@EnterGarden(Main).NpcAISetting(4, false)
    if EventFlowSystemActor.EnterGardenPattern() not in (0, 1, 2):
        Npc_2.TurnNeck(11, false)
    MainNpc.TurnNeck(11, false)
    Npc_1.TurnNeck(11, false)
    Player.TurnNeck(11, false)
    EventFlowSystemActor.CollisionWherearenAirWall(false)
    EventFlowSystemActor.SetLookAtTargetObject('cWherearenNpcHouse')
    Player.TurnBody(12, 180.0)
    Player.PlayerWaitTurn()
    fork:
        branch:
            if EventFlowSystemActor.EnterGardenPattern() in (0, 1, 2):
                EventFlowSystemActor@player.WaitFrame(24)
            else:
                EventFlowSystemActor@player.WaitFrame(60)
            Player.PlayerDemoMove('cForward', 10)
            Player.TurnBody(13, 180.0)
            Player.PlayerWaitTurn()
            Player.TurnBody(11, 0.0)
            Player.TurnNeck(13, false)
        branch:
            MainNpc@EnterGarden(Main).NpcMoveDirection(180.0, 50.0, 1, false, true)
            MainNpc@EnterGarden(Main).TurnBody(13, 0.0)
        branch:
            if EventFlowSystemActor.EnterGardenPattern() in (0, 1, 2):
                EventFlowSystemActor@mnc.WaitFrame(24)
            else:
                EventFlowSystemActor@mnc.WaitFrame(60)
            SubNpc@EnterGarden(Sub).NpcMoveDirection(180.0, 50.0, 1, false, true)
            SubNpc@EnterGarden(Sub).TurnBody(13, 0.0)
            EventFlowSystemActor@mnc.WaitFrame(9)
        branch:
            if EventFlowSystemActor.EnterGardenPattern() == 3:
                EventFlowSystemActor@housemate.WaitFrame(30)
                Npc_2.NpcMoveDirection(180.0, 50.0, 1, false, true)
                Npc_2.TurnBody(13, 0.0)
    EventFlowSystemActor.CollisionWherearenAirWall(true)
    EventFlowSystemActor.CameraSetDemoParam('LandingTalk', 'cDefault', 'Place:SafeArea', false, false, false, 0)
    SubNpc@EnterGarden(Sub).NpcAISetRequestSpeakFunc('cLeaveWherearenGarden', false)
    EventFlowSystemActor.ReserveEnterGardenPattern(0)

flow EnterGardenWithoutCustomer():
    MainNpc.NpcAISetting(4, false)
    EventFlowSystemActor.CollisionWherearenAirWall(false)
    fork:
        branch:
            Player.TurnBody(12, 180.0)
            Player.PlayerWaitTurn()
            Player.PlayerDemoMove('cForward', 10)
            Player.TurnBody(0, 0.0)
        branch:
            MainNpc.NpcMoveDirection(180.0, 50.0, 1, false, true)
            MainNpc.TurnBody(10, 0.0)
    EventFlowSystemActor.CollisionWherearenAirWall(true)
    MainNpc.NpcAISetRequestSpeakFunc('cLeaveWherearenGarden', false)
    EventFlowSystemActor.CameraSetDemoParam('LandingTalk', 'cDefault', 'Place:SafeArea', false, false, false, 0)
    EventFlowSystemActor.ReserveEnterGardenPattern(0)

flow FaceToFace():
    run ChackNpcFace()
    fork:
        branch:
            MainNpc.TurnNeck(11, false)
            run TurnNPC()
        branch:
            run TurnPlayer()
        branch:
            if not EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcRoom1'):
                Npc_1.TurnNeck(11, false)
                if EventFlowSystemActor.WherearenNpcFreeQuery2('otg', 'cOfficer'):
                    Npc_1.TurnBody(12, 150.0)
                else:
                    Npc_1.TurnBody(12, 180.0)
            elif MainNpc.WherearenIsNpcLiveTogether():
                Npc_1.TurnNeck(11, false)
                Npc_1.TurnBody(12, 150.0)
        branch:
            if (not EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcRoom1')) and ((not ((EventFlowSystemActor.WherearenOrderStatus() == 0) or (EventFlowSystemActor.WherearenNpcOrderType() in (0, 2, 3)))) or (EventFlowSystemActor.EnterGardenPattern() == 3)):
                Npc_2.TurnNeck(11, false)
                Npc_2.TurnBody(12, 180.0)
    EventFlowSystemActor.WaitFrame(15)

flow FreeTalk():
    if MainNpc.WherearenIsNpcLiveTogether():
        switch MainNpc.WherearenNpcOrderRelationKind():
            case 0, 3:
                EventFlowSystemActor.WherearenSetTagCustomerNpcName(true, 0)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:112', false)
            case 1:
                EventFlowSystemActor.WherearenSetTagCustomerNpcName(false, 0)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:113', false)
            default:
                return
    elif EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:119', false)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:111', false)

flow GoToShareHouseOrder():
    EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:OrderCut0', '', true)
    EventFlowSystemActor.RequestWaterFallDucking(2)
    EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
    EventFlowSystemActor.WaitFrame(6)
    EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
    EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
    EventFlowSystemActor.SystemRequestChangeStage('cWherearenOrderDemo', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)

flow KeepFtr_ExtensionDisable():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:104_01', false)
    fork:
        branch:
            if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
                EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
        branch:
            MainNpc.MessageSuspend()
    EventFlowSystemActor.SystemBGMVolumeFadeOut(0.800000011920929, 0, 0.0)
    run Omakase()
    MainNpc.WherearenTakeOnNpcOrder('cReform', '', 'cKeepFtr', '', '')
    EventFlowSystemActor.WherearenSetNpcOrderStartStage('cNpcGarden')
    EventFlowSystemActor.WherearenOrderCallback('cStart')
    EventFlowSystemActor.WherearenOrderCallback('cConfirm')
    EventFlowSystemActor.BGMPropertyControl(126)
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
        EventFlowSystemActor.WherearenSetNpcOrderStartStage('cNpcGarden')
        System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_Garden'] = true
        if MainNpc.IsWherearenMainFieldNpcShareHousePosition():
            MainNpc.ReserveEnterGardenPattern(3)
        else:
            MainNpc.ReserveEnterGardenPattern(2)
        run Demo_Common_Wherearen::SetCamera_GardenVisit()
        EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cUnregistAmiibo')
        EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
        EventFlowSystemActor.WaitFrame(6)
        EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
        EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
        EventFlowSystemActor.BGMPropertyControl(127)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenNpcStageSelected', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)
    else:
        EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
        EventFlowSystemActor.WaitFrame(6)
        EventFlowSystemActor.SoundFadeOutDuckingOn(12)
        EventFlowSystemActor.FadeOut('cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0, false)
        EventFlowSystemActor.StoreNormalCamera(true, '')
        Player.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
        EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cEraseForNpcOrder')
        EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cUnregistAmiibo')
        EventFlowSystemActor.WaitFrame(30)
        EventFlowSystemActor.SoundFadeOutDuckingOff()
        EventFlowSystemActor.SoundDuckingOff(54)
        EventFlowSystemActor.SystemBGMVolumeFadeIn(0.0, 0, 0.0)
        EventFlowSystemActor.BGMPropertyControl(127)
        EventFlowSystemActor.WherearenOrderCallback('cEditStart')
        EventFlowSystemActor.FadeIn(true)
        EventFlowSystemActor.UIMainMenuSetInvalidFrame(80)
        EventFlowSystemActor.UIThemeAppear('')
        if MainNpc.WherearenIsNpcLiveTogether():
            EventFlowSystemActor.SetNpcAIBlackBoardByLabel('-Wherearen:Housemate', 'ReformStart', 0, 1)

flow Move():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:108', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:108_01', true)
        run Omakase()
        MainNpc.WherearenTakeOnNpcOrder('cMoving', '', '', '', '')
        EventFlowSystemActor.WherearenOrderCallback('cStart')
        run NNPC_Spot_WherearenMainFieldVisitor::SetOrderCamera()
        EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
        EventFlowSystemActor.WaitFrame(6)
        EventFlowSystemActor.RequestWaterFallDucking(0)
        EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
        EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenOrderDemo', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)
    else:
        run ReformCancel()

flow Omakase():
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.WaitFrame(10)
    if not EventFlowSystemActor.IsWherearenWorkMode():
        EventFlowSystemActor.ChangeWherearenWorkMode(false, true)
    EventFlowSystemActor.SoundDuckingOn(54)
    fork:
        branch:
            Player.CharacterEmoticonAction('Assent', true, '', 0, false)
        branch:
            MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)

flow OrderStart():
    EventFlowSystemActor.SystemBGMVolumeFadeIn(0.0, 0, 0.0)
    EventFlowSystemActor.BGMPropertyControl(127)
    System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_Garden'] = false
    switch EventFlowSystemActor.WherearenNpcOrderType():
        case 0:
            if System.EventFlags['cWherearenPlayer:SeqMncGardenEditTalk']:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:001', true)
                run SNPC_mnc_19_WherearenEvent_GardenEdit::ChkMncTalk()
            else:
                run SNPC_mnc_19_WherearenEvent_GardenEdit::VisitTalk_GardenEdit()
            run FaceToFace()
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:001_01', true)
            EventFlowSystemActor.WherearenOrderCallback('cEditStart')
            EventFlowSystemActor.StoreNormalCamera(false, 'OrderThemeAppear')
            EventFlowSystemActor.UIMainMenuSetInvalidFrame(80)
            EventFlowSystemActor.UIThemeAppear('cGarden')
        case 1:
            Npc_2.SetNpcName(0, 0)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:128_01', false)
            Npc_2.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:128_02', false)
            run FaceToFace()
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:128_03', true)
            if System.EventFlags['cWherearenPlayer:SeqShareHouseOngoing']:
                MainNpc.SetNpcName(0, 1)
                SubNpc.TurnNeck(10, false)
                fork:
                    branch:
                        SubNpc.OpenMessageWindow('TalkSNpc/mnc/SP_mnc_04_WherearenEvent:211', true)
                    branch:
                        EventFlowSystemActor.WaitFrame(15)
                        Player.TurnBody(11, 0.0)
                        Player.TurnNeck(1, false)
                run Sub_Event147()
            else:
                run Sub_Event147()
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:129_01', true)
            run FaceToFace()
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:129_01_01', true)
            EventFlowSystemActor.WherearenOrderCallback('cEditStart')
            EventFlowSystemActor.UIMainMenuSetInvalidFrame(80)
            EventFlowSystemActor.UIThemeAppear('cGarden')
        case 3:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:124', true)
            run FaceToFace()
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:124_01', true)
            EventFlowSystemActor.WherearenOrderCallback('cEditStart')
            EventFlowSystemActor.UIMainMenuSetInvalidFrame(80)
            EventFlowSystemActor.UIThemeAppear('cGarden')

flow PlayerVisit():
    if MainNpc.ExistSelectRewardItemWherearenNPC():
        switch MainNpc.IsNpcType():
            case 0:
                run Sub_grp_Event170()
            case 1:
                if MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
                    run SkipGift()
                else:
                    run Sub_grp_Event170()
            default:
                return
    else:
        run SkipGift()

flow Reform():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:102_01', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run KeepFtr_ExtensionDisable()
    else:
        run ReformCancel()

flow ReformCancel():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:107', false)

flow Return():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:148', true)
    EventFlowSystemActor.WherearenOrderCallback('cReturnToMainIsland')
    System.EventFlags['cPlayerTemp:WHEREAREN_OtgTalkReserve_Office'] = true
    System.EventFlags['cWherearenPlayer:VisitHouseReturn'] = true
    run Demo_Common_Wherearen::CheckReturnWithTakumi()
    if SubflowResults@2[0] == 0:
        EventFlowSystemActor.SoundTriggerEmit('WherearenFade_Boat', -1)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenOfficeReturnEntrance', 'cWherearen', 'cWherearen', 'cBlack', 1.0, 1.0)
    else:
        System.EventFlags['cWherearenPlayer:ReturnWithOtg'] = true
        EventFlowSystemActor.SoundTriggerEmit('WherearenFade_Boat', -1)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenOfficeReturn', 'cWherearen', 'cWherearen', 'cBlack', 1.0, 1.0)

flow SalesTalk_PiC():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:101', false)
    switch EventFlowSystemActor.GeneralTalkChoice4():
        case 0:
            run FreeTalk()
        case 1:
            if System.EventFlags['cWherearenPlayer:Unlock_ShareHouse']:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:101_01', false)
                switch EventFlowSystemActor.GeneralTalkChoice4():
                    case 0:
                        run Reform()
                    case 1:
                        run Move()
                    case 2:
                        if MainNpc.WherearenIsNpcLiveTogether():
                            run EndShareHouse()
                        else:
                            run StartShareHouse()
                    case 3:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:110_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:101_02', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        run Reform()
                    case 1:
                        run Move()
                    case 2:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:110_01', false)
        case 2:
            run Return()
        case 3:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:110', false)

flow ShareHouseTag():
    switch MainNpc.WherearenNpcOrderRelationKind():
        case 0:
            EventFlowSystemActor.WherearenSetTagCustomerNpcName(true, 0)
        case 1:
            EventFlowSystemActor.WherearenSetTagCustomerNpcName(false, 0)
        default:
            return

flow SkipGift():
    if System.EventFlags['cWherearenPlayer:SeqFirstVistCustomerOngoing']:
        run NNPC_Spot_WherearenEvent_Once::FirstVisitCustomer_Talk()
    else:
        run SalesTalk_PiC()

flow StartShareHouse():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:109', false)
    if MainNpc.IsNpcType() == 0:
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            run ReformCancel()
        elif EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
            fork:
                branch:
                    EventFlowSystemActor.UIWherearenIslandsMsgPhotoDisappear()
                branch:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:109_01', true)
            run Sub_Event320()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:109_01', true)
            run Sub_Event320()

local flow Sub_Event147():
    EventFlowSystemActor.WherearenOrderCallback('cEditStart')
    EventFlowSystemActor.UIMainMenuSetInvalidFrame(80)
    EventFlowSystemActor.UIThemeAppear('cGarden')

local flow Sub_Event320():
    EventFlowSystemActor.SystemBGMVolumeFadeOut(0.800000011920929, 0, 0.0)
    System.EventFlags['cPlayerTemp:WHEREAREN_OtgTalkReserve_Office'] = false
    run Omakase()
    MainNpc.WherearenTakeOnNpcOrder('cShareHouse', '', '', '', '')
    EventFlowSystemActor.WherearenOrderCallback('cStart')
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenMainIsland'):
        EventFlowSystemActor.BGMPropertyControl(126)
        EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
        EventFlowSystemActor.WaitFrame(6)
        EventFlowSystemActor.SoundFadeOutDuckingOn(12)
        EventFlowSystemActor.FadeOut('cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0, false)
        MainNpc.ArrangeCharacterForOrder()
        EventFlowSystemActor.SetWherearenPlayerRemoveBinderSeq(true, false)
        EventFlowSystemActor.WaitFrame(3)
    else:
        run GoToShareHouseOrder()

local flow Sub_grp_Event170():
    if MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftFaild']:
        if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
            run SkipGift()
        else:
            run NNPC_Spot_WherearenMainField::GiveGiftRe()
    elif MainNpc.EventFlags['cWherearenNpcMemory:GiveGiftDone']:
        run SkipGift()
    elif MainNpc.EventFlags['cWherearenNpcMemory:GiveDrinkDone']:
        run NNPC_Spot_WherearenMainField::GiveGift()
    else:
        run SkipGift()

flow TurnNPC():
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcRoom1'):
        if SubflowResults@2[1] == 0:
            MainNpc.TurnBody(10, 0.0)
        else:
            MainNpc.TurnBody(12, 60.0)
    elif SubflowResults@2[1] == 0:
        MainNpc.TurnBody(10, 0.0)
    else:
        MainNpc.TurnBody(12, 300.0)

flow TurnPlayer():
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcRoom1'):
        if SubflowResults@2[1] == 0:
            Player.TurnBody(0, 0.0)
        else:
            Player.TurnBody(12, 300.0)
    elif SubflowResults@2[1] == 0:
        Player.TurnBody(0, 0.0)
    else:
        Player.TurnBody(12, 60.0)

flow VisitTogether():
    System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_Garden'] = false
    run EnterGarden(Main=MainNpc, Sub=SubNpc)
    switch EventFlowSystemActor.WherearenOrderStatus():
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:123', false)
            run FaceToFace()
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:123_01', false)
        case 2:
            run OrderStart()
        default:
            return

flow VisitTogether_Init():
    MainNpc.NpcAITalkSubCastEntry('-Wherearen:Officer', 1)
    MainNpc.NpcAISetting(4, false)
    if EventFlowSystemActor.EnterGardenPattern() == 3:
        MainNpc.NpcAITalkSubCastEntry('-Wherearen:Housemate', 2)

