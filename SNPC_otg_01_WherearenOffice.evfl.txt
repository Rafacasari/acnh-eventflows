flow CafeEdit():
    SubflowResults[0] = 2
    EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cCafe')
    if not System.EventFlags['cWherearenPlayer:Unlock_Extension_Cafe']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_01', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_14', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cCafe', 'cReform')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameCafe()
            case 2:
                run FacilityEditCancel()
    elif EventFlowSystemActor.WherearenIsExpandedFacility('cCafe'):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_03', false)
        switch EventFlowSystemActor.GeneralTalkChoice4():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_14', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cCafe', 'cReform')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameCafe()
            case 2:
                run SetNameCafeGallery()
            case 3:
                run FacilityEditCancel()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_02', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_18', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cCafe', 'cExpand')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameCafe()
            case 2:
                run FacilityEditCancel()

flow CafeEdit_NewBuild():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_05', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        EventFlowSystemActor.WherearenTakeOnFacilityOrder('cCafe', 'cNew')
        SubflowResults[1] = 1
        System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe'] = false
        run GoToFacility()
    else:
        run FacilityEditCancel()

flow CheckCafeExtention():
    if (System.EventFlags['cWherearenPlayer:IsAfterFirstKKFesDay']) and (System.EventFlags['cWherearenPlayer:CompleteAppearanceCafe']) and (EventFlowSystemActor.WherearenOrderInfoType() == 0) and (EventFlowSystemActor.WherearenNpcOrderType() == 0) and (not System.EventFlags['cWherearenPlayer:Unlock_Extension_Cafe']) and (System.EventFlags['cWherearenPlayer:CoordinatorGrade'] >= 4):
        SubflowResults[0] = 1

flow CheckFacilityExtention():
    SubflowResults[0] = 0
    run CheckCafeExtention()
    run CheckRestaurantExtention()
    switch SubflowResults@3[0]:
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_04_02', true)
            System.EventFlags['cWherearenPlayer:Unlock_Extension_Cafe'] = true
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:211', true)
            System.EventFlags['cWherearenPlayer:Unlock_Extension_Restaurant'] = true
        default:
            return

flow CheckRestaurantExtention():
    if (System.EventFlags['cWherearenPlayer:IsAfterFirstKKFesDay']) and (System.EventFlags['cWherearenPlayer:CompleteAppearanceRestaurant']) and (EventFlowSystemActor.WherearenOrderInfoType() == 0) and (EventFlowSystemActor.WherearenNpcOrderType() == 1) and (not System.EventFlags['cWherearenPlayer:Unlock_Extension_Restaurant']) and (System.EventFlags['cWherearenPlayer:ShareHouseDoneCount'] >= 2):
        SubflowResults[0] = 2

flow CheckWorkContinue():
    run Comment_AfterReceiveGradeUp()
    run PartyF_Chk()
    run GradeUpD_Finish()
    run Otg_ReturnHomePos()
    run Event202()

flow CheckWorkContinue_Init():
    if (EventFlowSystemActor.WherearenIsGradeUp()) and (EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') == 3):
        MainNpc.NpcAITalkCastSetting('WherearenPrologue')

flow CheckWorkContinue_Sub():
    run Event540()

flow Comment_AfterReceiveGradeUp():
    if (EventFlowSystemActor.WherearenIsGradeUp()) and (EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') in (1, 2, 3, 4, 5)):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:061', true)

flow Comment_AfterReceiveNormal():
    if (not EventFlowSystemActor.WherearenIsGradeUp()) or (EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') in (0, 6)):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:060', true)

flow Comment_SalaryNotice():
    if EventFlowSystemActor.WherearenIsGradeUp():
        switch EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade'):
            case 1:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_02_01', true)
                run Sub_Event114()
            case 2:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_02_02', true)
                run Sub_Event114()
            case 3:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_02_03', true)
                run Sub_Event114()
            case 4:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_02_04', true)
                run Sub_Event114()
            case 5:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_02_05', true)
                run Sub_Event114()
            case 6:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_02_06', true)
                run Sub_Event114()
            default:
                return
    else:
        run PayNotice()

flow CreateSchool():
    run StoryEvent_WorkModeOn()
    run SNPC_otg_15_WherearenEvent_School::Root()
    run OrderClose_EndTalk()
    EventFlowSystemActor.ExitFlowchart()

flow EditFacility():
    if not System.EventFlags['cWherearenPlayer:Unlock_Faclility_Restaurant']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_10', false)
        run SchoolEdit_Direct()
    elif not System.EventFlags['cWherearenPlayer:Unlock_Faclility_Hospital']:
        if not System.EventFlags['cWherearenPlayer:CompleteAppearanceRestaurant']:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_08', false)
            switch EventFlowSystemActor.GeneralTalkChoice4():
                case 0:
                    run RestaurantEdit_NewBuild()
                case 1:
                    run SchoolEdit()
                case 2:
                    run CafeEdit()
                case 3:
                    run FacilityEditCancel()
        elif System.EventFlags['cWherearenPlayer:CompleteAppearanceCafe']:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_07', false)
            switch EventFlowSystemActor.GeneralTalkChoice4():
                case 0:
                    run SchoolEdit()
                case 1:
                    run RestaurantEdit()
                case 2:
                    run CafeEdit()
                case 3:
                    run FacilityEditCancel()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_09', false)
            switch EventFlowSystemActor.GeneralTalkChoice4():
                case 0:
                    run CafeEdit_NewBuild()
                case 1:
                    run SchoolEdit()
                case 2:
                    run RestaurantEdit()
                case 3:
                    run FacilityEditCancel()
    elif System.EventFlags['cWherearenPlayer:Unlock_Faclility_Tailor']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_01', false)
        switch EventFlowSystemActor.GeneralTalkChoice6():
            case 0:
                run SchoolEdit()
            case 1:
                run RestaurantEdit()
            case 2:
                run CafeEdit()
            case 3:
                run HospitalEdit()
            case 4:
                run TailorEdit()
            case 5:
                run FacilityEditCancel()
    elif not System.EventFlags['cWherearenPlayer:CompleteAppearanceRestaurant']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_05', false)
        switch EventFlowSystemActor.GeneralTalkChoice5():
            case 0:
                run RestaurantEdit_NewBuild()
            case 1:
                run SchoolEdit()
            case 2:
                run CafeEdit()
            case 3:
                run HospitalEdit()
            case 4:
                run FacilityEditCancel()
    elif System.EventFlags['cWherearenPlayer:CompleteAppearanceCafe']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_04', false)
        switch EventFlowSystemActor.GeneralTalkChoice5():
            case 0:
                run SchoolEdit()
            case 1:
                run RestaurantEdit()
            case 2:
                run CafeEdit()
            case 3:
                run HospitalEdit()
            case 4:
                run FacilityEditCancel()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:005_06', false)
        switch EventFlowSystemActor.GeneralTalkChoice5():
            case 0:
                run CafeEdit_NewBuild()
            case 1:
                run SchoolEdit()
            case 2:
                run RestaurantEdit()
            case 3:
                run HospitalEdit()
            case 4:
                run FacilityEditCancel()

flow FacilityEditCancel():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:008', true)

flow Force_CommonWorkDone():
    switch EventFlowSystemActor.WherearenOrderInfoType():
        case 0:
            run Demo_Common_Wherearen::CheckReturnWithTakumi()
            if SubflowResults@2[0] == 0:
                run HouseCompleteActing()
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:200', false)
                run Sub_Event21()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:201_04', false)
                run Sub_Event21()
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:201_01', false)
            run Sub_Event21()
        default:
            return

flow Force_CommonWorkDone_Init():
    run SNPC_otg_22_WherearenEvent_ShareHouse::CastChk()
    if EventFlowSystemActor.WherearenCanNextGradeUp('cGradeD'):
        MainNpc.NpcAITalkCastSetting('WherearenPrologue')

flow Force_EditCanceled():
    switch EventFlowSystemActor.WherearenOrderInfoType():
        case 0:
            run Demo_Common_Wherearen::CheckReturnWithTakumi()
            if SubflowResults@2[0] == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:202', true)
                run Sub_Event568()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:202_01', false)
                run Sub_Event568()
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:203', true)
            run Sub_Event568()
        default:
            return

flow Force_EditCanceled_Init():
    run SNPC_otg_22_WherearenEvent_ShareHouse::CastChk()

flow GetSalaryForEvent():
    run Demo_Common_Wherearen::SetSalaryAsDeliveryItem()
    MainNpc.NpcDelivery(1, 'Default')
    EventFlowSystemActor.WherearenReceiveSalary()
    run RainbowRandom()
    if EventFlowSystemActor.WherearenIsSalarySendSaving():
        if System.EventFlags['cWherearenPlayer:Unlock_Exchange']:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:052', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:052_02', false)
    EventFlowSystemActor.UIPokiDisappear()
    run CheckFacilityExtention()

flow GoToFacility():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:007', true)
    if not EventFlowSystemActor.IsWherearenWorkMode():
        EventFlowSystemActor.ChangeWherearenWorkMode(false, true)
    EventFlowSystemActor.SystemBGMVolumeFadeOut(0.800000011920929, 0, 0.0)
    System.EventFlags['cPlayerTemp:WHEREAREN_OtgTalkReserve_Facility'] = true
    EventFlowSystemActor.WherearenOrderCallback('cStart')
    EventFlowSystemActor.WherearenOrderCallback('cConfirm')
    EventFlowSystemActor.WaitFrame(15)
    fork:
        branch:
            Player.CharacterEmoticonAction('Assent', true, '', 0, false)
        branch:
            MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    if SubflowResults@2[1] == 0:
        EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
        EventFlowSystemActor.WaitFrame(6)
        EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
        EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
        EventFlowSystemActor.ReserveSkipSceneStartDemo()
        System.EventFlags['cLandTemp:ReserveFaderKeep'] = true
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenFacilityOrder', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)
    else:
        System.EventFlags['cWherearenPlayer:SeqRestaurantEditOngoing'] = true
        System.EventFlags['cWherearenPlayer:SeqRestaurantEdit2Ongoing'] = true
        System.EventFlags['cWherearenPlayer:IsFacilityEditStartDemo'] = 1
        EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
        EventFlowSystemActor.WaitFrame(6)
        EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
        EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
        EventFlowSystemActor.ReserveSkipSceneStartDemo()
        if System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe']:
            EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:RestaurantEditStartDemo_0', 'Player', false)
        else:
            EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:CafeEditStartDemo_0', 'Player', false)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenFacilitySuspended', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)

flow GradeE_Chk():
    if (EventFlowSystemActor.WherearenIsGradeUp()) and (EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') == 4) and (System.EventFlags['cWherearenPlayer:CompleteAppearanceCafe']) and (System.EventFlags['cWherearenPlayer:IsAfterFirstKKFesDay']):
        EventFlowSystemActor.WaitFrame(10)
        Player.TurnNeck(0, false)
        Player.TurnBody(0, 0.0)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_04_01', true)

flow GradeUp():
    if System.EventFlags['cWherearenPlayer:CoordinatorGrade'] == 1:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_01', true)
    elif System.EventFlags['cWherearenPlayer:CoordinatorGrade'] == 2:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_02', true)
    elif System.EventFlags['cWherearenPlayer:CoordinatorGrade'] == 3:
        run GradeUpD_Start()
        System.EventFlags['cWherearenPlayer:Unlock_ThemeFreeEdit'] = true
    elif System.EventFlags['cWherearenPlayer:CoordinatorGrade'] != 4:
        if System.EventFlags['cWherearenPlayer:CoordinatorGrade'] == 5:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_05', true)
        elif System.EventFlags['cWherearenPlayer:CoordinatorGrade'] == 6:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_06', true)
    elif (System.EventFlags['cWherearenPlayer:CompleteAppearanceCafe']) and (System.EventFlags['cWherearenPlayer:IsAfterFirstKKFesDay']):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_04', true)
        System.EventFlags['cWherearenPlayer:Unlock_Extension_Cafe'] = true
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_04', true)

flow GradeUpD_Finish():
    if (EventFlowSystemActor.WherearenIsGradeUp()) and (EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') == 3):
        run `00_Demo_Fade`::FadeOut_Cmn(FadeType='cCircle', FadeColor='cBlack', FadeSpeed='cNormal', SoundDucking='cWorldDucking')
        SubNpc.NpcSetVisibleAction(false)
        EventFlowSystemActor.WaitFrame(20)
        run `00_Demo_Fade`::FadeIn_Cmn(IsWait=true)
        System.EventFlags['cWherearenPlayer:MncGenerateInOfficeTemp'] = false

flow GradeUpD_Start():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_03', true)
    SubNpc.TurnNeck(10, false)
    fork:
        branch:
            SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_03_01', false)
        branch:
            EventFlowSystemActor.WaitFrame(90)
            Npc_2.TurnNeck(10, false)
            Npc_2.CharacterEmoticonAction('Nodding', true, '', 0, false)
        branch:
            MainNpc.TurnNeck(10, false)
            EventFlowSystemActor@sub.WaitFrame(15)
            Player.TurnNeck(1, false)
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_03_02', false)
        branch:
            EventFlowSystemActor.WaitFrame(90)
            Npc_2.TurnNeck(0, false)
            Npc_2.CharacterEmoticonAction('Nodding', true, '', 0, false)
        branch:
            EventFlowSystemActor@sub.WaitFrame(30)
            Player.TurnNeck(0, false)
    fork:
        branch:
            SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_03_03', false)
        branch:
            EventFlowSystemActor.WaitFrame(30)
            Npc_2.TurnNeck(1, false)
        branch:
            EventFlowSystemActor@sub.WaitFrame(15)
            Player.TurnNeck(1, false)
    MainNpc.TurnNeck(10, false)
    fork:
        branch:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_03_06', true)
        branch:
            SubNpc.TurnNeck(0, false)
            EventFlowSystemActor.WaitFrame(30)
            Npc_2.TurnNeck(0, false)
        branch:
            EventFlowSystemActor@sub.WaitFrame(15)
            Player.TurnNeck(0, false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:053_03_07', false)

flow HospitalEdit():
    SubflowResults[0] = 3
    EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cHospital')
    if (System.EventFlags['cWherearenPlayer:Unlock_Extension_Hospital']) and (not EventFlowSystemActor.WherearenIsExpandedFacility('cHospital')):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_02', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_19', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cHospital', 'cExpand')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameHospital()
            case 2:
                run FacilityEditCancel()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_01', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_15', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cHospital', 'cReform')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameHospital()
            case 2:
                run FacilityEditCancel()

flow HouseCompleteActing():
    MainNpc.TurnNeck(10, false)
    EventFlowSystemActor.WaitFrame(30)
    if (System.EventFlags['cWherearenPlayer:MncMovetoBridge']) and ((not System.EventFlags['cWherearenPlayer:MncGenerateInOfficeTemp']) or (System.EventFlags['cWherearenPlayer:MncEntryOfficeReserve']) or (System.EventFlags['cWherearenPlayer:NpcGeneratePreDustClothTemp'])):
        MainNpc.NpcMoveDirection(270.0, 10.0, 0, false, true)
        MainNpc.TurnBody(10, 0.0)
        MainNpc.NpcWaitTurn()
    else:
        MainNpc.NpcMoveDirection(270.0, 5.0, 0, false, true)

flow KKFesPrePareCheck():
    if (System.EventFlags['cWherearenPlayer:SeqKKRave1stDone']) or (System.EventFlags['cWherearenPlayer:NewBuildCount'] < 26):
        System.EventFlags['cWherearenPlayer:KKFesPrePare'] = 0
    elif System.EventFlags['cWherearenPlayer:NewBuildCount'] < 29:
        System.EventFlags['cWherearenPlayer:KKFesPrePare'] = 1
    else:
        System.EventFlags['cWherearenPlayer:KKFesPrePare'] = 2

flow LookforHouseMate():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:002', false)

flow NormalChoice():
    run Event429()

flow NotWorkReturn():
    System.EventFlags['cWherearenPlayer:VisitHouseReturn'] = false
    if System.EventFlags['cWherearenPlayer:ReturnWithOtg']:
        System.EventFlags['cWherearenPlayer:ReturnWithOtg'] = false
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:201_03', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:201_02', false)

flow OrderClose_Canceled():
    EventFlowSystemActor.WherearenOrderCallback('cFinish')
    if not Player.PlayerIsReserveAnySimpleMutter():
        switch SubflowResults@3[3]:
            case 0:
entrypoint Event202:
                Player.TurnNeck(11, false)
                Player.TurnBody(11, 0.0)
                run OrderClose_EndTalk()
                EventFlowSystemActor.ChangeWherearenWorkMode(true, true)
                run GradeE_Chk()
                EventFlowSystemActor.WherearenResetGradeUp()
            case 1:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:204', false)
                run Sub_grp_Event217()
            case 2:
entrypoint Event540:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:208', false)
                run Sub_grp_Event217()

flow OrderClose_Complete():
    switch EventFlowSystemActor.WherearenOrderInfoType():
        case 0:
            switch EventFlowSystemActor.WherearenNpcOrderType():
                case 0:
                    if (EventFlowSystemActor.WherearenIsCustomerBuildNewHouse()) and (EventFlowSystemActor.IsBuiltNewHouseForEndShareHouse()):
                        run Sub_Event161()
                    else:
                        System.EventFlags['cWherearenPlayer:NewBuildCount'] += 1
                        run KKFesPrePareCheck()
                        if System.EventFlags['cWherearenPlayer:SeqKKRave1stDone']:
                            System.EventFlags['cWherearenPlayer:AfterFirstKKFesCount'] += 1
                            run Sub_Event161()
                        else:
                            run Sub_Event161()
                case 1:
                    System.EventFlags['cWherearenPlayer:ShareHouseDoneCount'] += 1
                    run Sub_Event161()
                case 2, 3:
                    run Sub_Event161()
        case 1:
            run Sub_Event161()
        default:
            return

flow OrderClose_EndTalk():
    EventFlowSystemActor.SetWherearenPlayerRemoveBinderSeq(false, false)

flow Otg_ReturnHomePos():
    if not Player.PlayerIsReserveAnySimpleMutter():
        MainNpc.NpcSetAIBlackBoard('IsReturnHouseCompleteActing', 1)

flow PartyF_Chk():
    if EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') == 5:
        run SNPC_otg_18_WherearenEvent_Party::PartyF()

flow PayNotice():
    switch EventFlowSystemActor.WherearenOrderInfoType():
        case 0:
            switch EventFlowSystemActor.WherearenNpcOrderType():
                case 0:
                    if (EventFlowSystemActor.IsWherearenNpcOrderNewBuildType()) and (EventFlowSystemActor.WherearenIsApproachOrder()):
                        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_10', false)
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051', false)
                case 1:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051', false)
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_03', false)
                case 3:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_05', false)
        case 1:
            EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cEditNow')
            switch EventFlowSystemActor.WherearenFacilityOrderType():
                case 1:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_08', false)
                case 2:
                    switch EventFlowSystemActor.WherearenFacilityTypeOnOrder():
                        case 1:
                            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_13', false)
                        case 2:
                            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_11', false)
                        case 3:
                            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:051_12', false)
                        default:
                            return
                default:
                    return
        default:
            return

flow PostSalary():
    if (EventFlowSystemActor.WherearenOrderInfoType() == 1) and (EventFlowSystemActor.WherearenFacilityOrderType() == 2) and (EventFlowSystemActor.WherearenFacilityTypeOnOrder() == 3):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:054', false)

flow RainbowRandom():
    if System.EventFlags['cWherearenPlayer:RainbowReserve'] < 1:
        System.EventFlags['cWherearenPlayer:RainbowProbability'] += 10
        switch EventFlowSystemActor.EventFlagSystemRandom('cWherearenPlayer:RainbowProbability', 100):
            case 0:
                System.EventFlags['cWherearenPlayer:RainbowReserve'] = 0
            case 1:
                if EventFlowSystemActor.PercentChoice(30):
                    System.EventFlags['cWherearenPlayer:RainbowReserve'] = 2
                else:
                    System.EventFlags['cWherearenPlayer:RainbowReserve'] = 1
                System.EventFlags['cWherearenPlayer:RainbowProbability'] = 0
            default:
                return

flow RestaurantEdit():
    SubflowResults[0] = 1
    EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cRestaurant')
    if (System.EventFlags['cWherearenPlayer:Unlock_Extension_Restaurant']) and (not EventFlowSystemActor.WherearenIsExpandedFacility('cRestaurant')):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_02', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_17', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cRestaurant', 'cExpand')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameRestaurant()
            case 2:
                run FacilityEditCancel()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_01', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_13', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    EventFlowSystemActor.WherearenTakeOnFacilityOrder('cRestaurant', 'cReform')
                    run GoToFacility()
                else:
                    run FacilityEditCancel()
            case 1:
                run SetNameRestaurant()
            case 2:
                run FacilityEditCancel()

flow RestaurantEdit_NewBuild():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_04', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        EventFlowSystemActor.WherearenTakeOnFacilityOrder('cRestaurant', 'cNew')
        SubflowResults[1] = 1
        System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe'] = true
        run GoToFacility()
    else:
        run FacilityEditCancel()

flow Root():
    run StoryEventChk()
    if not EventFlowSystemActor.IsWherearenWorkMode():
        run StoryEventChkSelect()
        if not System.EventFlags['cWherearenPlayer:Unlock_Faclility_School']:
            if System.EventFlags['cWherearenPlayer:TodayCompleteCount'] < 1:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_05', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run StartWork()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_02', true)
        elif EventFlowSystemActor.WherearenKKFesStatus(false) in (0, 1, 3):
            if System.EventFlags['cWherearenPlayer:TodayCompleteCount'] < 1:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_02', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_06', false)
entrypoint Event429:
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run StartWork()
                case 1:
                    run EditFacility()
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_02', true)
        else:
            if System.EventFlags['cWherearenPlayer:TodayCompleteCount'] < 1:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_04', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_07', false)
            switch EventFlowSystemActor.GeneralTalkChoice4():
                case 0:
                    run StartWork()
                case 1:
                    run EditFacility()
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_03', true)
                    run Demo_Common_Wherearen::ToKKFesDemoLive()
                case 3:
                    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_02', true)
    elif not System.EventFlags['cWherearenPlayer:Unlock_Faclility_School']:
        if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:001_03', true)
        elif System.EventFlags['cWherearenPlayer:TodayCompleteCount'] < 1:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:001_01', true)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:001_02', true)
    elif EventFlowSystemActor.WherearenKKFesStatus(false) in (0, 1, 3):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            run EditFacility()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_02', true)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_03', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                run EditFacility()
            case 1:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_03', true)
                run Demo_Common_Wherearen::ToKKFesDemoLive()
            case 2:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_02', true)

flow Root_Init():
    if System.EventFlags['cWherearenPlayer:SeqMncDIYRecipeOngoing']:
        MainNpc.NpcAITalkSubCastEntry('man', 1)
    else:
        run SNPC_otg_22_WherearenEvent_ShareHouse::CastChk()

flow Salary():
    EventFlowSystemActor.UIPokiAppear()
    switch EventFlowSystemActor.WherearenOrderInfoType():
        case 0:
            if EventFlowSystemActor.WherearenNpcOrderType() == 0:
                EventFlowSystemActor.WherearenCheckGradeUp()
                if EventFlowSystemActor.WherearenIsGradeUp():
                    run GradeUp()
                    run Sub_Event113()
                else:
                    run Sub_Event113()
            else:
                run Sub_Event641()
        case 1, 4294967295:
            run Sub_Event641()
        default:
            return

flow SchoolEdit():
    SubflowResults[0] = 0
    EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cSchool')
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_01', false)
entrypoint Event33:
    switch EventFlowSystemActor.GeneralTalkChoice3():
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_12', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                EventFlowSystemActor.WherearenTakeOnFacilityOrder('cSchool', 'cReform')
                run GoToFacility()
            else:
                run FacilityEditCancel()
        case 1:
            run SetNameSchool()
        case 2:
            run FacilityEditCancel()

flow SchoolEdit_Direct():
    SubflowResults[0] = 0
    EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cSchool')
    run Event33()

flow SetNameCafe():
    if EventFlowSystemActor.WherearenExistFacilityName('cCafe'):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacility', 0, 'cCafe')
        run SetNameFacility_AlreadySet()
    else:
        run SetNameFacility_New()

flow SetNameCafeGallery():
    if EventFlowSystemActor.ExistWherearenFacilityRoomName('cCafe'):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityRoom', 0, 'cCafe')
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:021', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:022', false)
            run Sub_Event522()
        else:
            run Sub_Event526()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:027', true)
        run Sub_Event522()

flow SetNameFacility_AlreadySet():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:018', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:019', false)
entrypoint Event106:
        switch SubflowResults@5[0]:
            case 0:
                EventFlowSystemActor.UISoftwareKeyboardFacilitiesNameHandling(0, true)
            case 1:
                EventFlowSystemActor.UISoftwareKeyboardFacilitiesNameHandling(2, true)
            case 2:
                EventFlowSystemActor.UISoftwareKeyboardFacilitiesNameHandling(3, true)
            case 3:
                EventFlowSystemActor.UISoftwareKeyboardFacilitiesNameHandling(1, true)
            case 4:
                EventFlowSystemActor.UISoftwareKeyboardFacilitiesNameHandling(4, true)
        if EventFlowSystemActor.UIResultMenuDecide():
            EventFlowSystemActor.SetTagFromUIResult('cWherearenSwkbdFacilityName', 0)
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:013', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:014', false)
                EventFlowSystemActor.SaveSetFromUIResult('cFacilitiesName')
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:015', false)
                run SetNameFacility_Input()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:020', true)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:020', true)

flow SetNameFacility_Input():
    run Event106()

flow SetNameFacility_New():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:012', true)
    run Event106()

flow SetNameHospital():
    if EventFlowSystemActor.WherearenExistFacilityName('cHospital'):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacility', 0, 'cHospital')
        run SetNameFacility_AlreadySet()
    else:
        run SetNameFacility_New()

flow SetNameRestaurant():
    if EventFlowSystemActor.WherearenExistFacilityName('cRestaurant'):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacility', 0, 'cRestaurant')
        run SetNameFacility_AlreadySet()
    else:
        run SetNameFacility_New()

flow SetNameSchool():
    if EventFlowSystemActor.WherearenExistFacilityName('cSchool'):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacility', 0, 'cSchool')
        run SetNameFacility_AlreadySet()
    else:
        run SetNameFacility_New()

flow SetNameTailor():
    if EventFlowSystemActor.WherearenExistFacilityName('cTailor'):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacility', 0, 'cTailor')
        run SetNameFacility_AlreadySet()
    else:
        run SetNameFacility_New()

flow SetSalaryForEvent():
    EventFlowSystemActor.WherearenDecideSalary()
    EventFlowSystemActor.WherearenUnreceivedPayTagSet(0)
    EventFlowSystemActor.UIPokiAppear()

flow StartWork():
    run StoryEventChkAtWork()
    if System.EventFlags['cWherearenPlayer:TodayCompleteCount'] < 1:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004', true)
        EventFlowSystemActor.ChangeWherearenWorkMode(false, true)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_00', true)
    else:
        if SubflowResults@2[5] == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_04', true)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004', true)
        EventFlowSystemActor.ChangeWherearenWorkMode(false, true)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_05', true)

flow StoryEventChk():
    if not System.EventFlags['cWherearenPlayer:Unlock_MncBridgeBoat']:
        if EventFlowSystemActor.IsWherearenWorkMode():
            if System.EventFlags['cWherearenPlayer:SeqFirstVistCustomerOngoing']:
                run SNPC_otg_11_WherearenEvent_StartWork::Talk__FirstVisitCustomer()
            else:
                run SNPC_otg_11_WherearenEvent_StartWork::Talk_TakeOder()
            EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cWherearenPlayer:SeqMncDIYRecipeOngoing']:
        run SNPC_otg_17_WherearenEvent_DIYCatalog::EndTalk()
        EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cWherearenPlayer:SeqDIYCatalogOngoing']:
        run SNPC_otg_17_WherearenEvent_DIYCatalog::EndTalk_Catalog()
        EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cWherearenPlayer:SeqEnvSoundOngoing']:
        run SNPC_otg_30_WherearenEvent_EnvSound::EndTalk()
        EventFlowSystemActor.ExitFlowchart()
    elif (not System.EventFlags['cWherearenPlayer:Unlock_Extension_Hospital']) and (not System.EventFlags['cWherearenPlayer:CompleteHospitalDonation_Today']) and (System.EventFlags['cWherearenPlayer:CompleteHospitalDonation']):
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:303', false)
        System.EventFlags['cWherearenPlayer:Unlock_Extension_Hospital'] = true
        EventFlowSystemActor.ExitFlowchart()

flow StoryEventChkAtWork():
    if System.EventFlags['cWherearenPlayer:NewBuildCount'] == 1:
        run StoryEvent_WorkModeOn()
        run SNPC_otg_11_WherearenEvent_StartWork::Root_TakeOder()
        run OrderClose_EndTalk()
        EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cWherearenPlayer:NewBuildCount'] == 2:
        if System.EventFlags['cWherearenPlayer:Unlock_MncBridgeBoat']:
            run SNPC_otg_32_WherearenEvent_PhoneCall::Preparation()
        else:
            run StoryEvent_WorkModeOn()
            run SNPC_otg_11_WherearenEvent_StartWork::Root_FirstVisitCustomer()
            run OrderClose_EndTalk()
            EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cWherearenPlayer:NewBuildCount'] != 6:
        if System.EventFlags['cWherearenPlayer:NewBuildCount'] == 7:
            run SNPC_otg_16_WherearenEvent_Kabetasu::Preparation()
        run Demo_Common_Wherearen::StoryEventChk_StartingWork()
        switch SubflowResults@9[16]:
            case 1:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_14_WherearenEvent_Amiibo::Root()
                run OrderClose_EndTalk()
                if SubflowResults@2[4] != 0:
                    run Otg_ReturnHomePos()
                EventFlowSystemActor.ExitFlowchart()
            case 2:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_19_WherearenEvent_RestaurantCafe::Root()
                run Sub_Event581()
            case 3:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_22_WherearenEvent_ShareHouse::Root()
                run Sub_Event581()
            case 4:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_24_WherearenEvent_OtgSick::Root()
                run Sub_Event581()
            case 5:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_20_WherearenEvent_Hospital::Root()
                run Sub_Event581()
            case 6:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_19_WherearenEvent_RestaurantCafe::Root_2nd()
                run Sub_Event581()
            case 7:
                run StoryEvent_WorkModeOn()
                run SNPC_otg_21_WherearenEvent_Tailor::Root()
                run Sub_Event581()
            case 8:
                run CreateSchool()
            default:
                return
    else:
        if not System.EventFlags['cWherearenPlayer:Unlock_Faclility_School']:
            run CreateSchool()

flow StoryEventChkSelect():
    run Demo_Common_Wherearen::StoryEventChk_StartingWork()
    if SubflowResults@9[16] in (0, 1, 2, 3, 4, 5, 6, 8):
        if (not System.EventFlags['cWherearenPlayer:OtgTalkAfterParty2']) and (System.EventFlags['cWherearenPlayer:SeqParty2Done']) and (not System.EventFlags['cWherearenPlayer:SeqKKRaveStageDone']):
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_10', false)
            System.EventFlags['cWherearenPlayer:OtgTalkAfterParty2'] = true
            SubflowResults[5] = 1
            run Sub_Event609()
    else:
        if System.EventFlags['cWherearenPlayer:OtgTalkTodayJustBeforeTailor']:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_09', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:003_08', false)
            System.EventFlags['cWherearenPlayer:OtgTalkTodayJustBeforeTailor'] = true
        run Sub_Event609()

flow StoryEvent_WorkModeOn():
    if EventFlowSystemActor.IsWherearenWorkMode():
        EventFlowSystemActor.UISaveIconAppear()
        EventFlowSystemActor.SaveSimpleSave('cAll')
        EventFlowSystemActor.UISaveIconDisappear()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:207', false)
        SubflowResults[4] = 1
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:004_01', true)
        EventFlowSystemActor.ChangeWherearenWorkMode(false, true)

local flow Sub_Event113():
    EventFlowSystemActor.WherearenDecideSalary()
    EventFlowSystemActor.WherearenUnreceivedPayTagSet(0)
    run Comment_SalaryNotice()
    run GetSalaryForEvent()

local flow Sub_Event114():
    EventFlowSystemActor.ReservePlayerMutterDemo('Player_GetDemo_Wherearen', 'Salary_GetDemo', 'cNowDemoEnd', false)
    EventFlowSystemActor.SetNpcAIBlackBoardByLabel('otg', 'WaitMutter', 1, 0)
    if EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') not in (0, 1, 2, 4, 5, 6):
        EventFlowSystemActor.SetNpcAIBlackBoardByLabel('mnc', 'WaitMutter', 1, 0)
    MainNpc.NpcAISetting(4, false)

local flow Sub_Event161():
    System.EventFlags['cWherearenPlayer:TodayCompleteCount'] += 1
    run OrderClose_Canceled()

local flow Sub_Event21():
    run Salary()
    run PostSalary()
    if (not EventFlowSystemActor.WherearenIsGradeUp()) or (EventFlowSystemActor.FlagSystemIntValue7(7, 'cWherearenPlayer:CoordinatorGrade') in (0, 1, 2, 3, 4, 6)):
        SubflowResults[3] = 1
        run OrderClose_Complete()
        run Otg_ReturnHomePos()

local flow Sub_Event522():
    EventFlowSystemActor.UISoftwareKeyboardFacilitiesNameHandling(-1, true)
    if EventFlowSystemActor.UIResultMenuDecide():
        EventFlowSystemActor.SetTagFromUIResult('cWherearenSwkbdFacilityName', 0)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:023', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:024', true)
            EventFlowSystemActor.SaveSetFromUIResult('cFacilitiesName')
            return
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:025', true)
            run Sub_Event522()
    else:
        run Sub_Event526()

local flow Sub_Event526():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:026', false)

local flow Sub_Event568():
    SubflowResults[3] = 1
    run OrderClose_Canceled()

local flow Sub_Event581():
    run OrderClose_EndTalk()
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event609():
    run NormalChoice()
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event641():
    EventFlowSystemActor.WherearenResetGradeUp()
    run Sub_Event113()

local flow Sub_grp_Event217():
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:205', true)
        run Event202()
    else:
        run StoryEventChkAtWork()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:206', true)
        run OrderClose_EndTalk()

flow TailorEdit():
    SubflowResults[0] = 4
    EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacilityNormal', 0, 'cTailor')
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_01', false)
    switch EventFlowSystemActor.GeneralTalkChoice3():
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_01_WherearenOffice:006_16', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                EventFlowSystemActor.WherearenTakeOnFacilityOrder('cTailor', 'cReform')
                run GoToFacility()
            else:
                run FacilityEditCancel()
        case 1:
            run SetNameTailor()
        case 2:
            run FacilityEditCancel()

