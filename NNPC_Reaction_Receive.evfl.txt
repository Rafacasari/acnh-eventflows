flow ChristmasGetItem():
    if MainNpc.EventFlags['cNpcMemory:ChristmasCannotGetNnpcItemFlag']:
        if MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
            run NNPC_Reaction_Sitting::StandingUp_Chk()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Christmas:001', false)
            if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Christmas:003', false)
                EventFlowSystemActor.ExitFlowchart()
            else:
                MainNpc.SetDeliveryItemAtRandom(13357, true, 'cVillageRemakePattern', 0)
                MainNpc.NpcDelivery(1, 'Default')
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Christmas:002', false)
                MainNpc.EventFlags['cNpcMemory:ChristmasCannotGetNnpcItemFlag'] = false
                System.EventFlags['cPlayer:ChristmasWreathNoGetFlag'] = false
                EventFlowSystemActor.SetChristmasWreathGetYear()
                EventFlowSystemActor.ExitFlowchart()

flow EasterGetRecipe():
    if not MainNpc.EventFlags['cNpcMemory:EasterCannotGetNnpcRecipeFlag']:
        if (System.EventFlags['cPlayer:PynExplainNnpcRecipeFlag']) and (not System.EventFlags['cPlayer:EasterCannotGetNnpcRecipeFlag']) and (not MainNpc.EventFlags['cNpcMemory:EasterGetRecipeFlag']) and (System.EventFlags['cPlayer:EasterNnpcRecipeCount'] < 2):
            if MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
                MainNpc.EventFlags['cNpcMemory:StandingUpFlag'] = true
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:101', false)
                EventFlowSystemActor.ExitFlowchart()
            else:
                if System.EventFlags['cPlayer:EasterNnpcRecipeCount'] < 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:020', false)
                    run NNPC_ApproachG_Easter::GetEasterRecipe1()
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:021', false)
                    run NNPC_ApproachG_Easter::GetEasterRecipe2()
                MainNpc.SetEasterApproachVillagerIndex(0)
                EventFlowSystemActor.ExitFlowchart()
    elif MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
        MainNpc.EventFlags['cNpcMemory:StandingUpFlag'] = true
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:100', false)
        EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cPlayer:EasterNnpcRecipeCount'] >= 1:
        if (EventFlowSystemActor.PlayerHasCraftRecipe('', 12447)) and (not MainNpc.EventFlags['cNpcMemory:EasterCannotGetNnpcIsRecipeFlag']):
            run EasterNpc_GetEgg_Recieve()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:002', false)
            MainNpc.NpcSetRewardRecipe(12447, false)
            run Sub_grp_Event2()
    elif (EventFlowSystemActor.PlayerHasCraftRecipe('', 12445)) and (not MainNpc.EventFlags['cNpcMemory:EasterCannotGetNnpcIsRecipeFlag']):
        run EasterNpc_GetEgg_Recieve()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:001', false)
        MainNpc.NpcSetRewardRecipe(12445, false)
        run Sub_grp_Event2()

flow EasterNpc_GetEgg_Recieve():
    if System.EventFlags['cPlayer:EasterNnpcRecipeCount'] < 1:
        EventFlowSystemActor.SelectRewardItemDirect(12514, 5, 'cVillageRemakePattern', 0)
    else:
        EventFlowSystemActor.SelectRewardItemDirect(12513, 5, 'cVillageRemakePattern', 0)
    MainNpc.SetItemName(1, 0, 0)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:200', false)
    if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
        MainNpc.EventFlags['cNpcMemory:EasterCannotGetNnpcRecipeFlag'] = false
        System.EventFlags['cPlayer:EasterCannotGetNnpcRecipeFlag'] = false
        MainNpc.SetDeliveryItem(1, true)
        MainNpc.MessageSuspend()
        MainNpc.NpcDelivery(1, 'Default')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:201', false)
        System.EventFlags['cPlayer:EasterNnpcRecipeCount'] += 1
        MainNpc.EventFlags['cNpcMemory:EasterGetRecipeFlag'] = true
        EventFlowSystemActor.ExitFlowchart()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:202', false)
        EventFlowSystemActor.ExitFlowchart()

flow FireworksGetItem():
    if MainNpc.IsFirewoksApproachNpc():
        if not MainNpc.EventFlags['cNpcMemory:FireworksCannotGetNnpcItemFlag']:
            if not ((EventFlowSystemActor.EventCheck('Fireworks') != 1) or (System.EventFlags['cPlayer:FireworkCannotGetNnpcItemFlag']) or (MainNpc.EventFlags['cNpcMemory:FireworksGetItemFlag'])):
                if MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
                    MainNpc.EventFlags['cNpcMemory:StandingUpFlag'] = true
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:101', false)
                    EventFlowSystemActor.ExitFlowchart()
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:020', false)
                    run NNPC_ApproachG_Fireworks::GetFireworksItem()
                    MainNpc.EventFlags['cNpcMemory:FireworksGetItemFlag'] = true
                    EventFlowSystemActor.ExitFlowchart()
        elif MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
            MainNpc.EventFlags['cNpcMemory:StandingUpFlag'] = true
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:100', false)
            EventFlowSystemActor.ExitFlowchart()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:001', false)
            if EventFlowSystemActor.PercentChoice(50):
                run FireworksSet_Red()
                if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 5743):
                    run Sub_Event35()
                else:
                    run FireworksSet_Blue()
                    if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 12974):
                        run Sub_Event35()
                    else:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:011', false)
            else:
                run FireworksSet_Blue()
                if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 12974):
                    run Sub_Event35()
                else:
                    run FireworksSet_Red()
                    if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 5743):
                        run Sub_Event35()
                    else:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:011', false)
            EventFlowSystemActor.ExitFlowchart()

flow FireworksSet_Blue():
    MainNpc.SetDeliveryItemAtRandom(12974, true, 'cVillageRemakePattern', 0)

flow FireworksSet_Red():
    MainNpc.SetDeliveryItemAtRandom(5743, true, 'cVillageRemakePattern', 0)

flow Root():
    run EasterGetRecipe()
    run FireworksGetItem()
    run ChristmasGetItem()

local flow Sub_Event35():
    MainNpc.NpcDelivery(1, 'Default')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Fireworks:010', false)
    MainNpc.EventFlags['cNpcMemory:FireworksCannotGetNnpcItemFlag'] = false
    System.EventFlags['cPlayer:FireworkCannotGetNnpcItemFlag'] = false
    MainNpc.EventFlags['cNpcMemory:FireworksGetItemFlag'] = true

local flow Sub_grp_Event2():
    if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:011', false)
    else:
        MainNpc.EventFlags['cNpcMemory:EasterCannotGetNnpcRecipeFlag'] = false
        MainNpc.EventFlags['cNpcMemory:EasterCannotGetNnpcIsRecipeFlag'] = false
        System.EventFlags['cPlayer:EasterCannotGetNnpcRecipeFlag'] = false
        MainNpc.SetDeliveryItem(1, true)
        MainNpc.NpcDelivery(1, 'Default')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_Receive_Easter:010', false)
        System.EventFlags['cPlayer:EasterNnpcRecipeCount'] += 1
        MainNpc.EventFlags['cNpcMemory:EasterGetRecipeFlag'] = true
    EventFlowSystemActor.ExitFlowchart()

