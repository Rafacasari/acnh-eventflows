flow Root():
    EventFlowSystemActor.WaitFrame(20)
    if System.EventFlags['cPlayer:SnowmanBuildFlag']:
        run Snowman_Built()
    else:
        System.EventFlags['cPlayer:SnowmanBuildFlag'] = true
        System.EventFlags['cPlayer:SnowmanFirstBuildTodayFlag'] = true
        run Snowman_FirstBuild()

flow Root_Talk():
    run Snowman_Chk()
    run Snowman_Chat()

flow Snowman_Built():
    switch SnowMan.SnowManGrade():
        case 0:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:001', false)
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:010', false)
            System.EventFlags['cLifeSupportAchievement:MakePerfectSnowball'] += 1
            if EventFlowSystemActor.PlayerHasCraftRecipe('Snowman', 65534):
                if EventFlowSystemActor.IsMadeCraftUnlockRecipe('Snowman', 'cAND'):
                    SnowMan.DecideEventReward('cSnowmanReward')
                    switch EventFlowSystemActor.RandomChoice5(5):
                        case 0:
                            EventFlowSystemActor.SystemMailSend('cSnowman', 'MAIL_SP_Snowman', 1, 'cNone', 'cFastTomorrow', 'cReward', false, false)
                        case 1:
                            EventFlowSystemActor.SystemMailSend('cSnowman', 'MAIL_SP_Snowman', 2, 'cNone', 'cFastTomorrow', 'cReward', false, false)
                        case 2:
                            EventFlowSystemActor.SystemMailSend('cSnowman', 'MAIL_SP_Snowman', 3, 'cNone', 'cFastTomorrow', 'cReward', false, false)
                        case 3:
                            EventFlowSystemActor.SystemMailSend('cSnowman', 'MAIL_SP_Snowman', 4, 'cNone', 'cFastTomorrow', 'cReward', false, false)
                        case 4:
                            EventFlowSystemActor.SystemMailSend('cSnowman', 'MAIL_SP_Snowman', 5, 'cNone', 'cFastTomorrow', 'cReward', false, false)
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:016', false)
                    run Sub_Event17()
                elif EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:017', false)
                    run Sub_Event111()
                else:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:018', false)
                    EventFlowSystemActor.ExitFlowchart()
            elif System.EventFlags['cPlayer:MainmenuRecipe']:
                EventFlowSystemActor.DecideOpenCraftRecipe('cRewardSnowman')
                EventFlowSystemActor.OpenSelectedSequenceCraftRecipe()
                EventFlowSystemActor.SetTagFromSystem('cRewardSnowMan', 'cDegit', 0, 0, '')
                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:011', false)
                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:013', false)
                run Sub_Event159()
            elif EventFlowSystemActor.PlayerHouseLevel() == `Homeless`:
                if (System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']) and (System.EventFlags['cPlayer:NotBuilt2PMyHomeAfterMoving']):
                    run Snowman_GiveSnowCrystal_MovingSubP()
                else:
                    run Sub_Event201()
            else:
entrypoint Event229:
                if System.EventFlags['cPlayer:SnowmanDIYMailFlag']:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:108', false)
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:109', false)
                    run Sub_Event159()
                else:
                    run Sub_Event201()
        case 1:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:002', false)
            EventFlowSystemActor.ExitFlowchart()
        case 2:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:003', false)
            EventFlowSystemActor.ExitFlowchart()
        case 3:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:004', false)
            EventFlowSystemActor.ExitFlowchart()

flow Snowman_Chat():
    if EventFlowSystemActor.IsMyVillage():
        run Snowman_Chat_HostP()
    else:
        run Snowman_Chat_GuestP()

flow Snowman_Chat_Always():
    switch SnowMan.SnowManAge():
        case 0:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:056', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:057', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:058', false)
        case 1:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:059', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:060', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:061', false)
        case 2:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:062', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:063', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:064', false)
        case 3:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:065', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:066', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:067', false)

flow Snowman_Chat_Grade():
    switch SnowMan.SnowManGrade():
        case 0:
            switch SnowMan.SnowManAge():
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:068', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:069', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:070', false)
                case 3:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:071', false)
        case 1:
            switch SnowMan.SnowManAge():
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:072', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:073', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:074', false)
                case 3:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:075', false)
        case 2:
            switch SnowMan.SnowManAge():
                case 0:
                    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                        case 0:
                            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:076', false)
                        case 1:
                            run Sub_grp_Event122()
                        case 2:
                            run Sub_grp_Event73()
                case 1:
                    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                        case 0:
                            run Sub_grp_Event122()
                        case 1:
                            run Sub_grp_Event73()
                        case 2:
                            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:077', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:078', false)
                case 3:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:079', false)
        case 3:
            switch SnowMan.SnowManAge():
                case 0:
                    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                        case 0:
                            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:084', false)
                        case 1:
                            run Sub_grp_Event130()
                        case 2:
                            run Sub_grp_Event175()
                case 1:
                    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                        case 0:
                            run Sub_grp_Event130()
                        case 1:
                            run Sub_grp_Event175()
                        case 2:
                            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:085', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:086', false)
                case 3:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:087', false)

flow Snowman_Chat_GuestP():
    if SnowMan.SnowManIsSnowMeltSeason():
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:201', false)
    else:
        if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, false) == 0:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:211', false)
        if EventFlowSystemActor.PercentChoice(70):
            switch SnowMan.SnowManGrade():
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:202', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:203', false)
                case 2, 3:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:204', false)
        else:
            switch SnowMan.SnowManAge():
                case 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:205', false)
                case 1:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:206', false)
                case 2:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:207', false)
                case 3:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:208', false)

flow Snowman_Chat_HostP():
    if SnowMan.SnowManIsSnowMeltSeason():
        switch SnowMan.SnowManAge():
            case 0, 1:
                if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, false) == 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:050', false)
                else:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:051', false)
            case 2:
                if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, false) == 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:052', false)
                else:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:053', false)
            case 3:
                if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, false) == 0:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:054', false)
                else:
                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:055', false)
    elif SnowMan.SnowManGrade() in (0, 1):
        run Sub_grp_Event26()
    else:
        switch SnowMan.SnowManAge():
            case 0:
                if System.EventFlags['cPlayer:SnowmanFirstBuildTodayFlag']:
                    run Snowman_Chat_Always()
                else:
                    if EventFlowSystemActor.PercentChoice(55):
                        run Snowman_Chat_Always()
                    else:
                        run Snowman_Chat_Grade()
            case 1:
                if EventFlowSystemActor.PercentChoice(55):
                    run Snowman_Chat_Always()
                else:
                    run Snowman_Chat_Grade()
            case 2, 3:
                run Sub_grp_Event26()

flow Snowman_Chk():
    if EventFlowSystemActor.IsMyVillage():
        if SnowMan.SnowManGrade() == 0:
            switch SnowMan.SnowManAge():
                case 0:
                    if not System.EventFlags['cPlayer:SnowmanGotDay1Flag']:
                        if SnowMan.IsMadeSnowManPlayer():
                            if EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
                                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:030', false)
                                EventFlowSystemActor.SetItemToPocket(3540, 1)
                                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:032', false)
                                if System.EventFlags['cPlayer:MainmenuRecipe']:
                                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:020', false)
                                else:
                                    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:113', false)
                                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:021', false)
                                run Sub_Event193()
                        elif EventFlowSystemActor.PlayerHasCraftRecipe('Snowman', 65534):
                            if EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
                                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:034', false)
                                EventFlowSystemActor.SetItemToPocket(3540, 1)
                                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:032', false)
                                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:020', false)
                                run Sub_Event193()
                        elif System.EventFlags['cPlayer:MainmenuRecipe']:
                            EventFlowSystemActor.DecideOpenCraftRecipe('cRewardSnowman')
                            EventFlowSystemActor.OpenSelectedSequenceCraftRecipe()
                            EventFlowSystemActor.SetTagFromSystem('cRewardSnowMan', 'cDegit', 0, 0, '')
                            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:033', false)
                            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:012', false)
                            run Sub_Event193()
                case 1:
                    if (not System.EventFlags['cPlayer:SnowmanGotDay2Flag']) and (SnowMan.IsMadeSnowManPlayer()) and (EventFlowSystemActor.ShoppingCapacity('cItemName', 3540)):
                        EventFlowSystemActor.SetItemToPocket(3540, 1)
                        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:040', false)
                        System.EventFlags['cPlayer:SnowmanGotDay2Flag'] = true
                        EventFlowSystemActor.ExitFlowchart()
                case 2:
                    if (not System.EventFlags['cPlayer:SnowmanGotDay3Flag']) and (SnowMan.IsMadeSnowManPlayer()) and (EventFlowSystemActor.ShoppingCapacity('cItemName', 3540)):
                        EventFlowSystemActor.SetItemToPocket(3540, 1)
                        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:041', false)
                        System.EventFlags['cPlayer:SnowmanGotDay3Flag'] = true
                        EventFlowSystemActor.ExitFlowchart()
                case 3:
                    if (not System.EventFlags['cPlayer:SnowmanGotDay4Flag']) and (SnowMan.IsMadeSnowManPlayer()) and (EventFlowSystemActor.ShoppingCapacity('cItemName', 3540)):
                        EventFlowSystemActor.SetItemToPocket(3540, 1)
                        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:042', false)
                        System.EventFlags['cPlayer:SnowmanGotDay4Flag'] = true
                        EventFlowSystemActor.ExitFlowchart()
        elif (System.EventFlags['cPlayer:SnowmanFirstBuildTodayFlag']) and (not System.EventFlags['cPlayer:SnowmanGotDay1Flag']) and (EventFlowSystemActor.ShoppingCapacity('cItemName', 3540)):
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:030', false)
            EventFlowSystemActor.SetItemToPocket(3540, 1)
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:032', false)
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:015', false)
            System.EventFlags['cPlayer:SnowmanGotDay1Flag'] = true
            EventFlowSystemActor.ExitFlowchart()

flow Snowman_FirstBuild():
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:100', false)
    if System.EventFlags['cPlayer:MainmenuRecipe']:
        if EventFlowSystemActor.PlayerHasCraftRecipe('Snowman', 65534):
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:017', false)
            run Sub_Event105()
        else:
            EventFlowSystemActor.DecideOpenCraftRecipe('cRewardSnowman')
            EventFlowSystemActor.OpenSelectedSequenceCraftRecipe()
            EventFlowSystemActor.SetTagFromSystem('cRewardSnowMan', 'cDegit', 0, 0, '')
            if SnowMan.SnowManGrade() == 0:
                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:011', false)
                run Sub_Event174()
            else:
                SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:101', false)
                run Sub_Event174()
    elif EventFlowSystemActor.PlayerHouseLevel() != `Homeless`:
entrypoint Event112:
        EventFlowSystemActor.DecideEventRewardDIYRecipe('Snowman')
        EventFlowSystemActor.SystemMailSend('cSnowman', 'MAIL_SP_Snowman', 6, 'cNone', 'cFastTomorrow', 'cReward', false, false)
        System.EventFlags['cPlayer:SnowmanDIYMailFlag'] = true
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:107', false)
        run Sub_Event174()
    elif (System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']) and (System.EventFlags['cPlayer:NotBuilt2PMyHomeAfterMoving']):
        run Snowman_SendRecipe_MovingSubP()
    else:
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:110', false)
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:112', false)
        if EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:113', false)
            run Sub_Event160()
        else:
            run Sub_Event163()

flow Snowman_GiveSnowCrystal_MovingSubP():
    run Event229()

flow Snowman_SendRecipe_MovingSubP():
    run Event112()

local flow Sub_Event105():
    if EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:015', false)
        run Sub_Event160()
    else:
        run Sub_Event163()

local flow Sub_Event107():
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:014', false)
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event111():
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:020', false)
    run Sub_Event23()

local flow Sub_Event159():
    if EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
        run Sub_Event111()
    else:
        run Sub_Event107()

local flow Sub_Event160():
    EventFlowSystemActor.SetItemToPocket(3540, 1)
    System.EventFlags['cPlayer:SnowmanGotDay1Flag'] = true
    run Sub_grp_Event152()

local flow Sub_Event163():
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:014', false)
    run Sub_grp_Event152()

local flow Sub_Event17():
    System.EventFlags['cPlayer:SnowmanGotDay1Flag'] = true
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:021', false)
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event174():
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:013', false)
    run Sub_Event105()

local flow Sub_Event193():
    System.EventFlags['cPlayer:SnowmanGotDay1Flag'] = true
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event201():
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:111', false)
    SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:112', false)
    if EventFlowSystemActor.ShoppingCapacity('cItemName', 3540):
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:113', false)
        run Sub_Event23()
    else:
        run Sub_Event107()

local flow Sub_Event23():
    EventFlowSystemActor.SetItemToPocket(3540, 1)
    run Sub_Event17()

local flow Sub_grp_Event122():
    if SnowMan.SnowManIsHeadSmallerThanBody():
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:080', false)
    else:
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:081', false)

local flow Sub_grp_Event130():
    if SnowMan.SnowManIsHeadSmallerThanBody():
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:088', false)
    else:
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:089', false)

local flow Sub_grp_Event152():
    switch SnowMan.SnowManGrade():
        case 0:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:103', false)
            System.EventFlags['cLifeSupportAchievement:MakePerfectSnowball'] += 1
        case 1:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:104', false)
        case 2:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:105', false)
        case 3:
            SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:106', false)
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_grp_Event175():
    if SnowMan.SnowManIsHeadSmallerThanBody():
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:090', false)
    else:
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:091', false)

local flow Sub_grp_Event26():
    if EventFlowSystemActor.PercentChoice(70):
        run Snowman_Chat_Always()
    else:
        run Snowman_Chat_Grade()

local flow Sub_grp_Event73():
    if SnowMan.SnowManIsHeadSmallerThanBody():
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:082', false)
    else:
        SnowMan.OpenMessageWindow('TalkObj/OBJ_Snowman:083', false)

