flow CurrentRegulationInfo():
    if System.EventFlags['cLand:RegulationType1']:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_02', false)
    elif System.EventFlags['cLand:RegulationType2']:
        if System.EventFlags['cLand:TailorBuilt']:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_03_01', false)
    elif System.EventFlags['cLand:RegulationType3']:
        if System.EventFlags['cLand:TailorBuilt']:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_04', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_04_01', false)
    elif System.EventFlags['cLand:RegulationType4']:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_05', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:002_01', false)

flow Regulation_ChangFlagSet():
    if EventFlowSystemActor.ReserveRegulation() in (1, 2, 3, 4):
        System.EventFlags['cLand:EverChangedRegulation'] = true

flow Regulation_Fee():
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.WaitFrame(5)
    EventFlowSystemActor.BellCountDown(20000, true)
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.UIMoneyDisappear()
    EventFlowSystemActor.WaitFrame(5)
    run SNPC_sza_00_Common::Sza_CmnSel_Again()

flow Root():
    if System.EventFlags['cPlayer:MakeVillagePlayerFlag']:
        switch EventFlowSystemActor.ReserveRegulation():
            case 0, 1, 2, 3, 4:
                EventFlowSystemActor.MessageSuspend()
                EventFlowSystemActor.WaitFrame(5)
                EventFlowSystemActor.UIMoneyAppear()
                EventFlowSystemActor.WaitFrame(5)
                MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:101', false)
                if EventFlowSystemActor.HasBellCount(20000):
                    switch EventFlowSystemActor.ReserveRegulation():
                        case 0:
                            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:102_01', false)
                            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:103', false)
                            run Sub_grp_Event24()
                        case 1:
                            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:102_02', false)
                            run Sub_Event23()
                        case 2:
                            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:102_03', false)
                            run Sub_Event23()
                        case 3:
                            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:102_04', false)
                            run Sub_Event23()
                        case 4:
                            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:102_05', false)
                            run Sub_Event23()
                        default:
                            return
                else:
                    run CurrentRegulationInfo()
                    MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:004', true)
                    EventFlowSystemActor.WaitFrame(5)
                    EventFlowSystemActor.UIMoneyDisappear()
                    EventFlowSystemActor.WaitFrame(5)
                    run SNPC_sza_00_Common::Sza_CmnSel_Again()
            case 5:
                MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:301', false)
                run SNPC_sza_00_Common::Sza_CmnSel_Again()
            case 6:
                MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:302', false)
                run SNPC_sza_00_Common::Sza_CmnSel_Again()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:001', false)
        run CurrentRegulationInfo()
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:003', false)
        run SNPC_sza_00_Common::Sza_CmnSel_Again()

flow Sel_Regulation_Abolish():
    MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:205', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:215', true)
        EventFlowSystemActor.ReserveRegulation('cRegulationStop')
        System.EventFlags['cLand:EverChangedRegulation'] = false
        run Regulation_Fee()
    else:
        run Sel_Regulation_Again()

flow Sel_Regulation_Again():
    switch EventFlowSystemActor.ReserveRegulation():
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:111', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    run Sel_Regulation_Beautiful()
                case 1:
                    run Sel_Regulation_Morning()
                case 2:
                    run Sel_Regulation_Night()
                case 3:
                    run Sel_Regulation_Economy()
                case 4:
                    run Sza_ChangeRegulation_Cancel()
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:112', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    run Sel_Regulation_Morning()
                case 1:
                    run Sel_Regulation_Night()
                case 2:
                    run Sel_Regulation_Economy()
                case 3:
                    run Sel_Regulation_Abolish()
                case 4:
                    run Sza_ChangeRegulation_Cancel()
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:113', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    run Sel_Regulation_Beautiful()
                case 1:
                    run Sel_Regulation_Night()
                case 2:
                    run Sel_Regulation_Economy()
                case 3:
                    run Sel_Regulation_Abolish()
                case 4:
                    run Sza_ChangeRegulation_Cancel()
        case 3:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:114', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    run Sel_Regulation_Beautiful()
                case 1:
                    run Sel_Regulation_Morning()
                case 2:
                    run Sel_Regulation_Economy()
                case 3:
                    run Sel_Regulation_Abolish()
                case 4:
                    run Sza_ChangeRegulation_Cancel()
        case 4:
            MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:115', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    run Sel_Regulation_Beautiful()
                case 1:
                    run Sel_Regulation_Morning()
                case 2:
                    run Sel_Regulation_Night()
                case 3:
                    run Sel_Regulation_Abolish()
                case 4:
                    run Sza_ChangeRegulation_Cancel()
        default:
            return

flow Sel_Regulation_Beautiful():
    MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:201', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:211', true)
        run Regulation_ChangFlagSet()
        EventFlowSystemActor.ReserveRegulation('cRegulationClean')
        run Regulation_Fee()
    else:
        run Sel_Regulation_Again()

flow Sel_Regulation_Economy():
    MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:204', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:214', true)
        run Regulation_ChangFlagSet()
        EventFlowSystemActor.ReserveRegulation('cRegulationMoney')
        run Regulation_Fee()
    else:
        run Sel_Regulation_Again()

flow Sel_Regulation_Morning():
    if System.EventFlags['cLand:TailorBuilt']:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:202', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:202_01', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:212', true)
        run Regulation_ChangFlagSet()
        EventFlowSystemActor.ReserveRegulation('cRegulationMorning')
        run Regulation_Fee()
    else:
        run Sel_Regulation_Again()

flow Sel_Regulation_Night():
    if System.EventFlags['cLand:TailorBuilt']:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:203', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:203_01', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:213', true)
        run Regulation_ChangFlagSet()
        EventFlowSystemActor.ReserveRegulation('cRegulationNight')
        run Regulation_Fee()
    else:
        run Sel_Regulation_Again()

local flow Sub_Event23():
    MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:104', false)
    run Sub_grp_Event24()

local flow Sub_grp_Event24():
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run Sel_Regulation_Again()
    else:
        EventFlowSystemActor.WaitFrame(5)
        EventFlowSystemActor.UIMoneyDisappear()
        EventFlowSystemActor.WaitFrame(5)
        run SNPC_sza_00_Common::Sza_Cmn_Cancel()

flow Sza_ChangeRegulation_Cancel():
    MainNpc.OpenMessageWindow('TalkSNpc/sza/v2_0_0/SP_sza_60_aboutisland_03_Regulation:110', true)
    EventFlowSystemActor.WaitFrame(5)
    EventFlowSystemActor.UIMoneyDisappear()
    EventFlowSystemActor.WaitFrame(5)
    run SNPC_sza_00_Common::Sza_CmnSel_Again()

