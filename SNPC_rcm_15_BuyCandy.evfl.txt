flow Buy_After():
    if EventFlowSystemActor.IsMyVillage():
        System.EventFlags['cPlayer:RcmBoughtCandyTodayFlag'] = true
    else:
        System.EventFlags['cPlayerVisit:DC_RcmBoughtCandyTodayFlag'] = true

flow Root():
    if not System.EventFlags['cPlayer:RcmExplainCandyFlag']:
        System.EventFlags['cPlayer:RcmExplainCandyFlag'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:144_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:144_02', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:144_03', false)
        run Sub_grp_Event14()
    elif EventFlowSystemActor.IsMyVillage():
        if System.EventFlags['cPlayer:RcmBoughtCandyTodayFlag']:
            run Sub_Event19()
        else:
            run Sub_Event16()
    else:
        if System.EventFlags['cPlayerVisit:DC_RcmBoughtCandyTodayFlag']:
            run Sub_Event19()
        else:
            run Sub_Event16()

local flow Sub_Event16():
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:094', false)
    run Sub_grp_Event14()

local flow Sub_Event19():
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:144_04', false)
    if EventFlowSystemActor.GlobalEventNow('Halloween', 'cReadyOnly', false):
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:144_05', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:144_06', false)
    run SNPC_rcm_00_Common::BuyCancelNoAsk()

local flow Sub_grp_Event14():
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run SNPC_rcm_00_Common::Rcm_Groceries_Buy_Process()
    else:
        run SNPC_rcm_00_Common::Rcm_Groceries_Buy_Cancel()

