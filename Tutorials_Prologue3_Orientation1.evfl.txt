flow GoEventPlaza():
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
    EventFlowSystemActor.SetupActorPosition(1)
    run GoEventPlazaSetting()
    EventFlowSystemActor.CameraSetDemoParam('EventPlazaPrologue', '', 'Npc:rco', false, false, false, 0)
    EventFlowSystemActor.FadeIn(true)

flow GoEventPlazaSetting():
    Npc_3.SetNpcName(14, 0)
    Npc_3.TurnNeck(0, false)
    Npc_4.SetNpcName(13, 1)
    Npc_4.TurnNeck(0, false)
    MainNpc.TurnNeck(10, false)

flow Greeting():
    Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:001', false)
    EventFlowSystemActor.WaitFrame(20)
    Npc_1.TurnNeck(3, false)
    Npc_2.TurnNeck(3, false)
    Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:002', false)
    Npc_3.CharacterEmoticonAction('Greeting', true, '', 0, false)
    MainNpc.TurnNeck(3, false)
    EventFlowSystemActor.WaitFrame(20)
    Npc_1.TurnNeck(4, false)
    Npc_2.TurnNeck(4, false)
    Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:003', false)
    Npc_4.CharacterEmoticonAction('Greeting', true, '', 0, false)
    MainNpc.TurnNeck(4, false)
    EventFlowSystemActor.WaitFrame(20)
    Npc_1.TurnNeck(10, false)
    Npc_2.TurnNeck(10, false)
    Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:004', false)
    Player.CharacterEmoticonAction('Greeting', true, '', 0, false)
    MainNpc.TurnNeck(10, false)
    EventFlowSystemActor.WaitFrame(20)
    Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:005', false)
    Npc_1.TurnNeck(0, false)
    Npc_2.TurnNeck(0, false)
    Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:006', true)
    Npc_1.TurnNeck(11, false)
    Npc_1.TurnBody(12, 0.0)
    Npc_2.TurnNeck(11, false)
    Npc_2.TurnBody(12, 0.0)

flow Rco_Orientation2P_Office():
    if EventFlowSystemActor.OfficeLevel() not in (`ResServiceTent0`, `ResServiceTent1`):
        if EventFlowSystemActor.EnvSameDate('cEndOfTheYear', 'cGrowUpTime'):
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_07', false)
        else:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_05', false)
            if EventFlowSystemActor.EnvSameDate('cPreEndOfTheYear', 'cGrowUpTime'):
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_06', false)
    elif EventFlowSystemActor.ShopLevel() == `InResServiceTent`:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_01', false)
    elif not System.EventFlags['cLand:EnableBuildTownOffice']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_02', false)
    elif System.EventFlags['cLand:OfficeConstruction1']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_04', false)
    else:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_02', false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:112_03', false)

flow Root():
    if System.EventFlags['cLand:ValidateVillageSave']:
        EventFlowSystemActor.CameraSetDemoParam('EventPlazaPrologue2', '', 'Place:EventPlaza', false, false, true, 0)
        System.EventFlags['cPlayer:MainmenuCall'] = true
        System.EventFlags['cPlayer:MainmenuMap'] = true
        System.EventFlags['cPlayer:MainmenuEncyclopedia'] = true
        if System.EventFlags['cLand:TkkFirstLive']:
            if System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']:
                if not System.EventFlags['cPlayer:MainmenuConstructLicense']:
                    System.EventFlags['cPlayer:IslandCreaterUnlockMoving'] = true
                    System.EventFlags['cPlayer:MainmenuConstructLicense'] = true
            else:
                System.EventFlags['cPlayer:MainmenuConstructLicense'] = true
        EventFlowSystemActor.FadeIn(true)
        Npc_1.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:101', true)
        MainNpc.TurnNeck(1, false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:007', true)
        MainNpc.TurnBody(10, 0.0)
        MainNpc.NpcWaitTurn()
        EventFlowSystemActor.WaitFrame(5)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:103', false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:104', false)
        if System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']:
            run SNPC_rco_00_StartMainGame_PlayerMoving::Root_OtherP()
        else:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:105', true)
            MainNpc.SetDeliveryItemAtRandom(2750, true, 'cVillageRemakePattern', 0)
            MainNpc.NpcDelivery(1, 'Keep')
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:106', false)
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:107', false)
            MainNpc.NpcDelivery(2, 'Default')
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:108', true)
            run SNPC_rco_00_StartMainGame::Rco_GetSmartPhone()
            run SNPC_rco_00_StartMainGame::v200_SendTipsApp()
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:109', true)
            run SNPC_rco_00_StartMainGame::Rco_TutorialGetBill()
            run Rco_Orientation2P_Office()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_01_StartingMaingame:013_01', true)
            run SNPC_rco_00_StartMainGame::Rco_OrientationEnd()
    else:
        System.EventFlags['cPlayer:PrologueDone1stTalkAtPlaza'] = true
        run GoEventPlaza()
        run Greeting()
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:007', false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:008_01', true)
        EventFlowSystemActor.WaitFrame(5)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:008_02', false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:009', false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:010', false)
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue3_Orientation1:011', true)
        EventFlowSystemActor.FadeOut('cNormalFader', 'cNormalFader', 'cBlack', 0.5, 0.5, true)
        EventFlowSystemActor.SetupActorPosition(0)
        MainNpc.NpcAddBlackBoard('TalkCount', 1)
        EventFlowSystemActor.WaitFrame(15)
        EventFlowSystemActor.FadeIn(true)
        System.EventFlags['cPlayer:PrologueDone1stTalkAtPlaza'] = true

flow Root_Init():
    MainNpc.NpcAISetting(4, false)
    MainNpc.NpcAISetting(2, false)
    MainNpc.NpcAISetting(7, false)
    MainNpc.NpcAISetting(3, false)
    MainNpc.NpcAITalkCastSetting('Prologue_Rco')

