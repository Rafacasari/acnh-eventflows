flow ChineseZodiac():
    if (not MainNpc.EventFlags['cNpcMemory:TalkFreeZodiacNow']) and ((MainNpc.EventFlags['cNpcMemory:TalkFreeFNow']) or (EventFlowSystemActor.PercentChoice(50))) and (MainNpc.NpcHasFreeMessage('cFreeFEto')):
        if EventFlowSystemActor.CurrentRegionLanguage('cCurrentMachine') == 0:
            if (EventFlowSystemActor.EnvSameDate('cNewYear', 'cGrowUpTime')) and (EventFlowSystemActor.CurrentRegionLanguage('cCurrentVillage') == 0):
                run Sub_Event29()
        else:
            if (EventFlowSystemActor.EnvSameDate('cLunarNewYear', 'cGrowUpTime')) and (EventFlowSystemActor.CurrentRegionLanguage('cCurrentVillage') in (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13)):
                run Sub_Event29()

flow Event_Chk():
    if (not MainNpc.EventFlags['cNpcMemory:TalkFreeEventNow']) and (MainNpc.NpcHasFreeMessage('cFreeEEvent')):
        if (not System.EventFlags['cLand:AnyGlobalEventFinished']) and (not EventFlowSystemActor.EnvCheckBetweenDate(10, 26, 10, 30, 'cLastGrowUpTime')) and (not EventFlowSystemActor.CheckNearEvent(5, 1, 'HarvestFestival', false)) and (not EventFlowSystemActor.CheckNearEvent(5, 1, 'XmasEve', false)) and (not EventFlowSystemActor.CheckNearEvent(5, 1, 'Carnival', false)):
            MainNpc.NpcOpenFreeMessage('cFreeEEventFirst')
        else:
            MainNpc.NpcOpenFreeMessage('cFreeEEvent')
        MainNpc.EventFlags['cNpcMemory:TalkFreeEventNow'] = true
        EventFlowSystemActor.ExitFlowchart()

flow FreeF_Chk():
    run ChineseZodiac()
    run FreeF_Main()
    if not System.EventFlags['cPlayer:TalkFreeMultiDayEventTodayFlag']:
        run MultiDayEvent_Easter()
        run MultiDayEvent_EarthDay()
        run MultiDayEvent_Halloween()
        run MultiDayEvent_Christmas()

flow FreeF_Main():
    if (not MainNpc.EventFlags['cNpcMemory:TalkFreeFNow']) and (MainNpc.NpcHasFreeMessage('cFreeFEvent')) and (not EventFlowSystemActor.TermEventNow('MayDay', false)):
        MainNpc.NpcOpenFreeMessage('cFreeFEvent')
        MainNpc.EventFlags['cNpcMemory:TalkFreeFNow'] = true
        EventFlowSystemActor.ExitFlowchart()

flow HHA_Chk():
    if (not System.EventFlags['cPlayer:TalkHHATodayAnyone']) and (not MainNpc.IsNnpcTent()) and (MainNpc.NpcHasFreeMessage('cFreeEHHA')):
        MainNpc.NpcOpenFreeMessage('cFreeEHHA')
        System.EventFlags['cPlayer:TalkHHATodayAnyone'] = true
        EventFlowSystemActor.ExitFlowchart()

flow MultiDayEvent_Christmas():
    if EventFlowSystemActor.TermEventNow('XmasReady2', false):
        if System.EventFlags['cLand:BuiltTownOffice']:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
                case 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Christmas:001', false)
                case 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Christmas:002', false)
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Christmas:003', false)
        else:
            if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Christmas:001', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Christmas:002', false)
        System.EventFlags['cPlayer:TalkFreeMultiDayEventTodayFlag'] = true
        EventFlowSystemActor.ExitFlowchart()

flow MultiDayEvent_EarthDay():
    if EventFlowSystemActor.TermEventNow('EarthDay', false):
        if System.EventFlags['cPlayer:ReijiTalkBeforeFlag']:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious5(5, true):
                case 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:001', false)
                case 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:002', false)
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:003', false)
                case 3:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:004', false)
                case 4:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:005', false)
            System.EventFlags['cPlayer:TalkFreeMultiDayEventTodayFlag'] = true
            EventFlowSystemActor.ExitFlowchart()
        else:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
                case 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:003', false)
                case 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:004', false)
                case 2:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_EarthDay:005', false)
            System.EventFlags['cPlayer:TalkFreeMultiDayEventTodayFlag'] = true
            EventFlowSystemActor.ExitFlowchart()

flow MultiDayEvent_Easter():
    if EventFlowSystemActor.GlobalEventNow('Easter', 'cReadyOnly', false):
entrypoint Event42:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious4(4, true):
            case 0:
                if System.EventFlags['cPlayer:MainmenuRndDailyQuest']:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Easter:100', false)
                    run Sub_Event46()
                else:
                    run Event42()
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Easter:101', false)
                run Sub_Event46()
            case 2:
                if EventFlowSystemActor.EnvHourOverGrowUp():
                    run Event42()
                else:
                    EventFlowSystemActor.SetTagFromSystem('cEasterMonthDay', 'cHour', 0, 0, '')
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Easter:102', false)
                    run Sub_Event46()
            case 3:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Easter:103', false)
                run Sub_Event46()
    else:
        return

flow MultiDayEvent_Halloween():
    if (EventFlowSystemActor.GlobalEventNow('Halloween', 'cReadyOnly', false)) and (not EventFlowSystemActor.HalloweenFtrNum(3)):
        if EventFlowSystemActor.HalloweenFtrNum(8):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Halloween:100', false)
        else:
            if EventFlowSystemActor.HalloweenFtrNum(15):
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Halloween:101', false)
            elif EventFlowSystemActor.HalloweenFtrNum(30):
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Halloween:102', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeF_Halloween:103', false)
        System.EventFlags['cPlayer:TalkFreeMultiDayEventTodayFlag'] = true
        EventFlowSystemActor.ExitFlowchart()

flow Snpc_Chk():
    if (not System.EventFlags['cPlayer:TalkSnpcTodayAnyone']) and ((not System.EventFlags['cLand:IsNpcIncreased']) or (MainNpc.NpcLivingDays(3))) and (MainNpc.NpcHasFreeMessage('cFreeESnpc')) and (EventFlowSystemActor.SystemCheckNowStage('cField')):
        MainNpc.NpcOpenFreeMessage('cFreeESnpc')
        System.EventFlags['cPlayer:TalkSnpcTodayAnyone'] = true
        EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event29():
    MainNpc.NpcOpenFreeMessage('cFreeFEto')
    MainNpc.EventFlags['cNpcMemory:TalkFreeZodiacNow'] = true
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event46():
    System.EventFlags['cPlayer:TalkFreeMultiDayEventTodayFlag'] = true
    EventFlowSystemActor.ExitFlowchart()

