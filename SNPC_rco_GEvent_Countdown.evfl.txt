flow Rco_Common_Buy():
    if SubflowResults@2[2] == 0:
        if EventFlowSystemActor.HasBellCount(500):
            run Sub_Event15()
        else:
            run Rco_Common_NoMoney()
    else:
        if EventFlowSystemActor.HasBellCount(300):
            run Sub_Event15()
        else:
            run Rco_Common_NoMoney()

flow Rco_Common_Cancel():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:004', true)
    EventFlowSystemActor.ExitFlowchart()

flow Rco_Common_DemoBuy():
    MainNpc.SetDeliveryItem(1, true)
    if SubflowResults@2[2] == 0:
        EventFlowSystemActor.BellCountDown(500, true)
    else:
        EventFlowSystemActor.BellCountDown(300, true)

flow Rco_Common_ItemFull_Buy():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:006', true)
    EventFlowSystemActor.ExitFlowchart()

flow Rco_Common_ItemFull_Get():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:106', false)
    EventFlowSystemActor.ExitFlowchart()

flow Rco_Common_NoMoney():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:005', true)
    EventFlowSystemActor.ExitFlowchart()

flow Rco_Cracker_Get():
    if SubflowResults@2[0] != 0:
        if EventFlowSystemActor.IsMyVillage():
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:107', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:114', false)
    MainNpc.MessageSuspend()
    MainNpc.SetDeliveryItem(1, true)
    MainNpc.NpcDelivery(1, 'Keep')
    if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:103', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:104', false)
    MainNpc.NpcDelivery(2, '"Default"')
    if EventFlowSystemActor.IsMyVillage():
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:105', false)
        System.EventFlags['cPlayer:SzaGotCracker'] = true
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:115', false)
        System.EventFlags['cPlayerVisit:VisitorGotCracker'] = true
    EventFlowSystemActor.ExitFlowchart()

flow Rco_Get_Cracker_Chk():
    EventFlowSystemActor.SelectRewardItemDirect(2753, 5, 'cVillageRemakePattern', 0)
    if EventFlowSystemActor.ShoppingCapacity('cReward', 2753):
        if SubflowResults@2[1] == 0:
            run Rco_Cracker_Get()
        else:
            SubflowResults[2] = 1
            run Rco_Common_Buy()

flow Rco_Select_Buy():
    EventFlowSystemActor.UIMoneyAppear()
    if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:001', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:002', false)
    EventFlowSystemActor.SetTagFromSystem('cFlow', 'cMoney', 0, 500, '')
    EventFlowSystemActor.SetTagFromSystem('cFlow', 'cMoney', 1, 300, '')
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:003', false)
    switch EventFlowSystemActor.GeneralTalkChoice3():
        case 0:
            MainNpc.CountdownRctManualChoice()
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:009', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    MainNpc.RctSetNewYearHat(0)
                    run Sub_grp_Event27()
                case 1:
                    MainNpc.RctSetNewYearHat(1)
                    run Sub_grp_Event27()
                case 2:
                    MainNpc.RctSetNewYearHat(2)
                    run Sub_grp_Event27()
                case 3:
                    MainNpc.RctSetNewYearHat(3)
                    run Sub_grp_Event27()
                case 4:
                    run Rco_Common_Cancel()
        case 1:
            SubflowResults[1] = 1
            run Rco_Get_Cracker_Chk()
            run Rco_Common_ItemFull_Buy()
        case 2:
            run Rco_Common_Cancel()

flow Root():
    if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
        if EventFlowSystemActor.EnvHourCompare(23, 59, true, true) != 0:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:010', false)
        elif EventFlowSystemActor.IsMyVillage():
            if not System.EventFlags['cPlayer:RcoTalkBeforeCountdown']:
                System.EventFlags['cPlayer:RcoTalkBeforeCountdown'] = true
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:100', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:102', false)
                SubflowResults[0] = 0
                SubflowResults[1] = 0
                run Rco_Get_Cracker_Chk()
                run Rco_Common_ItemFull_Get()
            elif System.EventFlags['cPlayer:SzaGotCracker']:
                run Rco_Select_Buy()
            else:
                SubflowResults[0] = 1
                SubflowResults[1] = 0
                run Rco_Get_Cracker_Chk()
                run Rco_Select_Buy()
        elif not System.EventFlags['cPlayerVisit:RcoVisitorTalkBeforeCountdown']:
            System.EventFlags['cPlayerVisit:RcoVisitorTalkBeforeCountdown'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:111', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:113', false)
            SubflowResults[0] = 0
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Common_ItemFull_Get()
        elif System.EventFlags['cPlayerVisit:VisitorGotCracker']:
            run Rco_Select_Buy()
        else:
            SubflowResults[0] = 1
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Select_Buy()
    elif EventFlowSystemActor.IsMyVillage():
        if not System.EventFlags['cPlayer:RcoTalkAfterCountdown']:
            System.EventFlags['cPlayer:RcoTalkAfterCountdown'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:108', false)
            if not System.EventFlags['cPlayer:RcoTalkBeforeCountdown']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:101', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:102', false)
                SubflowResults[1] = 0
                run Rco_Get_Cracker_Chk()
                run Rco_Common_ItemFull_Get()
        elif System.EventFlags['cPlayer:SzaGotCracker']:
            run Rco_Select_Buy()
        else:
            SubflowResults[0] = 1
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Select_Buy()
    elif not System.EventFlags['cPlayerVisit:RcoVisitorTalkAfterCountdown']:
        System.EventFlags['cPlayerVisit:RcoVisitorTalkAfterCountdown'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:116', false)
        if not System.EventFlags['cPlayer:RcoTalkBeforeCountdown']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:112', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:113', false)
            SubflowResults[0] = 0
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Common_ItemFull_Get()
    elif System.EventFlags['cPlayerVisit:VisitorGotCracker']:
        run Rco_Select_Buy()
    else:
        SubflowResults[0] = 1
        SubflowResults[1] = 0
        run Rco_Get_Cracker_Chk()
        run Rco_Select_Buy()

local flow Sub_Event15():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:007', false)
    run Demo_Common::Demo_Rco_Countdown_Shopping()
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:008', true)
    if SubflowResults@2[2] == 0:
        EventFlowSystemActor.PlayReport('cCountdownBuyHat', 500)
        System.EventFlags['cLifeSupportAchievement:HowmuchBuyItem'] += 500
    else:
        EventFlowSystemActor.PlayReport('cCountdownBuyCracker', 300)
        System.EventFlags['cLifeSupportAchievement:HowmuchBuyItem'] += 300
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_grp_Event27():
    if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
        run Rco_Common_ItemFull_Buy()
    else:
        run Rco_Common_Buy()

