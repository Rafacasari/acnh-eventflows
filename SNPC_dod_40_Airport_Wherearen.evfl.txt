flow DepartureWherearen():
    EventFlowSystemActor.MiniGameSilentCancel()
    if System.EventFlags['cPlayer:EquipLicenseHelmet']:
        run SNPC_dod_AirPort::LandMakingRemove_Soloplay()
    MainNpc.OpenMessageWindow('TalkSNpc/dod/SP_dod_AirPort:037_01', true)
    run Dod_GoToWherearen()

flow Dod_GoToWherearen():
    Player.PlayerChangeDemoState('cReserveNextSceneStartToolOff')
    System.EventFlags['cPlayer:DodSingleFlightToday'] = true
    EventFlowSystemActor.BGMPropertyControl(143)
    EventFlowSystemActor.SoundTriggerEmit('Airplane_Takeoff_Short', -1)
    EventFlowSystemActor.BGMPropertyControl(159)
    EventFlowSystemActor.StartMeasurePlayTime('cWherearenIslands')
    if System.EventFlags['cPlayer:WHEREAREN_VisitDone']:
        EventFlowSystemActor.CameraReserveFirstStateCommand('Talk:doc', '', false)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenGrowUp', 'cDALWherearenWithLoadWait', 'cCircle', 'cBlack', 1.0, 1.0)
    else:
        System.EventFlags['cPlayer:WHEREAREN_VisitDone'] = true
        EventFlowSystemActor.SoundSceneChangeFadeOutDucking(8)
        EventFlowSystemActor.ReserveSystemFlowDemo('Demo_Wherearen_Op', 'OpDemo_Introduction', false, false, false)
        EventFlowSystemActor.SystemRequestChangeStage('cWherearenOpeningMessage', 'cDALWherearenWithLoadWait', 'cCircle', 'cBlack', 1.0, 1.0)

flow GoToWherearen():
    if EventFlowSystemActor.IsWherearenAocAvailable():
        MainNpc.OpenMessageWindow('TalkSNpc/dod/SP_dod_AirPort:1001', false)
        MainNpc.OpenMessageWindow('TalkSNpc/dod/SP_dod_AirPort:1002', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/dod/SP_dod_AirPort:037', true)
            if EventFlowSystemActor.SaveHasWherearenIslands():
                run DepartureWherearen()
            elif EventFlowSystemActor.SaveExtensionCheck('cWherearenIslands'):
                EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_WherearenMsg:4003', false)
                EventFlowSystemActor.WaitFrame(30)
                EventFlowSystemActor.SaveExtend('cWherearenIslands')
                EventFlowSystemActor.MessageSuspend()
                if EventFlowSystemActor.SaveExtensionIsSuccess():
                    run DepartureWherearen()
                else:
                    EventFlowSystemActor.ExitFlowchart()
            else:
                run DepartureWherearen()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/dod/SP_dod_AirPort:903', false)
            EventFlowSystemActor.ExitFlowchart()
    else:
        run NoAoC()

flow NoAoC():
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.UIVersionGuideAppear('cNormal', 'cOn')
    EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_WherearenMsg:4000', true)
    EventFlowSystemActor.UIVersionGuideDisappear('cNormal')
    EventFlowSystemActor.ExitFlowchart()

