flow NewYearEveHurry():
    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:007_02', false)

flow Rco_EndMess():
    if SubflowResults@4[4] in (1, 2, 3):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:901', true)

flow Root():
    run Demo_PublicAnnouncement_20_CmnGreetChk::Root()
    run Demo_PublicAnnouncement_25_CmnNewsGreet::Root()
    run Demo_PublicAnnouncement_26_CmnNewsBday::Root()
    if SubflowResults@2[23] == 0:
        run Demo_PublicAnnouncement_27_CmnNews_PreEvent::Root()
    if SubflowResults@4[4] == 0:
        if SubflowResults@2[0] == 0:
            switch SubflowResults@6[13]:
                case 0:
                    run Demo_PublicAnnouncement_40_CmnNoNews::Root()
                case 1:
                    run Demo_PublicAnnouncement_40_CmnNoNews::Root()
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_HouseBuild()
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:210_01', false)
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_RemakeWorkshop()
                case 3:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:161_02', false)
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_OfficeRenual()
                case 4:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:163_00_01', false)
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_OfficeOpen()
                case 5:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:003_03', false)
        elif not System.EventFlags['cLand:TkkFirstLiveReserved']:
            run Demo_PublicAnnouncement_40_CmnNoNews::Root()
        elif System.EventFlags['cPlayer:TkkFirstLiveJoined']:
            run Demo_PublicAnnouncement_40_CmnNoNews::Root()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_11_Sza_Once:301_02', false)
            run Demo_PublicAnnouncement_13_Sza_Once::TownNews_KK1stLive()
    else:
        if SubflowResults@2[15] == 0:
            if SubflowResults@2[0] == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:021', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:021', false)
        else:
            if SubflowResults@2[0] == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:022', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:022', false)
        run Demo_PublicAnnouncement_31_CmnNewsRegulation::Root()
        run Demo_PublicAnnouncement_13_Sza_Once::TownNews_StartKppTour()
        run Demo_PublicAnnouncement_32_CmnNewsMoveIn::Root()
        run Demo_PublicAnnouncement_33_CmnNewsFacilities::Root()
        run Demo_PublicAnnouncement_34_CmnNewsMoveOut::Root()
        if SubflowResults@2[0] == 0:
            switch SubflowResults@5[13]:
                case 0:
                    if SubflowResults@4[16] == 0:
                        run Rco_EndMess()
                    else:
                        run Demo_PublicAnnouncement_35_CmnNewsEventNotice::Root()
                        run Rco_EndMess()
                case 1:
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_HouseBuild()
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:210', false)
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_RemakeWorkshop()
                    run Rco_EndMess()
                case 3:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:161_01', false)
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_OfficeRenual()
                    run Rco_EndMess()
                case 4:
                    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_10_Rco_Once:161_01', false)
                    run Demo_PublicAnnouncement_03_Rco_Once::TownNews_Rco_OfficeOpen()
        elif not System.EventFlags['cLand:TkkFirstLiveReserved']:
            run Skip_TkkFirstLive()
        elif System.EventFlags['cPlayer:TkkFirstLiveJoined']:
            run Skip_TkkFirstLive()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_11_Sza_Once:301_01', false)
            run Demo_PublicAnnouncement_13_Sza_Once::TownNews_KK1stLive()

flow Skip_TkkFirstLive():
    if SubflowResults@8[21] not in (0, 1, 2, 3, 4, 5, 6):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:902', false)
    elif EventFlowSystemActor.EnvSameDate('cEndOfTheYear', 'cGrowUpTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:007_05', false)
        if EventFlowSystemActor.EnvHourCompare(2, -1, true, false) == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:007_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:007_04', false)
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:902', false)
    elif SubflowResults@9[16] == 0:
        if SubflowResults@4[4] in (1, 2, 3):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:901', true)
    else:
        run Demo_PublicAnnouncement_35_CmnNewsEventNotice::Root()
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:901', true)

