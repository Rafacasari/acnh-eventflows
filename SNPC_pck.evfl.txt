flow Dance_Normal():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            EventFlowSystemActor.BGMPropertyControl(120)
            EventFlowSystemActor.SoundDuckingOn(48)
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:029', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:030_00', false)
            EventFlowSystemActor.BGMPropertyControl(120)
            EventFlowSystemActor.SoundDuckingOn(48)
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:030_01', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:031_00', false)
            EventFlowSystemActor.BGMPropertyControl(120)
            EventFlowSystemActor.SoundDuckingOn(48)
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:031_01', false)
    EventFlowSystemActor.SoundTriggerEmit('DanceLoop', 1)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = true
    MainNpc.RequestSimple('PckDanceHyper', true)
    switch EventFlowSystemActor.FlagSystemIntValue5(5, 'cLandTemp:PckGiveFeather'):
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:034', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:032', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:033', false)
        case 3, 4:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:035', false)
    EventFlowSystemActor.SoundFade(1)
    EventFlowSystemActor.SoundTriggerEmit('DanceFinish_Normal', -1)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = false
    System.EventFlags['cLandTemp:PckDanceEffect'] = true
    MainNpc.RequestSimple('PckVivaOneColor', false)
    EventFlowSystemActor.WaitFrame(60)
    System.EventFlags['cLandTemp:PckDanceEffect'] = false
    EventFlowSystemActor.SoundDuckingOff(48)
    EventFlowSystemActor.WaitFrame(60)
    switch EventFlowSystemActor.FlagSystemIntValue5(5, 'cLandTemp:PckGiveFeather'):
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:038', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:036', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:037', false)
        case 3, 4:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:039', false)

flow Dance_Rainbow():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:021_00', false)
    EventFlowSystemActor.BGMPropertyControl(120)
    EventFlowSystemActor.SoundDuckingOn(48)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:021_01', false)
    EventFlowSystemActor.SoundTriggerEmit('DanceLoop', 2)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = true
    MainNpc.RequestSimple('PckDanceHyperRotate', true)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:022', false)
    EventFlowSystemActor.SoundFade(2)
    EventFlowSystemActor.SoundTriggerEmit('DanceFinish_Rainbow', -1)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = false
    MainNpc.RequestSimple('PckViva', false)
    EventFlowSystemActor.WaitFrame(25)
    EventFlowSystemActor.CameraSetDemoParam('CarnivalDanceRainbow', 'CarnivalDanceRainbow', 'Npc:pck', false, false, true, 0)
    EventFlowSystemActor.WaitFrame(0)
    MainNpc.MessageSuspend()
    EventFlowSystemActor.SoundDuckingOff(48)
    EventFlowSystemActor.WaitFrame(60)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:024', false)
    EventFlowSystemActor.StoreNormalCamera(false, '')
    MainNpc.TalkCamera(true, 'cTalk', 0)
    MainNpc.TurnBody(10, 0.0)
    EventFlowSystemActor.WaitFrame(24)

flow Dance_Rainbow_Comp():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:052_00', false)
    EventFlowSystemActor.BGMPropertyControl(120)
    EventFlowSystemActor.SoundDuckingOn(48)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:052_01', false)
    EventFlowSystemActor.SoundTriggerEmit('DanceLoop', 3)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = true
    MainNpc.RequestSimple('PckDanceHyperRotate', true)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:053', false)
    EventFlowSystemActor.SoundFade(3)
    EventFlowSystemActor.SoundTriggerEmit('DanceFinish_Rainbow', -1)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = false
    MainNpc.RequestSimple('PckViva', false)
    EventFlowSystemActor.WaitFrame(25)
    EventFlowSystemActor.CameraSetDemoParam('CarnivalDanceRainbow', 'CarnivalDanceRainbow', 'Npc:pck', false, false, true, 0)
    EventFlowSystemActor.WaitFrame(0)
    MainNpc.MessageSuspend()
    EventFlowSystemActor.SoundTriggerEmit('DanceIntro_Twice', -1)
    EventFlowSystemActor.WaitFrame(131)
    EventFlowSystemActor.StoreNormalCamera(false, '')
    MainNpc.TalkCamera(true, 'CarnivalDanceRainbowPop', 0)
    EventFlowSystemActor.WaitFrame(15)
    EventFlowSystemActor.SoundTriggerEmit('DanceLoop_Fast', 4)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = true
    MainNpc.RequestSimple('PckDanceHyperRotate', true)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:054', false)
    EventFlowSystemActor.SoundFade(4)
    EventFlowSystemActor.SoundTriggerEmit('DanceFinish_Twice', -1)
    EventFlowSystemActor.SoundTriggerEmit('DanceFinish_Impact', -1)
    System.EventFlags['cLandTemp:PckDanceCarnivalRight'] = false
    MainNpc.RequestSimple('PckVivaTwice', false)
    EventFlowSystemActor.WaitFrame(75)
    EventFlowSystemActor.CameraSetDemoParam('CarnivalDanceRainbow', 'CarnivalDanceRainbow', 'Npc:pck', false, false, true, 0)
    EventFlowSystemActor.WaitFrame(0)
    EventFlowSystemActor.SoundDuckingOff(48)
    MainNpc.MessageSuspend()
    EventFlowSystemActor.WaitFrame(60)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:055', false)
    EventFlowSystemActor.StoreNormalCamera(false, '')
    MainNpc.TalkCamera(true, 'cTalk', 0)
    MainNpc.TurnBody(10, 0.0)
    EventFlowSystemActor.WaitFrame(24)

flow Get_Item():
    EventFlowSystemActor.BGMPropertyControl(121)
    if EventFlowSystemActor.IsMyVillage():
        if System.EventFlags['cPlayer:PckGiveFurnitureCount'] != 9:
            run Sub_Event73()
        else:
            run Sub_Event98()
    else:
        if System.EventFlags['cPlayerVisit:DC_PckGiveFurnitureCount'] != 9:
            run Sub_Event73()
        else:
            run Sub_Event98()

flow Get_Recipe():
    run Event122()

flow Give_NomalFeather():
    run Event19()

flow Root():
    MainNpc.SetDefaultWaitAs('cDefault')
    MainNpc.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
    if not EventFlowSystemActor.IsMyVillage():
        if System.EventFlags['cPlayerVisit:DC_PckTalkRunningEvent']:
            run Sub_Event104()
        else:
            System.EventFlags['cPlayerVisit:DC_PckTalkRunningEvent'] = true
            run Sub_Event1()
    elif System.EventFlags['cPlayer:PckTalkTodayFlag']:
        run Sub_Event104()
    else:
        System.EventFlags['cPlayer:PckTalkBeforeFlag'] = true
        System.EventFlags['cPlayer:PckTalkTodayFlag'] = true
        run Sub_Event1()

flow Set_FeatherColor():
    if EventFlowSystemActor.UIPocketMenuItemSelected(3543, 1, true):
        System.EventFlags['cLandTemp:PckGiveFeather'] = 0
    elif EventFlowSystemActor.UIPocketMenuItemSelected(3541, 1, true):
        System.EventFlags['cLandTemp:PckGiveFeather'] = 1
    elif EventFlowSystemActor.UIPocketMenuItemSelected(3542, 1, true):
        System.EventFlags['cLandTemp:PckGiveFeather'] = 2
    elif EventFlowSystemActor.UIPocketMenuItemSelected(3545, 1, true):
        System.EventFlags['cLandTemp:PckGiveFeather'] = 3
    else:
        System.EventFlags['cLandTemp:PckGiveFeather'] = 4

local flow Sub_Event1():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:001_00', false)
    EventFlowSystemActor.SoundDuckingOn(49)
    EventFlowSystemActor.SoundDuckingOn(50)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:001_01', false)
    EventFlowSystemActor.SoundTriggerEmit('DanceLoop', 0)
    MainNpc.RequestSimple('PckDanceHyper', true)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:002', false)
    EventFlowSystemActor.SoundFade(0)
    EventFlowSystemActor.SoundTriggerEmit('DanceFinish_Normal', -1)
    MainNpc.CharacterEmoticonAction('AddViva', true, '', 0, true)
    EventFlowSystemActor.WaitFrame(90)
    EventFlowSystemActor.SoundDuckingOff(49)
    EventFlowSystemActor.SoundDuckingOff(50)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:003', false)
    if (EventFlowSystemActor.PlayerIsEquipItem(12025, 12023, 10911, 12024, 14242, 14241, 14240, 14016, 'cAny', false, true)) and ((EventFlowSystemActor.PlayerIsEquipItem(3548, 3542, 3541, 3543, 3545, 65534, 65534, 65534, 'cAny', true, true)) or (EventFlowSystemActor.PlayerIsEquipItem(9734, 2612, 9732, 9733, 65534, 65534, 65534, 65534, 'cAny', true, true))):
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:004', false)
        if EventFlowSystemActor.IsMyVillage():
            System.EventFlags['cPlayer:PckLookChatFlag'] = true
        else:
            System.EventFlags['cPlayerVisit:DC_PckLookChatFlag'] = true
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:005', false)
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:006', false)
    if EventFlowSystemActor.PlayerHasCraftRecipe('Carnival', 3548):
        run Sub_Event127()
    else:
entrypoint Event174:
        if EventFlowSystemActor.IsMyVillage():
            System.EventFlags['cPlayer:PckRecipeTalkFlag'] = true
        else:
            System.EventFlags['cPlayer:PckRecipeTalkFlag'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:007', false)
entrypoint Event122:
        if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:008', false)
        else:
            MainNpc.MessageSuspend()
            MainNpc.NpcSetRewardRecipe(3548, false)
            MainNpc.SetDeliveryItem(1, true)
            MainNpc.NpcDelivery(1, 'Default')
            System.EventFlags['cPlayer:PckRecipeFlag'] = true
            run Sub_Event127()

local flow Sub_Event104():
    if (not EventFlowSystemActor.PlayerHasCraftRecipe('Carnival', 3548)) and (not System.EventFlags['cPlayer:PckRecipeFlag']):
        if EventFlowSystemActor.IsMyVillage():
            if System.EventFlags['cPlayer:PckRecipeTalkFlag']:
                run Sub_grp_Event0()
            else:
                run Talk_Recipe()
        else:
            if System.EventFlags['cPlayerVisit:DC_PckRecipeTalkFlag']:
                run Sub_grp_Event0()
            else:
                run Talk_Recipe()
        return
    else:
        if (EventFlowSystemActor.PlayerIsEquipItem(12025, 12023, 10911, 12024, 14242, 14241, 14240, 14016, 'cAny', false, true)) and ((EventFlowSystemActor.PlayerIsEquipItem(3548, 3542, 3541, 3543, 3545, 65534, 65534, 65534, 'cAny', true, true)) or (EventFlowSystemActor.PlayerIsEquipItem(9734, 2612, 9732, 9733, 65534, 65534, 65534, 65534, 'cAny', true, true))):
            if EventFlowSystemActor.IsMyVillage():
                if System.EventFlags['cPlayer:PckLookChatFlag']:
                    run Sub_Event46()
                else:
                    run Sub_Event28()
            elif System.EventFlags['cPlayerVisit:DC_PckLookChatFlag']:
                run Sub_Event46()
            else:
                run Sub_Event28()
        else:
            run Sub_Event46()
        if EventFlowSystemActor.IsMyVillage():
            if System.EventFlags['cPlayer:PckGiveFurnitureCount'] < 9:
                run Sub_Event47()
            else:
                run Sub_grp_Event114()
        elif System.EventFlags['cPlayerVisit:DC_PckGiveFurnitureCount'] != 9:
            run Sub_Event47()
        else:
            run Sub_grp_Event114()

local flow Sub_Event127():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:009', false)
    if System.EventFlags['cPlayer:MainmenuRecipe']:
        EventFlowSystemActor.ExitFlowchart()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:009_01', false)

local flow Sub_Event136():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:027', false)
    run Event124()

local flow Sub_Event159():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:026', false)

local flow Sub_Event175():
    MainNpc.SetDeliveryItem(4, true)
    MainNpc.MessageSuspend()
    MainNpc.NpcDelivery(0, '"Default"')
    run Dance_Normal()
    run Get_Item()

local flow Sub_Event28():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:012', false)
    if EventFlowSystemActor.IsMyVillage():
        System.EventFlags['cPlayer:PckLookChatFlag'] = true
    else:
        System.EventFlags['cPlayerVisit:DC_PckLookChatFlag'] = true

local flow Sub_Event46():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:013', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:014', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:015', false)

local flow Sub_Event47():
    if EventFlowSystemActor.HasTargetItem(3548, 1):
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:016', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:020', false)
            EventFlowSystemActor.UIItemSelectWindowHandling('cItemKind', 65534, 'RainbowFeather', '', 'cItemSelect', false)
            run Set_FeatherColor()
            if EventFlowSystemActor.UIResultMenuDecide():
                MainNpc.SetDeliveryItem(4, true)
                MainNpc.NpcDelivery(0, 'Default')
                run Dance_Rainbow()
                run Get_Item()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:026', false)
        elif MainNpc.PckHaveThreeNormalFearther():
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:018', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Give_NomalFeather()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:019', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:017', false)
        return
    elif not EventFlowSystemActor.HasKindItem('cKind', 'Feather', ''):
        if EventFlowSystemActor.PlayerIsEquipItem(3548, 3542, 3541, 3543, 3545, 65534, 65534, 65534, 'cAny', true, true):
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:049', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:047', false)
        return
    elif MainNpc.PckHaveThreeNormalFearther():
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:025', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
entrypoint Event19:
            if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:028_00', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:028_01', false)
entrypoint Event124:
            EventFlowSystemActor.UIItemSelectWindowHandling('cCarnivalFeather', 65534, 'Feather', '', 'cItemSelect', false)
            if EventFlowSystemActor.UIResultMenuDecide():
                run Set_FeatherColor()
                switch EventFlowSystemActor.FlagSystemIntValue5(5, 'cLandTemp:PckGiveFeather'):
                    case 0:
                        if EventFlowSystemActor.HasTargetItem(3543, 3):
                            run Sub_Event175()
                        else:
                            run Sub_Event136()
                    case 1:
                        if EventFlowSystemActor.HasTargetItem(3541, 3):
                            run Sub_Event175()
                        else:
                            run Sub_Event136()
                    case 2:
                        if EventFlowSystemActor.HasTargetItem(3542, 3):
                            run Sub_Event175()
                        else:
                            run Sub_Event136()
                    case 3, 4:
                        if EventFlowSystemActor.HasTargetItem(3545, 3):
                            run Sub_Event175()
                        else:
                            run Sub_Event136()
            else:
                run Sub_Event159()
        else:
            run Sub_Event159()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:046', false)
        return

local flow Sub_Event73():
    MainNpc.SetCarnivalRewardItem()
    MainNpc.SetItemName(1, 0, 0)
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:040', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:041', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:042', false)
    MainNpc.SetDeliveryItem(1, false)
    MainNpc.MessageSuspend()
    MainNpc.NpcDelivery(1, '"Default"')
    MainNpc.SetEventRewardToPlayerBaggage('cSwap')
    if EventFlowSystemActor.IsMyVillage():
        System.EventFlags['cPlayer:PckGiveFurnitureCount'] += 1
        if System.EventFlags['cPlayer:PckGiveFurnitureCount'] != 9:
            run Sub_grp_Event85()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:050', false)
    else:
        System.EventFlags['cPlayerVisit:DC_PckGiveFurnitureCount'] += 1
        if System.EventFlags['cPlayerVisit:DC_PckGiveFurnitureCount'] != 9:
            run Sub_grp_Event85()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:050', false)

local flow Sub_Event98():
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:060', true)
    EventFlowSystemActor.SelectRewardItemDirect(13771, 1, 'cRemakePattern0', 0)
    MainNpc.SetDeliveryItem(1, true)
    MainNpc.NpcDelivery(1, '"Default"')
    if EventFlowSystemActor.IsMyVillage():
        System.EventFlags['cPlayer:PckGiveFurnitureCount'] = 0
    else:
        System.EventFlags['cPlayerVisit:DC_PckGiveFurnitureCount'] = 0
    EventFlowSystemActor.SetMemoryEventPlayer('cBlancoEventPlayer:PE_Carnival_GetFloat')
    MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:061', false)

local flow Sub_grp_Event0():
    if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:011', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:010', false)
        run Get_Recipe()

local flow Sub_grp_Event114():
    if EventFlowSystemActor.HasTargetItem(3548, 3):
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:051', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.SetDeliveryItemAtRandom(3548, false, 'cVillageRemakePattern', 0)
            EventFlowSystemActor.DeleteTargetItem(3548, 3, false)
            MainNpc.NpcDelivery(0, 'Default')
            run Dance_Rainbow_Comp()
            run Get_Item()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:056', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:048', false)

local flow Sub_grp_Event85():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:043', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:044', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/pck/SP_pck:045', false)

flow Talk_Recipe():
    run Event174()

