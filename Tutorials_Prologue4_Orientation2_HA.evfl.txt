flow Prologue_NnpcTentChk():
    if System.EventFlags['cLand:Prologue4BuiltNpcAN']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:008_02', true)
        Player.TurnNeck(11, false)
        EventFlowSystemActor.WaitFrame(10)
        EventFlowSystemActor.SetNpcAIBlackBoardByLabel('rco', 'isSpeak', 1, 1)
    elif System.EventFlags['cPlayer:Prologue4AnGetTent']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:025_02', false)
    else:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:008_03', false)

flow Root():
    MainNpc.SetNpcName(14, 0)
    if not System.EventFlags['cPlayer:PrologueDone1stTalkAtPlaza']:
        if MainNpc.NpcBlackBoard('ArrivePlaza', 1):
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue_FreeTalk_HA:002', false)
        else:
            switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, false):
                case 0:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue_FreeTalk_HA:000_01', false)
                case 1:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue_FreeTalk_HA:000_02', false)
                case 2:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue_FreeTalk_HA:000_03', false)
    elif System.EventFlags['cPlayer:PrologueStartedCampfire']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue_FreeTalk_HA:101', false)
    elif System.EventFlags['cPlayer:PrologueAfterBuiltTentTalk']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue_FreeTalk_HA:001', false)
    elif System.EventFlags['cLand:Prologue4BuiltNpcHA']:
        if not System.EventFlags['cPlayer:Prologue4HaGetTent']:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:021', false)
        elif System.EventFlags['cPlayer:Prologue4HaBuiltTent']:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:024', false)
            if System.EventFlags['cPlayer:Prologue4AnGetTent']:
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:025_02', false)
            else:
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:025_01', false)
        else:
            System.EventFlags['cPlayer:Prologue4HaBuiltTent'] = true
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:022', false)
            switch EventFlowSystemActor.GeneralTalkChoice2():
                case 0, 1:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:023', false)
                    run Prologue_NnpcTentChk()
    elif System.EventFlags['cPlayer:Prologue4HaGetTent']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:013', false)
    else:
        if not MainNpc.EventFlags['cNpcMemory:FirstMeetGreetAtThisVillage']:
            MainNpc.EventFlags['cNpcMemory:FirstMeetGreetAtThisVillage'] = true
            MainNpc.EventFlags['cNpcMemory:FirstMeetGreetAtThisVillageToday'] = true
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:001', false)
        if not System.EventFlags['cPlayer:PlayerPocketUIEnable']:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:002', false)
        elif System.EventFlags['cLand:Prologue4BuiltPlayer']:
            if System.EventFlags['cPlayer:Prologue4HaNoTent']:
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:014', false)
            else:
                System.EventFlags['cPlayer:Prologue4HaNoTent'] = true
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:004', false)
            MainNpc.SetDeliveryItem(3, true)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:005', true)
                    run System_Structure_Common::PreviewStructure(StructurePosType='cNpc', StructureType='cNormalNpcHouse', BuildTiming='cNew')
                    MainNpc.CharacterEmoticonAction('EmotEnd', false, '', 0, false)
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:006', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:007', true)
                        run System_Structure_Common::DeletePreviewAndBuildStructureInNpcTalk(StructurePosType='cNpc', StructureType='cNormalNpcHouse', BuildTiming='cNew')
                        MainNpc.SetItemName(3, 0, 0)
                        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:008_01', false)
                        System.EventFlags['cLand:Prologue4BuiltNpcHA'] = true
                        run Prologue_NnpcTentChk()
                    else:
                        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:010', true)
                        run System_Structure_Common::DeletePreviewStructureInNpcTalk(StructurePosType='cNpc', StructureType='cNormalNpcHouse')
                case 1:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:011', true)
                    MainNpc.SetDeliveryItem(3, true)
                    MainNpc.NpcDelivery(1, 'Keep')
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:012', false)
                    MainNpc.NpcDelivery(2, '"Default"')
                    System.EventFlags['cPlayer:Prologue4HaGetTent'] = true
                    MainNpc.NpcSetAIBlackBoard('HasTent', 0)
                    MainNpc.NpcSetAIBlackBoard('BuildingSiteIndex', -1)
                case 2:
                    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:009', false)
        else:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue4_Orientation2_HA:003', false)

