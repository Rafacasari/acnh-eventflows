flow GoToNextSeq():
    EventFlowSystemActor.SystemBGMVolumeFadeOut(0.699999988079071, 0, 0.0)
    EventFlowSystemActor.WaitFrame(21)
    run NNPC_Spot_WherearenMainFieldVisitor::SetOrderCamera()
    EventFlowSystemActor.SoundTriggerEmit('ReturnFromAmiiboPhone', -1)
    EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
    EventFlowSystemActor.WaitFrame(6)
    EventFlowSystemActor.SystemRequestChangeStage('cWherearenOrderDemo', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)

flow NewBuild():
    if EventFlowSystemActor.CheckAmiiboNPC('cSNPC'):
        MainNpc.SetReplaceSNPCMsgLabel()
        System.EventFlags['cPlayerTemp:WHEREAREN_CallSNPCAmiibo'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/sza/SP_sza_Amiibo:101', true)
    else:
        if MainNpc.IsVillagerNpc():
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenAmiibo:102', true)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenAmiibo:101', true)
    MainNpc.WherearenTakeOnNpcOrder('cNewHouse', '', '', '', '')
    EventFlowSystemActor.WherearenOrderCallback('cStart')
    run GoToNextSeq()

flow Root():
    switch MainNpc.CheckNpcCharacterSize():
        case 0:
            EventFlowSystemActor.CameraSetDemoParam('Small', '', 'CameraTag:Root', false, false, false, 0)
        case 1:
            EventFlowSystemActor.CameraSetDemoParam('Normal', '', 'CameraTag:Root', false, false, false, 0)
        case 2:
            EventFlowSystemActor.CameraSetDemoParam('Large', '', 'CameraTag:Root', false, false, false, 0)
        case 3:
            EventFlowSystemActor.CameraSetDemoParam('ExtraLarge', '', 'CameraTag:Root', false, false, false, 0)
    EventFlowSystemActor.SystemFaderRelease()
    EventFlowSystemActor.WaitFrame(30)
    if EventFlowSystemActor.WherearenOrderStatus() in (0, 2, 3, 4, 5, 6, 7):
        run NewBuild()
    else:
        run ShareHouse()

flow ShareHouse():
    if MainNpc.WherearenIsNpcLiveTogether():
        MainNpc.WherearenSetTagHousemateNpcName(0)
        if MainNpc.IsVillagerNpc():
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenAmiibo:204', true)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenAmiibo:202', true)
        EventFlowSystemActor.SoundTriggerEmit('ReturnFromAmiiboPhone', -1)
        EventFlowSystemActor.ReturnStage('', 'cNormalFader', 'cNormalFader', 'cWhite', 0.5, 0.20000000298023224)
    else:
        if MainNpc.IsVillagerNpc():
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenAmiibo:203', true)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenAmiibo:201', true)
        MainNpc.WherearenSetHousemate()
        EventFlowSystemActor.WherearenOrderCallback('cFinishLookForHousemate')
        EventFlowSystemActor.ReserveSkipSceneStartDemo()
        run GoToNextSeq()

