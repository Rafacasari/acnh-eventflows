flow Begin():
    MainNpc.EventFlags['cNpcMemory:FinishVisitPToday'] = true
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:001', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Yes()
            else:
                run No()
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:002', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Yes()
            else:
                run No()
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:003', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Yes()
            else:
                run No()

flow Begin_Ap():
    MainNpc.EventFlags['cNpcMemory:FinishVisitPToday'] = true
    if MainNpc.CheckNpcApproachType():
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:401', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.EventFlags['cNpcMemory:ApproachQuestOrdered'] = true
            run Now()
            EventFlowSystemActor.SetSharePlayChangeCondition(true)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:403', false)
            MainNpc.NpcQuestControl('cFinish')
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:402', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.EventFlags['cNpcMemory:ApproachQuestOrdered'] = true
            run Now()
            EventFlowSystemActor.SetSharePlayChangeCondition(true)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:404', false)
            MainNpc.NpcQuestControl('cFinish')

flow Confirm():
    if MainNpc.IsVisitQuestDayOfVisit(true):
        switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
            case 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:304', false)
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:305', false)
            case 2:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:306', false)
    else:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
            case 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:301', false)
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:302', false)
            case 2:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:303', false)

flow No():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:004', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:005', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:006', false)
    MainNpc.NpcQuestControl('cFinish')

flow Now():
    if EventFlowSystemActor.EnvHourCompare(23, -1, true, true) == 0:
        run QuestOrdered()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:106', false)
        MainNpc.NpcQuestControl('cFinish')

flow QuestOrdered():
    if MainNpc.EventFlags['cNpcMemory:VisitCount'] < 1:
        if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:104', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:105', false)
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:101', true, false)
        case 1:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:102', true, false)
        case 2:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:103', true, false)
    MainNpc.SystemSetVisitQuestKind('cPlayer', 'cNow')
    MainNpc.NpcQuestControl('cStart')
    EventFlowSystemActor.SetSharePlayChangeCondition(true)
    MainNpc.NpcAddFriendship(1)
    MainNpc.ChangeNpcPlace('cTalkPlayerHouse')
    MainNpc.NpcPlayReport('cVisitPStart', 0)
    EventFlowSystemActor.SystemRequestChangeStage('cTalkPlayerHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)

flow Tommorow():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:201', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:202', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:203', false)
    if MainNpc.EventFlags['cNpcMemory:VisitCount'] < 1:
        if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:207', false, false)
        else:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:208', false, false)
    else:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
            case 0:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:204', false, false)
            case 1:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:205', false, false)
            case 2:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:206', false, false)
    MainNpc.SystemSetVisitQuestKind('cPlayer', 'cTomorrow')
    MainNpc.NpcQuestControl('cStart')
    MainNpc.NpcAddFriendship(1)
    MainNpc.NpcPlayReport('cVisitPStart', 0)

flow Yes():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:007', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Now()
            else:
                run Tommorow()
        case 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:008', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Now()
            else:
                run Tommorow()
        case 2:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_VisitP_Begin:009', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Now()
            else:
                run Tommorow()

