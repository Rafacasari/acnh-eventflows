flow IntroduceCafe():
    EventFlowSystemActor.BGMPropertyControl(148)
    EventFlowSystemActor.FadeIn(false)
    EventFlowSystemActor.CameraSetDemoParam('FacilityCafeEditStartDemo', 'FacilityEditStartDemo_0', 'Player', false, false, false, 0)
    fork:
        branch:
            Player.PlayerMoveToTarget(false, 542.0, 534.0, 0.0, 0.0, false, '')
            Player.TurnBody(12, 180.0)
        branch:
            MainNpc.NpcMoveDirection(180.0, 25.0, 1, false, false)
            MainNpc.TurnBody(12, 180.0)
    EventFlowSystemActor.WaitFrame(70)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:022', false)
    run Event46()

flow IntroduceRestaurant():
    EventFlowSystemActor.BGMPropertyControl(148)
    EventFlowSystemActor.FadeIn(false)
    EventFlowSystemActor.CameraSetDemoParam('FacilityRestaurantEditStartDemo', 'FacilityEditStartDemo_0', 'Player', false, false, false, 0)
    fork:
        branch:
            Player.PlayerMoveToTarget(false, 580.0, 400.0, 0.0, 0.0, false, '')
            Player.TurnBody(12, 180.0)
        branch:
            MainNpc.NpcMoveDirection(180.0, 25.0, 1, false, false)
            MainNpc.TurnBody(12, 180.0)
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:021', false)
entrypoint Event46:
    MainNpc.TurnNeck(10, false)
    EventFlowSystemActor.WaitFrame(12)
    Player.TurnBody(11, 0.0)
    Player.TurnNeck(0, false)
    if System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:023', true)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:024', true)
    run Demo_Common_Wherearen::EditFacilityExterior()
    System.EventFlags['cPlayerTemp:WHEREAREN_OtgTalkReserve_Facility'] = true
    EventFlowSystemActor.ReserveSkipSceneStartDemo()
    System.EventFlags['cLandTemp:ReserveFaderKeep'] = true
    run `00_System_StageChange`::ChangeStage(FadeColorString='cBlack', TargetStage='cWherearenFacilityOrder', FadeOutSpeed=0.0, FadeInSpeed='cNormal', FadeOutKindString='cCircle', FadeInKindString='cCircle')

flow PostEdit():
    System.EventFlags['cWherearenPlayer:SeqRestaurantEditOngoing'] = false
    if not System.EventFlags['cWherearenPlayer:Unlock_Faclility_Restaurant']:
        System.EventFlags['cWherearenPlayer:MncGenerateInOfficeTemp'] = true
    elif System.EventFlags['cWherearenPlayer:SeqRestaurantEdit2Ongoing']:
        System.EventFlags['cWherearenPlayer:MncGenerateInOfficeRestaurantEdit2'] = true

flow PreEdit():
    EventFlowSystemActor.BGMPropertyControl(147)
    MainNpc.TurnBody(10, 0.0)
    EventFlowSystemActor.WaitFrame(5)
    Player.TurnBody(0, 0.0)
    if System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone']:
        if System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:051', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:051_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:052', true)
    else:
        if System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:041', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:041_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:042', true)
        System.EventFlags['cPlayer:WHEREAREN_Unlock_RoomDimming'] = true
        System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone'] = true

flow PreEdit_LaterCafe():
    EventFlowSystemActor.BGMPropertyControl(147)
    if System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:151_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:152', true)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:141_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:142', true)
        System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone'] = true

flow PreEdit_LaterRestaurant():
    EventFlowSystemActor.BGMPropertyControl(147)
    if System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:151', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:152', true)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:141', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:142', true)
        System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone'] = true

flow ReturnOffice():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:061', true)
    SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:062', false)
    SubNpc.TurnNeck(2, false)
    fork:
        branch:
            SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:063', true)
        branch:
            EventFlowSystemActor.WaitFrame(20)
            Npc_2.TurnNeck(1, false)
    Player.TurnNeck(2, false)
    MainNpc.TurnNeck(2, false)
    Npc_2.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:064', true)
    Npc_2.CharacterEmoticonAction('ShyBoy', true, '', 0, false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:065', false)
    Player.TurnNeck(0, false)
    SubNpc.TurnNeck(0, false)
    EventFlowSystemActor.WaitFrame(12)
    Npc_2.TurnNeck(0, false)
    if System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:066', true)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:066_01', false)
    Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
    SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:067', true)
    SubNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    MainNpc.TurnNeck(1, false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:068', false)
    Npc_2.CharacterEmoticonAction('EmotEnd', true, '', 0, true)
    MainNpc.TurnNeck(10, false)
    run SNPC_otg_01_WherearenOffice::SetSalaryForEvent()
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:069', true)
    run SNPC_otg_01_WherearenOffice::GetSalaryForEvent()
    if not System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
        run TalkAboutTerraceSalary()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:069_03', false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:070', false)
    if System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:071', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:071_01', false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:072', true)
    System.EventFlags['cWherearenPlayer:Unlock_Faclility_Restaurant'] = true
    System.EventFlags['cWherearenPlayer:Unlock_Faclility_Cafe'] = true
    System.EventFlags['cWherearenPlayer:MncGenerateInOfficeTemp'] = false
    System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone'] = false
    System.EventFlags['cPlayer:OtgTipsComplete2ndFacilityBuild'] = true
    System.EventFlags['cPlayer:OtgTipsBuildEitherCafeRestaulant'] = true
    if System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
        System.EventFlags['cPlayer:OtgTipsCompleteRestaulantBuild'] = true
    else:
        System.EventFlags['cPlayer:OtgTipsCompleteCafeBuild'] = true
    run Demo_Common_Wherearen::Demo_SetNormalPositionInOffice()
    SubflowResults[3] = 2
    run SNPC_otg_01_WherearenOffice::OrderClose_Complete()

flow ReturnOffice_2nd():
    if System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:361', false)
        SubNpc.TurnNeck(0, false)
        fork:
            branch:
                SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:362', false)
            branch:
                MainNpc.TurnNeck(1, false)
                EventFlowSystemActor.WaitFrame(15)
                Player.TurnNeck(1, false)
        fork:
            branch:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:363', false)
            branch:
                EventFlowSystemActor.WaitFrame(15)
                Player.TurnNeck(0, false)
        MainNpc.TurnNeck(10, false)
        run SNPC_otg_01_WherearenOffice::SetSalaryForEvent()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:364', true)
        run SNPC_otg_01_WherearenOffice::GetSalaryForEvent()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:365', true)
        run Sub_Event208()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:261', false)
        SubNpc.TurnNeck(0, false)
        fork:
            branch:
                SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:262', false)
            branch:
                MainNpc.TurnNeck(1, false)
                EventFlowSystemActor.WaitFrame(15)
                Player.TurnNeck(1, false)
        fork:
            branch:
                MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:263', false)
            branch:
                EventFlowSystemActor.WaitFrame(15)
                Player.TurnNeck(0, false)
        MainNpc.TurnNeck(10, false)
        run SNPC_otg_01_WherearenOffice::SetSalaryForEvent()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:264', true)
        run SNPC_otg_01_WherearenOffice::GetSalaryForEvent()
        run TalkAboutTerraceSalary()
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:265', true)
        run Sub_Event208()

flow ReturnOffice_2nd_Init():
    MainNpc.NpcAITalkCastSetting('WherearenPrologue')
    run SNPC_otg_22_WherearenEvent_ShareHouse::CastChk()

flow ReturnOffice_Init():
    MainNpc.NpcAITalkCastSetting('WherearenPrologue')

flow Root():
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:001', false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:002', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:003', false)
        System.EventFlags['cWherearenPlayer:ChoiceRestaurant'] = true
        System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe'] = true
        EventFlowSystemActor.WherearenTakeOnFacilityOrder('cRestaurant', 'cNew')
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:004', false)
        System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe'] = false
        EventFlowSystemActor.WherearenTakeOnFacilityOrder('cCafe', 'cNew')
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:005', true)
    System.EventFlags['cWherearenPlayer:SeqRestaurantEditOngoing'] = true
    System.EventFlags['cWherearenPlayer:IsFacilityEditStartDemo'] = 1
    System.EventFlags['cPlayerTemp:WHEREAREN_OtgTalkReserve_Facility'] = true
    System.EventFlags['cLandTemp:ReserveFaderKeep'] = true
    EventFlowSystemActor.ReserveSkipSceneStartDemo()
    run StartReaction()

flow Root_2nd():
    if System.EventFlags['cWherearenPlayer:ChoiceRestaurant']:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:201', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:202', true)
        EventFlowSystemActor.WherearenTakeOnFacilityOrder('cCafe', 'cNew')
        System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe'] = false
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:301', false)
        MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:302', true)
        EventFlowSystemActor.WherearenTakeOnFacilityOrder('cRestaurant', 'cNew')
        System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe'] = true
    System.EventFlags['cWherearenPlayer:SeqRestaurantEdit2Ongoing'] = true
    System.EventFlags['cWherearenPlayer:SeqRestaurantEditOngoing'] = true
    System.EventFlags['cWherearenPlayer:IsFacilityEditStartDemo'] = 1
    System.EventFlags['cPlayerTemp:WHEREAREN_OtgTalkReserve_Facility'] = true
    System.EventFlags['cLandTemp:ReserveFaderKeep'] = true
    EventFlowSystemActor.ReserveSkipSceneStartDemo()
    run StartReaction()

flow StartReaction():
    EventFlowSystemActor.SystemBGMVolumeFadeOut(0.800000011920929, 0, 0.0)
    fork:
        branch:
            Player.CharacterEmoticonAction('Assent', true, '', 0, false)
        branch:
            MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    EventFlowSystemActor.WherearenOrderCallback('cStart')
    EventFlowSystemActor.WherearenOrderCallback('cConfirm')
    EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
    EventFlowSystemActor.WaitFrame(6)
    EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
    EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
    if System.EventFlags['cWherearenPlayer:WhichBuildRestaurantCafe']:
        EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:RestaurantEditStartDemo_0', 'Player', false)
    else:
        EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:CafeEditStartDemo_0', 'Player', false)
    EventFlowSystemActor.SystemRequestChangeStage('cWherearenFacilitySuspended', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)

local flow Sub_Event208():
    System.EventFlags['cWherearenPlayer:SeqRestaurantEdit2Ongoing'] = false
    System.EventFlags['cPlayer:OtgTipsBuildEitherCafeRestaulant'] = false
    System.EventFlags['cWherearenPlayer:MncGenerateInOfficeRestaurantEdit2'] = false
    System.EventFlags['cWherearenPlayer:FacilityPreEditTalkDone'] = false
    run Demo_Common_Wherearen::Demo_SetNormalPositionInOffice_NoFlagChange()
    SubflowResults[3] = 2
    run SNPC_otg_01_WherearenOffice::OrderClose_Complete()

flow TalkAboutTerraceSalary():
    MainNpc.TurnNeck(1, false)
    MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_06_WherearenEvent_RestaurantCafe:069_01', true)
    MainNpc.CharacterEmoticonAction('FaintSmile', true, '', 0, false)
    Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, false)
    SubNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    MainNpc.TurnNeck(10, false)

