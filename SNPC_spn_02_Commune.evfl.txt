flow ChkATMNotice():
    switch SubflowResults@3[2]:
        case 1:
            if not System.EventFlags['cPlayer:SpnCommuneATMNoticeDone']:
                switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cPlayerTemp:SpnCheckPlace'):
                    case 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1061', false)
                        run Sub_Event218()
                    case 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1061_01', false)
                        run Sub_Event218()
                    default:
                        return
        case 2:
            System.EventFlags['cPlayer:SpnCommuneATMNoticeDone'] = true
        default:
            return

flow ChkEnableDonation():
    SubflowResults[1] = 0
    SubflowResults[2] = 0
    SubflowResults[3] = 0
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneSloDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneCmlDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneFoxDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneBptDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneSkkDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneAlpDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneTtlDonation'):
        case 0:
            SubflowResults[3] = 1
        case 1:
            SubflowResults[1] = 1
        case 2:
            SubflowResults[2] = 1
    if (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneSloDonation') == 2) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneCmlDonation') == 2) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneFoxDonation') == 2) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneBptDonation') == 2) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneSkkDonation') == 2) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneAlpDonation') == 2) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneTtlDonation') == 2):
        SubflowResults[1] = 1
        SubflowResults[2] = 2

flow Root():
    run ToJuneBrideStudio()
    if not System.EventFlags['cPlayer:SpnFirstTalkedAtCommuneIsland']:
        System.EventFlags['cPlayer:SpnFirstTalkedAtCommuneIsland'] = true
        if System.EventFlags['cPlayer:SpnTalkAtHomelandToday']:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_01_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_01_02', false)
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_02', false)
        System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
    elif System.EventFlags['cPlayer:SpnTodayCompleteDonation']:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1052', false)
        System.EventFlags['cPlayer:SpnTodayCompleteDonation'] = false
        System.EventFlags['cPlayer:SpnTodayThanksDonation'] = true
        System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
    elif not System.EventFlags['cPlayer:SpnTodayDonation']:
        run SkipThanksDonation()
    elif System.EventFlags['cPlayer:SpnTodayThanksDonation']:
        run SkipThanksDonation()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1051', false)
        System.EventFlags['cPlayer:SpnTodayDonation'] = false
        System.EventFlags['cPlayer:SpnTodayThanksDonation'] = true
        System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true

flow SkipThanksDonation():
    if not System.EventFlags['cPlayer:SpnTalkAtCommuneToday']:
        System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
        if System.EventFlags['cPlayer:SpnPhotoStudioGuideDone']:
            switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cPlayerTemp:SpnCheckPlace'):
                case 0:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:021', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:022', false)
                case 1:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1001', false)
                    run ChkEnableDonation()
                    if SubflowResults@2[1] == 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1002', false)
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1011', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:011', false)
    elif not System.EventFlags['cPlayer:SpnPhotoStudioGuideDone']:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:002', false)
    elif System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        run v200_SpnMainSel()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:023', false)
        run SNPC_spn_03_Studio::Spn_Explain_Select()

flow Spn_JuneBride_GetFence():
    switch SubflowResults@8[0]:
        case 6:
            if not System.EventFlags['cPlayer:AlwJuneBrideQuestClearFlag']:
                run Sub_grp_Event59()
        case 7:
            run Sub_grp_Event59()
        default:
            return

flow Spn_JuneBride_Select():
    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:010', false)
    run Event31()

local flow Sub_Event110():
    EventFlowSystemActor.MessageSuspend()
    MainNpc.SetDeliveryItem(1, true)
    MainNpc.NpcDelivery(1, 'Default')
    System.EventFlags['cPlayer:SpnJuneBrideGetFenceFrag'] = true
    if EventFlowSystemActor.PlayerHasCraftRecipe('', 12894):
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018_01', false)
        run Sub_grp_Event72()
    elif System.EventFlags['cPlayer:MainmenuRecipe']:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018', false)
        run Sub_grp_Event72()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018_02', false)
        EventFlowSystemActor.ExitFlowchart()

local flow Sub_Event158():
    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:012', false)
    run SNPC_spn_03_Studio::Spn_Explain_Select()

local flow Sub_Event218():
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1062', false)
    System.EventFlags['cPlayer:SpnCommuneATMNoticeDone'] = true
    EventFlowSystemActor.ExitFlowchart()

local flow Sub_grp_Event161():
    if SubflowResults@2[1] == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1035', false)

local flow Sub_grp_Event179():
    switch SubflowResults@3[2]:
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1031', false)
            run Sub_grp_Event161()
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1032', false)
            if SubflowResults@2[3] == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1033_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1033', false)
                run Sub_grp_Event161()
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1034', false)

local flow Sub_grp_Event59():
    if not System.EventFlags['cPlayer:SpnJuneBrideGetFenceFrag']:
        if System.EventFlags['cPlayer:SpnJuneBrideNotGetFenceTodayFrag']:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 12894):
                EventFlowSystemActor.SelectRewardItemDirect(12546, 10, 'cVillageRemakePattern', 0)
                if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_04_01', false)
                    run Sub_Event110()
            else:
                MainNpc.NpcSetRewardRecipe(12894, false)
                if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_04', false)
                    run Sub_Event110()
        else:
            if EventFlowSystemActor.PlayerHasCraftRecipe('', 12894):
                EventFlowSystemActor.SelectRewardItemDirect(12546, 10, 'cVillageRemakePattern', 0)
            else:
                MainNpc.NpcSetRewardRecipe(12894, false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_01', false)
            if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
                if EventFlowSystemActor.PlayerHasCraftRecipe('', 12894):
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_02_01', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_02', false)
                run Sub_Event110()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_03', false)
                System.EventFlags['cPlayer:SpnJuneBrideNotGetFenceTodayFrag'] = true
                EventFlowSystemActor.ExitFlowchart()

local flow Sub_grp_Event72():
    switch SubflowResults@8[0]:
        case 6:
            EventFlowSystemActor.ExitFlowchart()
        case 7:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:019', false)
entrypoint Event31:
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:011', false)
                    EventFlowSystemActor.MessageSuspend()
                    EventFlowSystemActor.SystemRequestChangeStage('cJuneBrideStudio', 'cCircle', 'cHeartWipe', 'cBlack', 1.0, 1.0)
                case 1:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:012', false)
                    run SNPC_spn_03_Studio::Spn_Explain_Select()
                case 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:013', false)
            EventFlowSystemActor.ExitFlowchart()
        default:
            return

local flow Sub_grp_Event73():
    if EventFlowSystemActor.EnvCheckBetweenDate(6, 30, 6, 30, 'cLastGrowUpTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014_03', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014_01', false)
    EventFlowSystemActor.ExitFlowchart()

flow ToJuneBrideStudio():
    if not EventFlowSystemActor.TermEventNow('JuneBride', false):
        if (EventFlowSystemActor.EnvCheckBetweenDate(7, 1, 7, 7, 'cGrowUpTime')) and (System.EventFlags['cPlayer:SpnJuneBrideTalkEventFrag']) and (not System.EventFlags['cPlayer:SpnJuneBrideClearTalkFrag']):
            if System.EventFlags['cPlayer:AlwJuneBrideDayCount'] != 0:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:020', false)
                if System.EventFlags['cPlayer:AlwJuneBrideDayCount'] < 6:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:026', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:025', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:027', false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:028', false)
            System.EventFlags['cPlayer:SpnJuneBrideClearTalkFrag'] = true
            EventFlowSystemActor.ExitFlowchart()
    elif System.EventFlags['cPlayer:CommuneIslandAvailable']:
        run SNPC_alw_01_Studio::Alw_DayChk()
        if not System.EventFlags['cPlayer:AlwJuneBrideQuestClearFlag']:
            if System.EventFlags['cPlayer:SpnTalkAtCommuneToday']:
                run Spn_JuneBride_GetFence()
                run Spn_JuneBride_Select()
            else:
                System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:009', false)
                run Spn_JuneBride_GetFence()
                run Spn_JuneBride_Select()
        elif not System.EventFlags['cPlayer:SpnJuneBrideClearTalkFrag']:
            System.EventFlags['cPlayer:SpnJuneBrideClearTalkFrag'] = true
            System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
            switch SubflowResults@8[0]:
                case 0, 1, 2, 3, 4, 5:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014', false)
                    run Sub_grp_Event73()
                case 6:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:015', false)
                    run Spn_JuneBride_GetFence()
                    EventFlowSystemActor.ExitFlowchart()
                case 7:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:016', false)
                    run Spn_JuneBride_GetFence()
                    run Sub_grp_Event73()
        elif SubflowResults@8[0] in (0, 1, 2, 3, 4, 5):
            run Spn_JuneBride_Select()
        else:
            run Spn_JuneBride_GetFence()
            run Spn_JuneBride_Select()

flow v200_SpnFreeTalk():
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1101', false)
    switch EventFlowSystemActor.RandomChoice5(5):
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1102', false)
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1103', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1104', false)
        case 3:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1105', false)
        case 4:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1106', false)

flow v200_SpnMainSel():
    run ChkEnableDonation()
    if EventFlowSystemActor.FlagSystemIntValue3(3, 'cPlayerTemp:SpnCheckPlace') in (0, 1):
        run ChkATMNotice()
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1022', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                run Sub_Event158()
            case 1:
                run Sub_grp_Event179()
            case 2:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1041', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1021', false)
        switch EventFlowSystemActor.GeneralTalkChoice4():
            case 0:
                run Sub_Event158()
            case 1:
                run Sub_grp_Event179()
            case 2:
                run v200_SpnFreeTalk()
            case 3:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:1041', false)

