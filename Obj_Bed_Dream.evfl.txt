flow Bed_CancelDream():
    EventFlowSystemActor.StoreNormalCamera(false, '')

flow Bed_MyHome():
    if Player.PlayerBedWaitCanopy():
        EventFlowSystemActor.CameraSetDemoParam('ToDreamZoomOutLow', 'cDefault', 'Player', true, false, false, 0)
    else:
        EventFlowSystemActor.CameraSetDemoParam('ToDreamZoomOut', 'cDefault', 'Player', true, false, false, 0)
    Player.OpenMessageWindow('TalkObj/OBJ_Bed:001', false)
    if EventFlowSystemActor.GeneralTalkChoice2() != 0:
        run Bed_CancelDream()
    elif EventFlowSystemActor.IsSharePlay(0):
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:006', false)
        run Bed_CancelDream()
    elif (System.EventFlags['cLandTemp:NpcVisitPlayerHouse']) or (EventFlowSystemActor.NetHasVisitor()):
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:003', false)
        run Bed_CancelDream()
    elif EventFlowSystemActor.IsVillageGateOpened():
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:002', false)
        run Bed_CancelDream()
    elif EventFlowSystemActor.NetIsConnected():
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:004', false)
        run Bed_CancelDream()
    elif Player.PlayerIsEquipToolTowel():
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:008', false)
        run Bed_CancelDream()
    elif System.EventFlags['cPlayer:EquipLicenseHelmet']:
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:005', false)
        run Bed_CancelDream()
    elif Player.PlayerIsUseCoordinate():
        MainNpc.OpenMessageWindow('TalkObj/OBJ_Bed:007', false)
        run Bed_CancelDream()
    else:
        if System.EventFlags['cPlayer:TapDreamFirstTalk']:
            System.EventFlags['cLandTemp:TapIndoorPos'] = true
        else:
            System.EventFlags['cLandTemp:TapIndoorPos'] = false
        EventFlowSystemActor.MiniGameSilentCancel()
        EventFlowSystemActor.SoundDuckingOn(43)
        Player.PlayerClearFoodPowerup()
        EventFlowSystemActor.MessageSuspend()
        Player.PlayerStartAnimeBedWaitWithHandsClasped()
        EventFlowSystemActor.WaitFrame(40)
        EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:InIdrDreamZoomOut', '', false)
        if Player.PlayerBedWaitCanopy():
            EventFlowSystemActor.CameraSetDemoParam('ToDreamZoomInLow', 'ToDreamZoomInOut', 'Player', true, false, false, 0)
        else:
            EventFlowSystemActor.CameraSetDemoParam('ToDreamZoomIn', 'ToDreamZoomInOut', 'Player', true, false, false, 0)
        EventFlowSystemActor.SoundTriggerEmit('WipeToIdrDream', -1)
        EventFlowSystemActor.NextLPFadeTime(3.5)
        EventFlowSystemActor.SystemRequestChangeStage('cDreamHouse', 'cDream', 'cDream', 'cBlack', 1.0, 1.0)

flow Bed_Wakeup():
    run SNPC_tap_02_InDreaming::Wakeup()

