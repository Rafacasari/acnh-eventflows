flow FinishSet():
    MainNpc.NpcQuestControl('cFinish')
    System.EventFlags['cLifeSupportDaily:AchieveQuest'] = true
    System.EventFlags['cLifeSupportAchievement:AchieveVillagersQuest'] += 1
    MainNpc.EventFlags['cNpcMemory:OrderQuest'] = true

flow Report():
    MainNpc.SetNpcName(8, 0)
    switch MainNpc.DeliveryQuestType():
        case 0:
            run ReportA()
        case 1:
            run ReportB()
        case 2:
            run ReportC()
        case 3:
            run ReportD()
        case 4:
            run ReportE()
    MainNpc.NpcAddFriendship(3)

flow ReportA():
    if MainNpc.QuestFlags['cDeliveryQuizPlay']:
        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:002', true, true)
        run FinishSet()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:001', false)
        if (MainNpc.QuestFlags['cDeliveryItemOpen']) and (not MainNpc.QuestFlags['cDeliveryWrappingAgain']):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:004', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                if MainNpc.QuestFlags['cDeliveryWiseUp']:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:006', true, true)
                else:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:007', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:005', true, true)
            run FinishSet()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:003', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                switch MainNpc.DeliveryQuestReceiveNpcLook():
                    case 0:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:008', true, true)
                    case 1:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:009', true, true)
                    case 2:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:010', true, true)
                    case 3:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:011', true, true)
                    case 4:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:012', true, true)
                    case 5:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:013', true, true)
                    case 6:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:014', true, true)
                    case 7:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:015', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:005', true, true)
            run FinishSet()

flow ReportB():
    if MainNpc.QuestFlags['cDeliveryQuizPlay']:
        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:102', false, false)
        run FinishSet()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:101', false)
        if (MainNpc.QuestFlags['cDeliveryItemOpen']) and (not MainNpc.QuestFlags['cDeliveryWrappingAgain']):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:104', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                if MainNpc.QuestFlags['cDeliveryWiseUp']:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:106', true, true)
                else:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:107', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:105', true, true)
            run FinishSet()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:103', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                if MainNpc.QuestFlags['cDeliverySameBought']:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:108', true, true)
                else:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:109', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:105', true, true)
            run FinishSet()

flow ReportC():
    if MainNpc.QuestFlags['cDeliveryQuizPlay']:
        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:202', false, false)
        run FinishSet()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:201', false)
        if (MainNpc.QuestFlags['cDeliveryItemOpen']) and (not MainNpc.QuestFlags['cDeliveryWrappingAgain']):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:204', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                if MainNpc.QuestFlags['cDeliveryWiseUp']:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:206', true, true)
                else:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:207', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:205', true, true)
            run FinishSet()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:203', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                if MainNpc.QuestFlags['cDeliveryGetFree']:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:208', true, true)
                else:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:209', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:205', true, true)
            run FinishSet()

flow ReportD():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:301', false)
    if (MainNpc.QuestFlags['cDeliveryItemOpen']) and (not MainNpc.QuestFlags['cDeliveryWrappingAgain']):
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:303', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            if MainNpc.QuestFlags['cDeliveryWiseUp']:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:305', true, true)
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:306', true, true)
        else:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:304', true, true)
        run FinishSet()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:302', false)
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:304', true, true)
            run FinishSet()
        elif MainNpc.DeliveryQuestItemKind() == 0:
            if EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
                switch MainNpc.DeliveryQuestReceiveNpcLook():
                    case 0:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:312', true, true)
                        run FinishSet()
                    case 1:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:313', true, true)
                        run FinishSet()
                    case 2:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:314', true, true)
                        run FinishSet()
                    case 3:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:315', true, true)
                        run FinishSet()
                    case 4:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:316', true, true)
                        run FinishSet()
                    case 5:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:317', true, true)
                        run FinishSet()
                    case 6:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:318', true, true)
                        run FinishSet()
                    case 7:
                        MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:319', true, true)
                        run FinishSet()
            else:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:308', true, true)
                run FinishSet()
        else:
            if MainNpc.QuestFlags['cDeliveryClothChangeKeep']:
                MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:307', true, true)
            else:
                if MainNpc.QuestFlags['cDeliveryClothChangeAtLeast']:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:310', true, true)
                else:
                    MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:309', true, true)
            run FinishSet()

flow ReportE():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:401', false)
    if (MainNpc.QuestFlags['cDeliveryItemOpen']) and (not MainNpc.QuestFlags['cDeliveryWrappingAgain']):
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:403', false)
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:404', true, true)
        elif MainNpc.QuestFlags['cDeliveryWiseUp']:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:405', true, true)
        else:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:406', true, true)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:402', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:407', true, true)
        else:
            MainNpc.QuestStartOpenMessageWindow('TalkNNpc/B1_Bo/Quest/BO_Quest_Delivery_After:404', true, true)
    run FinishSet()

