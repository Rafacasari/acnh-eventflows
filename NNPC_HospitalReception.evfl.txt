flow Call_Player():
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.TurnBody(10, 0.0)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:006', true)
    MainNpc.NpcSetAIBlackBoard('CallRequest', 0)
    System.EventFlags['cWherearenPlayer:DoctorEventStart'] = true

flow Cancel():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:020', false)

flow Donation():
    EventFlowSystemActor.UIPokiAppear()
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:016', false)
    EventFlowSystemActor.UITenKeyHandling('cHospitalDonation')
    if EventFlowSystemActor.UIResultMenuDecide():
        EventFlowSystemActor.HospitalDonationSetTag(4, 'cLastDonate')
        switch EventFlowSystemActor.HospitalDonation():
            case 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:018', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run Donation_Yes()
                else:
                    run Donation_No()
            case 1:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:018_01', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run Donation_Yes()
                else:
                    run Donation_No()
            case 2:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:018_02', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run Donation_Yes()
                else:
                    run Donation_No()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:019', false)
        EventFlowSystemActor.UIPokiDisappear()

flow Donation_No():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:019', false)
    EventFlowSystemActor.UIPokiDisappear()

flow Donation_Yes():
    EventFlowSystemActor.UpdateHospitalDonation()
    if EventFlowSystemActor.IsAchievedHospitalDonation():
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:024', false)
        EventFlowSystemActor.HospitalDonationSetTag(5, 'cGoal')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:021', false)
        System.EventFlags['cWherearenPlayer:CompleteHospitalDonation'] = true
        System.EventFlags['cWherearenPlayer:CompleteHospitalDonation_Today'] = true
        System.EventFlags['cPlayer:OtgTipsCompleteHospitalDonation'] = true
        EventFlowSystemActor.ReservePlayerMutterDemo('Player_GetDemo_Wherearen', 'Hospital_DonationClear', 'cNowDemoEnd', false)
        EventFlowSystemActor.UIPokiDisappear()
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:023', false)
        EventFlowSystemActor.UIPokiDisappear()

flow Examination():
    MainNpc.NpcChangeHandTool(13445, 'cNone', false)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:004', false)
    switch EventFlowSystemActor.GeneralTalkChoice4():
        case 0:
            System.EventFlags['cWherearenPlayer:HospitalReceptionFlag'] = 1
            run Sub_Event59()
        case 1:
            System.EventFlags['cWherearenPlayer:HospitalReceptionFlag'] = 2
            run Sub_Event59()
        case 2:
            System.EventFlags['cWherearenPlayer:HospitalReceptionFlag'] = 3
            run Sub_Event59()
        case 3:
            run Cancel()

flow FacilityName_Chk():
    if (EventFlowSystemActor.WherearenExistFacilityName('cHospital')) and (not EventFlowSystemActor.PercentChoice(80)):
        EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cSelectFacility', 0, 'cHospital')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Facility_Hospital:003', false)
        run KKFes_Chk()
        EventFlowSystemActor.ExitFlowchart()

flow FesDance():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Facility_KKFes:102_01', true)
    run Demo_Common_Wherearen::ToKKFesDemoLive()

flow HospitalEvent():
    MainNpc.TurnBody(10, 0.0)
    if System.EventFlags['cWherearenPlayer:DoctorEventStart']:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:007', false)
    elif EventFlowSystemActor.FlagSystemIntValue4(4, 'cWherearenPlayer:HospitalReceptionFlag') != 0:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:006_01', true)
    elif EventFlowSystemActor.WherearenKKFesStatus(false) in (0, 1, 3):
        if EventFlowSystemActor.IsAchievedHospitalDonation():
            switch EventFlowSystemActor.EnvTimeZone():
                case `05:00-07:59`, `08:00-11:59`:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:001_01', false)
                case `12:00-15:59`, `16:00-18:59`:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:002_01', false)
                case `19:00-23:59`, `00:00-04:59`:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:003_01', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Examination()
            else:
                run Cancel()
        else:
            switch EventFlowSystemActor.EnvTimeZone():
                case `05:00-07:59`, `08:00-11:59`:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:001', false)
                case `12:00-15:59`, `16:00-18:59`:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:002', false)
                case `19:00-23:59`, `00:00-04:59`:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:003', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run Examination()
                case 1:
                    run Donation()
                case 2:
                    run Cancel()
    elif EventFlowSystemActor.IsAchievedHospitalDonation():
        switch EventFlowSystemActor.EnvTimeZone():
            case `05:00-07:59`, `08:00-11:59`:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:011_01', false)
            case `12:00-15:59`, `16:00-18:59`:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:012_01', false)
            case `19:00-23:59`, `00:00-04:59`:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:013_01', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                run Examination()
            case 1:
                run FesDance()
            case 2:
                run Cancel()
    else:
        switch EventFlowSystemActor.EnvTimeZone():
            case `05:00-07:59`, `08:00-11:59`:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:011', false)
            case `12:00-15:59`, `16:00-18:59`:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:012', false)
            case `19:00-23:59`, `00:00-04:59`:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:013', false)
        switch EventFlowSystemActor.GeneralTalkChoice4():
            case 0:
                run Examination()
            case 1:
                run Donation()
            case 2:
                run FesDance()
            case 3:
                run Cancel()

flow IntroductionHospital():
    if not System.EventFlags['cWherearenPlayer:ReceptionTalkAboutHospital']:
        MainNpc.TurnNeck(10, false)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:009', false)
        System.EventFlags['cWherearenPlayer:ReceptionTalkAboutHospital'] = true
        EventFlowSystemActor.ExitFlowchart()

flow KKFes_Chk():
    if (not EventFlowSystemActor.IsInspectingWherearen()) and (EventFlowSystemActor.WherearenKKFesStatus(false) == 2):
        MainNpc.TurnNeck(10, true)
        MainNpc.NpcKKFesJoinOpenMessage('TalkNNpc/B1_Bo/OneRoom/BO_Facility_KKFes:001')
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Facility_KKFes:102_02', true)
            run Demo_Common_Wherearen::ToKKFesDemoLive()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Facility_KKFes:200', false)
        EventFlowSystemActor.ExitFlowchart()

flow Reception():
    if EventFlowSystemActor.IsInspectingWherearen():
        run Sub_Event55()
    else:
        run IntroductionHospital()
        run ShareHouseMate_Chk()
        if System.EventFlags['cWherearenPlayer:GetMedicalEquipToday']:
            run Sub_Event55()
        else:
            run HospitalEvent()

flow Root():
    if EventFlowSystemActor.IsInspectingWherearen():
        run Sub_Event56()
    else:
        run IntroductionHospital()
        run ShareHouseMate_Chk()
        if System.EventFlags['cWherearenPlayer:GetMedicalEquipToday']:
            run Sub_Event56()
        else:
            run HospitalEvent()

flow ShareHouseMate_Chk():
    if EventFlowSystemActor.WherearenOrderStatus() == 1:
        MainNpc.TurnNeck(10, false)
        run NNPC_Spot_WherearenMainFieldVisitor::LookforHouseMate()
        EventFlowSystemActor.ExitFlowchart()

flow StandSleep():
    run NNPC_RestaurantCustomer::`StandSleep_2.1`()

local flow Sub_Event55():
    run FacilityName_Chk()
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Facility_Hospital:002', false)
    run Event32()

local flow Sub_Event56():
    run FacilityName_Chk()
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Facility_Hospital:001', false)
entrypoint Event32:
    if not EventFlowSystemActor.IsInspectingWherearen():
        if EventFlowSystemActor.WherearenKKFesStatus(false) not in (0, 1, 3):
            MainNpc.TurnNeck(10, true)
            if EventFlowSystemActor.IsAchievedHospitalDonation():
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:014_01', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run FesDance()
                else:
                    run Cancel()
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:014', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        run Donation()
                    case 1:
                        run FesDance()
                    case 2:
                        run Cancel()
        elif not EventFlowSystemActor.IsAchievedHospitalDonation():
            MainNpc.TurnNeck(10, true)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:008', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run Donation()
            else:
                run Cancel()

local flow Sub_Event59():
    MainNpc.Karte(0)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:005', true)
    MainNpc.Karte(1)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_FacilityEvent_Hospital:005_01', true)
    MainNpc.NpcSetAIBlackBoard('CallRequest', 1)
    MainNpc.NpcSetAIBlackBoard('CallCount', 180)

