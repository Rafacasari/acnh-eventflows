flow DecieUnlockHairrStyle():
    switch EventFlowSystemActor.RandomChoice7(7):
        case 0:
            run UnlockHairStyleSlo1()
            run UnlockHairStyleCml2()
            run UnlockHairStyleFox3()
            run UnlockHairStylePbt4()
            run UnlockHairStyleSkk5()
            run UnlockHairStyleAlp6()
            run UnlockHairStyleTtl7()
        case 1:
            run UnlockHairStyleCml2()
            run UnlockHairStyleFox3()
            run UnlockHairStylePbt4()
            run UnlockHairStyleSkk5()
            run UnlockHairStyleAlp6()
            run UnlockHairStyleTtl7()
            run UnlockHairStyleSlo1()
        case 2:
            run UnlockHairStyleFox3()
            run UnlockHairStylePbt4()
            run UnlockHairStyleSkk5()
            run UnlockHairStyleAlp6()
            run UnlockHairStyleTtl7()
            run UnlockHairStyleSlo1()
            run UnlockHairStyleCml2()
        case 3:
            run UnlockHairStylePbt4()
            run UnlockHairStyleSkk5()
            run UnlockHairStyleAlp6()
            run UnlockHairStyleTtl7()
            run UnlockHairStyleSlo1()
            run UnlockHairStyleCml2()
            run UnlockHairStyleFox3()
        case 4:
            run UnlockHairStyleSkk5()
            run UnlockHairStyleAlp6()
            run UnlockHairStyleTtl7()
            run UnlockHairStyleSlo1()
            run UnlockHairStyleCml2()
            run UnlockHairStyleFox3()
            run UnlockHairStylePbt4()
        case 5:
            run UnlockHairStyleAlp6()
            run UnlockHairStyleTtl7()
            run UnlockHairStyleSlo1()
            run UnlockHairStyleCml2()
            run UnlockHairStyleFox3()
            run UnlockHairStylePbt4()
            run UnlockHairStyleSkk5()
        case 6:
            run UnlockHairStyleTtl7()
            run UnlockHairStyleSlo1()
            run UnlockHairStyleCml2()
            run UnlockHairStyleFox3()
            run UnlockHairStylePbt4()
            run UnlockHairStyleSkk5()
            run UnlockHairStyleAlp6()

flow Root():
    System.EventFlags['cPlayer:PooTalkToday'] = true
    if System.EventFlags['cPlayer:PooTodayGetHairStyle']:
        if (not System.EventFlags['cPlayer:PooUndoHairStyelAfterArrange']) and (System.EventFlags['cPlayerTemp:PooStylingThisScene']):
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:051', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:052', false)
    else:
        if System.EventFlags['cPlayer:PooTalkAboutHairArrange']:
            if System.EventFlags['cPlayer:PooRefuseHairArrange']:
                MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:031', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:001', false)
                MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:041', false)
        else:
            System.EventFlags['cPlayer:PooTalkAboutHairArrange'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:001', false)
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:002', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            run StylingDemo1()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:021', false)
            System.EventFlags['cPlayer:PooRefuseHairArrange'] = true

flow StylingDemo1():
    SubflowResults[2] = 0
    SubflowResults[3] = 0
    if SubflowResults@2[1] == 0:
        if Player.PlayerIsEquipedCap():
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:003_01_02', true)
            EventFlowSystemActor.WaitFrame(15)
            Player.TurnBody(11, 0.0)
            Player.TurnNeck(11, true)
            Player.PlayerTakeoffCapTemporarily(true)
            SubflowResults[2] = 1
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:003_01_01', true)
    else:
        if Player.PlayerIsEquipedCap():
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:003_02_02', true)
            SubflowResults[2] = 1
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:003_02_01', true)
    run `00_Demo_Fade`::FadeOut_Cmn(FadeColor='cBlack', FadeType='cCircle', FadeSpeed='cNormal', SoundDucking='cAllDucking')
    Player.TurnBody(11, 0.0)
    EventFlowSystemActor.SoundDuckingOn(66)
    EventFlowSystemActor.BGMPropertyControl(161)
    EventFlowSystemActor.CameraSetDemoParam('PooHairStyling', 'cDefault', 'Npc:poo', false, false, false, 0)
    if SubflowResults@2[1] == 0:
        Player.PlayerToolPutawayNoAction()
        Player.PlayerChairWaitImmediately(745.0, 4.5, 590.0, 'cS')
        System.EventFlags['cPlayerTemp:CommuneTalkSitDown'] = true
    else:
        if Player.PlayerIsEquipedCap():
            Player.PlayerTakeoffCapTemporarily(false)
    Player.TurnNeck(11, true)
    MainNpc.TurnNeck(11, true)
    MainNpc.TurnBody(11, 0.0)
    MainNpc.TurnBody(10, 0.0)
    MainNpc.NpcWaitTurn()
    MainNpc.NpcChangeHandTool(14858, 'cNone', true)
    MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    run StylingDemo2()
    EventFlowSystemActor.WaitFrame(5)
    EventFlowSystemActor.SetMemoryEventPlayer('cBlancoEventPlayer:PE_ChangeNewHair_ByPoo')
    EventFlowSystemActor.ReservePlayerMutterDemo('Player_GetDemo_Once', 'GetHairStyleFromPoo', 'cNowDemoEnd', false)

flow StylingDemo2():
    run `00_Demo_Fade`::FadeIn_Cmn(IsWait=true)
    MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:004', true)
    run DecieUnlockHairrStyle()
    SubflowResults[3] = 0
    run StylingDemo3()
    System.EventFlags['cPlayer:PooTodayGetHairStyle'] = true
    MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:005', false)
    EventFlowSystemActor.BGMPropertyControl(162)
    MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:006', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:007', false)
        System.EventFlags['cPlayerTemp:PooStylingThisScene'] = true
        run Sub_Event192()
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:008', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            EventFlowSystemActor.AcceptFlowSwitchTag()
            fork:
                branch:
                    MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:009', true)
                branch:
                    EventFlowSystemActor.WaitFlowSwitchTag()
                    EventFlowSystemActor.BGMPropertyControl(161)
            SubflowResults[3] = 1
            run StylingDemo3()
            System.EventFlags['cPlayer:PooUndoHairStyelAfterArrange'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:010', false)
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:012', false)
            EventFlowSystemActor.BGMPropertyControl(162)
            run Sub_Event192()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:011', false)
            MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:012', false)
            run Sub_Event192()

flow StylingDemo3():
    EventFlowSystemActor.SoundDuckingOn(67)
    fork:
        branch:
            MainNpc.NpcStartAS('PooStyling', true, true)
            MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
        branch:
            Player.PlayerStyling()
            EventFlowSystemActor.WaitFrame(77)
            if SubflowResults@2[3] == 0:
                run StylingDemo_ChangeHairStyle()
            else:
                Player.PlayerRestoreHairStyle()
            Player.PlayerExhausted()
            EventFlowSystemActor.SoundDuckingOff(67)
            EventFlowSystemActor.WaitFrame(55)
            Player.PlayerShakeHead()
            EventFlowSystemActor.WaitFrame(30)

flow StylingDemo_ChangeHairStyle():
    switch SubflowResults@8[0]:
        case 1:
            Player.PlayerSetHairStyle(38)
        case 2:
            Player.PlayerSetHairStyle(40)
        case 3:
            Player.PlayerSetHairStyle(47)
        case 4:
            Player.PlayerSetHairStyle(46)
        case 5:
            Player.PlayerSetHairStyle(39)
        case 6:
            Player.PlayerSetHairStyle(43)
        case 7:
            Player.PlayerSetHairStyle(41)
        default:
            return

local flow Sub_Event192():
    MainNpc.OpenMessageWindow('TalkSNpc/poo/SP_poo_03_Commune_HairStyling:013', true)
    EventFlowSystemActor.SoundDuckingOff(66)
    fork:
        branch:
            Player.PlayerChairStandup(0)
            if SubflowResults@2[2] == 1:
                Player.PlayerPutonCapTemporarily(true)
        branch:
            MainNpc.NpcChangeHandTool(14858, 'cPutAway', false)
            MainNpc.TurnBody(10, 0.0)

flow UnlockHairStyleAlp6():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle6']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneAlpDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair43'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle6'] = true
        SubflowResults[0] = 6

flow UnlockHairStyleCml2():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle2']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneCmlDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair40'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle2'] = true
        SubflowResults[0] = 2

flow UnlockHairStyleFox3():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle3']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneFoxDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair47'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle3'] = true
        SubflowResults[0] = 3

flow UnlockHairStylePbt4():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle4']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneBptDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair46'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle4'] = true
        SubflowResults[0] = 4

flow UnlockHairStyleSkk5():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle5']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneSkkDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair39'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle5'] = true
        SubflowResults[0] = 5

flow UnlockHairStyleSlo1():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle1']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneSloDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair38'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle1'] = true
        SubflowResults[0] = 1

flow UnlockHairStyleTtl7():
    if (SubflowResults@8[0] == 0) and (not System.EventFlags['cPlayer:PooGetNewHairStyle7']) and (EventFlowSystemActor.FlagSystemIntValue3(3, 'cLand:CommuneTtlDonation') == 2):
        System.EventFlags['cPlayer:UnlockPlayerHair41'] = true
        System.EventFlags['cPlayer:PooGetNewHairStyle7'] = true
        SubflowResults[0] = 7

