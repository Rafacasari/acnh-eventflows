flow AfterRenualQuest():
    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_11_Museum1stTalk:001', false)
    if System.EventFlags['cLand:Museum3BuiltToday']:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:401', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:402', false)
    if System.EventFlags['cPlayer:Owl1stTalkMuseum1']:
        if System.EventFlags['cPlayer:OwlShowPaintingMyself']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:403', false)
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:404', false)
        if EventFlowSystemActor.MuseumComplete():
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:405', false)
            System.EventFlags['cPlayer:FutaExplanationDonationComp'] = true
        elif System.EventFlags['cPlayer:FutaExplanationDonationComp']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:406', false)
            System.EventFlags['cPlayer:FutaExplanationDonationComp'] = false
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:407', false)
        if not System.EventFlags['cPlayer:OwlShowFossilMyself']:
            System.EventFlags['cPlayer:OwlShowFossilMyself'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_11_Museum1stTalk:004_03', false)
        if EventFlowSystemActor.MuseumComplete():
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_11_Museum1stTalk:004_04', false)
            System.EventFlags['cPlayer:FutaExplanationDonationComp'] = true
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_11_Museum1stTalk:004_01', false)
        System.EventFlags['cPlayer:OwlMultiDonateExplain'] = true
        System.EventFlags['cPlayer:Owl1stTalkMuseum1'] = true
    System.EventFlags['cPlayer:Owl1stTalkMuseum2'] = true
    EventFlowSystemActor.ExitFlowchart()

flow BeforeRenualQuest():
    if (EventFlowSystemActor.MuseumLevel() == `BlathersMuseumNoArt`) and (not System.EventFlags['cPlayer:OwlShowPaintingBeforeQuest']) and (not EventFlowSystemActor.MuseumDonationNumCheck(60)) and (EventFlowSystemActor.HasKindItem('cFilter', 'Picture', 'OwlDonation1_5')):
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:201', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:202', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:203', false)
        switch EventFlowSystemActor.MuseumLevel():
            case `BlathersTent`:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:204', false)
                run Sub_Event8()
            case `BlathersMuseumNoArt`:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:205', false)
                run Sub_Event8()
            default:
                return

flow DiveFish_nothing():
    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:102', false)
    switch EventFlowSystemActor.GeneralTalkChoice5():
        case 0:
            run DonatePainting()
        case 1:
            run SNPC_owl_01_Museum_Donation::Root()
        case 2:
            run SNPC_owl_02_Museum_Judgment::Root()
        case 3:
            run SNPC_owl_03_Museum_Commentary::Root()
        case 4:
            run SNPC_owl_00_Common::End()

flow DonatePainting(MultiComplete: bool = false, CompleteRoomType: int = 0):
    if System.EventFlags['cPlayer:OwlPaintingQuestDeclined']:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:302', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:301', false)
    EventFlowSystemActor.UIItemSelectWindowHandling('cItemFilter', 65534, '', 'OwlDonation1_5', 'cItemSelect', false)
    if EventFlowSystemActor.UIResultMenuDecide():
        MainNpc.SetDeliveryItem(4, false)
        EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
        MainNpc.NpcDelivery(0, 'Keep')
        switch MainNpc.OwlDonationItemType():
            case `PictureOrSculpture`:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_00_Common:135', false)
                if System.EventFlags['cPlayer:OwlPaintingQuestDeclined']:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:307', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:306', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:310', false)
                    MainNpc.NpcDelivery(3, '"Default"')
                    MainNpc.OwlDonationDone(MultiComplete, CompleteRoomType)
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:311', false)
                    System.EventFlags['cLand:MuseumGrowupEnable2'] = true
                    System.EventFlags['cPlayer:FutaReadyForMuseum2'] = true
                    System.EventFlags['cPlayer:OwlShowPaintingMyself'] = true
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:308', false)
                    MainNpc.NpcDelivery(10, '"Default"')
                    System.EventFlags['cPlayer:OwlPaintingQuestDeclined'] = true
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:309', false)
                    run Select5_Painting_Again()
            case `PictureFakeOrSculptureFake`:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_00_Common:138', false)
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_00_Common:148', false)
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_00_Common:139', false)
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:304', false)
                System.EventFlags['cLifeSupportAchievement:DonateFake'] += 1
                MainNpc.NpcDelivery(10, '"Default"')
                run Select5_Painting_Again()
            default:
                return
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_00_Common:105', true)

flow QuestCheck():
    if (not System.EventFlags['cLand:Museum2BuiltToday']) and (EventFlowSystemActor.MuseumDonationNumCheck(60)):
        if not System.EventFlags['cLand:OwlWantsPainting']:
            System.EventFlags['cLand:OwlWantsPainting'] = true
            System.EventFlags['cLand:FoxPreVisitReserve'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:001', false)
            System.EventFlags['cPlayer:OwlPaintingQuestExplain'] = true
            System.EventFlags['cPlayer:OwlPaintingQuestReminder'] = true
            EventFlowSystemActor.ExitFlowchart()
        elif System.EventFlags['cLand:MuseumGrowupEnable2']:
            if not System.EventFlags['cPlayer:FutaReadyForMuseum2']:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:002', false)
                System.EventFlags['cPlayer:FutaReadyForMuseum2'] = true
                EventFlowSystemActor.ExitFlowchart()
        else:
            if not System.EventFlags['cPlayer:OwlPaintingQuestExplain']:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:001', false)
                System.EventFlags['cPlayer:OwlPaintingQuestExplain'] = true
                System.EventFlags['cPlayer:OwlPaintingQuestReminder'] = true
                EventFlowSystemActor.ExitFlowchart()
            elif EventFlowSystemActor.MuseumComplete():
                run Select4_Painting()
                EventFlowSystemActor.ExitFlowchart()
            else:
                run Select5_Painting()
                EventFlowSystemActor.ExitFlowchart()

flow Root():
    switch EventFlowSystemActor.MuseumLevel():
        case `BlathersMuseumNoArt`:
            run QuestCheck()
            run SNPC_owl::NoTopic()
        case `BlathersMuseumArt`, `BlathersCafe`:
            run SNPC_owl::NoTopic()
        default:
            return

flow Select4_Painting():
    if EventFlowSystemActor.HasKindItem('cFilter', 'Picture', 'OwlDonation1_5'):
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:103', false)
        switch EventFlowSystemActor.GeneralTalkChoice4():
            case 0:
                run DonatePainting()
            case 1:
                run SNPC_owl_02_Museum_Judgment::Root()
            case 2:
                run SNPC_owl_03_Museum_Commentary::Root()
            case 3:
                run SNPC_owl_00_Common::End()
    else:
        run SNPC_owl_00_Common::Select3_Comp()

flow Select4_Painting_Again():
    if EventFlowSystemActor.HasKindItem('cFilter', 'Picture', 'OwlDonation1_5'):
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:104', false)
        switch EventFlowSystemActor.GeneralTalkChoice4():
            case 0:
                run DonatePainting()
            case 1:
                run SNPC_owl_02_Museum_Judgment::Root()
            case 2:
                run SNPC_owl_03_Museum_Commentary::Root()
            case 3:
                run SNPC_owl_00_Common::End()
    else:
        run SNPC_owl_00_Common::Comp_Again()

flow Select5_Painting():
    if EventFlowSystemActor.HasKindItem('cFilter', 'Picture', 'OwlDonation1_5'):
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:101', false)
        switch EventFlowSystemActor.GeneralTalkChoice5():
            case 0:
                run DonatePainting()
            case 1:
                run SNPC_owl_01_Museum_Donation::Root()
            case 2:
                run SNPC_owl_02_Museum_Judgment::Root()
            case 3:
                run SNPC_owl_03_Museum_Commentary::Root()
            case 4:
                run SNPC_owl_00_Common::End()
    else:
        run SNPC_owl_00_Common::Select4()

flow Select5_Painting_Again():
    if not EventFlowSystemActor.HasKindItem('cFilter', 'Picture', 'OwlDonation1_5'):
        run SNPC_owl_00_Common::Select4_Again()
    elif System.EventFlags['cLand:OwlFoundDiveFish']:
        run DiveFish_nothing()
    elif not System.EventFlags['cPlayer:OwlPaintingDiveFish']:
        run DiveFish_nothing()
    elif EventFlowSystemActor.HasKindItem('cKind', 'DiveFish', ''):
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_22_Museum_RenualQuest:105', false)
        switch EventFlowSystemActor.GeneralTalkChoice6():
            case 0:
                run SNPC_owl_23_Museum_DiveFish::DonateDiveFish()
            case 1:
                run DonatePainting()
            case 2:
                run SNPC_owl_01_Museum_Donation::Root()
            case 3:
                run SNPC_owl_02_Museum_Judgment::Root()
            case 4:
                run SNPC_owl_03_Museum_Commentary::Root()
            case 5:
                run SNPC_owl_00_Common::End()
    else:
        run DiveFish_nothing()

local flow Sub_Event8():
    System.EventFlags['cPlayer:OwlShowPaintingBeforeQuest'] = true
    EventFlowSystemActor.ExitFlowchart()

flow TodayTalk1st():
    if EventFlowSystemActor.MuseumLevel() == `BlathersMuseumNoArt`:
        run QuestCheck()

