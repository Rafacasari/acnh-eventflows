flow Check(PreCheck: bool):
    SubflowResults[0] = 0
    if EventFlowSystemActor.WherearenNpcOrderType() != 0:
        run SkipFtrCheck(PreCheck=PreCheck)
    elif not EventFlowSystemActor.WherearenEditEndTerms('cIsEnteredAllRoom'):
        if PreCheck:
            SubflowResults[0] = 3
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:003_01', false)
    elif EventFlowSystemActor.WherearenIsNpcOrderFreeTheme():
        run SkipFtrCheck(PreCheck=PreCheck)
    elif EventFlowSystemActor.WherearenEditEndTerms('cOpendAllCardboard'):
        if EventFlowSystemActor.WherearenEditEndTerms('cPlacedAllMustItem'):
            run SkipFtrCheck(PreCheck=PreCheck)
        elif not PreCheck:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:003_05', false)
    elif not PreCheck:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:003', false)
    elif EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
        SubflowResults[0] = 2
    elif EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcRoom1'):
        SubflowResults[0] = 2

flow EditTheme():
    if EventFlowSystemActor.WherearenIsNpcOrderFreeTheme():
        if EventFlowSystemActor.WherearenNpcOrderType() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:022', false)
            EventFlowSystemActor.UISoftwareKeyboardHandling('cNewHouseTheme', true)
            run Sub_Event45()
        else:
            EventFlowSystemActor.WherearenSetTagRunningOrderTheme('cRunningOrder', 0, '')
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:023', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:024', false)
entrypoint Event72:
                EventFlowSystemActor.UISoftwareKeyboardHandling('cReformTheme', true)
                if EventFlowSystemActor.UIResultMenuDecide():
                    run Sub_Event45()
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:026', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        run Sub_Event70()
                    else:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:027', false)
                        run Event72()
            else:
                run Sub_Event70()
    else:
        return

flow ForceTalk_PostCameraDemo():
    EventFlowSystemActor.SoundDuckingOff(57)
    EventFlowSystemActor.SoundDuckingOff(60)
    EventFlowSystemActor.BGMPropertyControl(149)
    EventFlowSystemActor.BGMPropertyControl(181)
    EventFlowSystemActor.HousingDeliveryPhotographyBGMStart()
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
        EventFlowSystemActor.WaitFrame(15)
        run Event88()
    else:
        run Event88()

flow ForceTalk_PostCameraDemo_Direct():
    if EventFlowSystemActor.IsFirstWherearenOrderDemo():
        MainNpc.TurnBody(11, 0.0)
        SubNpc.TurnNeck(0, false)
        MainNpc.NpcAISetting(2, false)
        MainNpc.NpcAISetting(3, false)
    else:
        if not System.EventFlags['cWherearenPlayer:SeqHousePhotoTutorialDone']:
            SubNpc.TurnNeck(0, false)
        MainNpc.TurnBody(10, 0.0)
    if not EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
        EventFlowSystemActor.CameraSetDemoParam('LandingTalk', '', 'Place:SafeArea', false, false, false, 0)
    if not MainNpc.NpcIsEquipedHandTool(0):
        MainNpc.NpcChangeHandTool(65534, 'cPutAway', true)
    EventFlowSystemActor.WaitFrame(78)
    EventFlowSystemActor.SoundDuckingOff(57)
    EventFlowSystemActor.SoundDuckingOff(60)
    EventFlowSystemActor.BGMPropertyControl(149)
    EventFlowSystemActor.BGMPropertyControl(181)
    EventFlowSystemActor.HousingDeliveryPhotographyBGMStart()
    EventFlowSystemActor.SystemBGMVolumeFadeIn(0.0, 0, 0.0)
    EventFlowSystemActor.FadeIn(true)
entrypoint Event88:
    System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_AfterCompleteDemo'] = 0
    EventFlowSystemActor.WherearenOrderCallback('cPhotoModeStart')
    if System.EventFlags['cWherearenPlayer:SeqHousePhotoTutorialDone']:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:016', false)
        if EventFlowSystemActor.WherearenExistsTempSavePhoto():
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_02', false)
                EventFlowSystemActor.BGMPropertyControl(180)
            else:
                if EventFlowSystemActor.WherearenNpcOrderType() in (0, 2, 3):
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_01', false)
                    run WorkDoneReturnOffice()
                else:
                    EventFlowSystemActor.WherearenSetTagCustomerNpcName(true, 0)
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_03', false)
                    run WorkDoneReturnOffice()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_04', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_05', false)
                EventFlowSystemActor.BGMPropertyControl(180)
            else:
                if EventFlowSystemActor.WherearenNpcOrderType() in (0, 2, 3):
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_06', false)
                else:
                    EventFlowSystemActor.WherearenSetTagCustomerNpcName(true, 0)
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:017_07', false)
                run WorkDoneReturnOffice()
    elif EventFlowSystemActor.IsFirstWherearenOrderDemo():
        run SNPC_mnc_10_WherearenEvent_HouseEdit::Done()
    else:
        run NNPC_Spot_WherearenEvent_Once::HousePhoto_Start()

flow ForceTalk_PostCameraDemo_Direct_Init():
    if System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_AfterCompleteDemo'] != 2:
        if not EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
            MainNpc.NpcAISetting(4, false)
    else:
        MainNpc.NpcAITalkSubCastEntry('-Wherearen:Officer', 1)
        MainNpc.NpcAISetting(4, false)
    MainNpc.NpcAISetting(21, true)
    if EventFlowSystemActor.IsFirstWherearenOrderDemo():
        MainNpc.NpcAISetting(2, false)
        MainNpc.NpcAISetting(3, false)

flow ForceTalk_PostCameraDemo_Init():
    if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
        MainNpc.TalkCamera(false, 'cTalk', 0)
        run ForceTalk_PostCameraDemo_Direct_Init()
    else:
        run ForceTalk_PostCameraDemo_Direct_Init()

flow GivePoki():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:011', true)
    MainNpc.EventFlags['cWherearenNpcMemory:GiveDrinkDone'] = true
    System.EventFlags['cWherearenPlayer:GetDrinkCount'] += 1

flow NPCCheckAct():
    EventFlowSystemActor.MessageSuspend()
    if MainNpc.NpcIsSitting() in (0, 1, 2, 3, 5):
        EventFlowSystemActor.WaitFrame(20)
    else:
        switch SubflowResults@4[0]:
            case 0:
                MainNpc.TurnNeck(11, false)
                MainNpc.TurnBody(17, 0.0)
                EventFlowSystemActor.WaitFrame(20)
            case 3:
                EventFlowSystemActor.SetLookAtTargetObject('cWherearenNpcHouse')
                MainNpc.TurnNeck(11, false)
                MainNpc.TurnBody(13, 0.0)
                EventFlowSystemActor.WaitFrame(20)
            default:
                return

flow PostEditEvent():
    run SNPC_mnc_12_WherearenEvent_DustCloth::UnlockDustClothChk()
    run SNPC_mnc_12_WherearenEvent_DustCloth::AddDustClothChk()

flow RequestReaction():
    switch EventFlowSystemActor@NPC.RandomChoice3(3):
        case 0:
            EventFlowSystemActor.RequestHouseMateEditDoneAction('AddExcited')
            if MainNpc.NpcNowPosture() == 0:
                MainNpc.TurnBody(14, 0.0)
                MainNpc.NpcWaitTurn()
            MainNpc.CharacterEmoticonAction('AddExcited', true, '', 0, false)
        case 1:
            EventFlowSystemActor.RequestHouseMateEditDoneAction('ExistHappyDance')
            if MainNpc.NpcNowPosture() == 0:
                MainNpc.TurnBody(14, 0.0)
                MainNpc.NpcWaitTurn()
            MainNpc.CharacterEmoticonAction('ExistHappyDance', true, '', 0, false)
        case 2:
            EventFlowSystemActor.RequestHouseMateEditDoneAction('ExistLove')
            if MainNpc.NpcNowPosture() == 0:
                MainNpc.TurnBody(14, 0.0)
                MainNpc.NpcWaitTurn()
            MainNpc.CharacterEmoticonAction('ExistLove', true, '', 0, false)

flow SkipFtrCheck(PreCheck: bool):
    if not EventFlowSystemActor.WherearenEditEndTerms('cCanPlaceNpcAllRoom'):
        if PreCheck:
            if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
                SubflowResults[0] = 3
            elif not EventFlowSystemActor.WherearenEditEndTerms('cCanNotPlaceNpcNowRoom'):
                SubflowResults[0] = 2
        elif EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:003_03', false)
        elif EventFlowSystemActor.WherearenEditEndTerms('cCanNotPlaceNpcNowRoom'):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:003_02', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:003_04', false)
    elif PreCheck:
        run PostEditEvent()
        SubflowResults[0] = 1
    else:
        if (not EventFlowSystemActor.WherearenEditTime(1)) and (not EventFlowSystemActor.IsResumeWherearenOrder()) and (not System.EventFlags['cWherearenPlayer:RoomSketchPaste']):
            EventFlowSystemActor.WaitFrame(13)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:013', true)
        else:
            EventFlowSystemActor.WaitFrame(13)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:004', true)
        if (EventFlowSystemActor.WherearenEditTime(20)) and (not MainNpc.EventFlags['cWherearenNpcMemory:GiveDrinkDone']):
            run GivePoki()
        run EditTheme()
        MainNpc.TurnNeck(11, false)
        fork:
            branch:
                EventFlowSystemActor.SoundDuckingOn(60)
                Player.TurnBody(14, 0.0)
                Player.PlayerWaitTurn()
                EventFlowSystemActor.SoundTriggerEmit('Demo_Edit_Finish_NpcHouse', -1)
                Player.PlayerRequestLookDoneEditing()
                EventFlowSystemActor.EditSceneBGMEnd()
                EventFlowSystemActor.FadeOut('cOrderDemoLogoWherearenWithDispWait', 'cOrderDemoLogoWherearenWithDispWait', 'cBlack', 1.0, 1.0, true)
            branch:
                run RequestReaction()
        System.EventFlags['cWherearenPlayer:InCompleteDemo'] = true
        EventFlowSystemActor.WherearenOrderCallback('cEditEnd')
        EventFlowSystemActor.WherearenOperateNpcWithoutOfficer('cCreateForNpcOrder')
        Player.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
        EventFlowSystemActor.WaitFrame(30)
        EventFlowSystemActor.SetWherearenPlayerRemoveBinderSeq(true, false)
        EventFlowSystemActor.WherearenOrderCallback('cCompleteDemoStart')
        if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
            System.EventFlags['cWherearenPlayer:CompleteDemoStartSpot'] = 0
        else:
            if EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcRoom0'):
                System.EventFlags['cWherearenPlayer:CompleteDemoStartSpot'] = 1
            else:
                System.EventFlags['cWherearenPlayer:CompleteDemoStartSpot'] = 2
        EventFlowSystemActor.SetNpcAIBlackBoardByLabel('NpcPlayer', 'ReqCompDemo', 1, 1)
        if (EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden')) or (EventFlowSystemActor.IsFirstWherearenOrderDemo()):
            EventFlowSystemActor.SetNpcAIBlackBoardByLabel('-Wherearen:Officer', 'ReqVisible', 2, 1)

local flow Sub_Event229():
    run Check(PreCheck=true)
    switch SubflowResults@4[0]:
        case 0, 3:
            run NPCCheckAct()
        case 1:
            EventFlowSystemActor.SystemBGMVolumeFadeOut(0.10000000149011612, 0, 0.0)
            EventFlowSystemActor.WaitFrame(3)
            EventFlowSystemActor.SoundTriggerEmit('Demo_Complete_Edit', -1)
            EventFlowSystemActor.MessageSuspend()
        case 2:
            EventFlowSystemActor.MessageSuspend()
            EventFlowSystemActor.WaitFrame(20)
    run Check(PreCheck=false)

local flow Sub_Event45():
    EventFlowSystemActor.SetTagFromUIResult('cWherearenSwkbdRoomTheme', 0)
    EventFlowSystemActor.SaveSetFromUIResult('cRoomTheme')
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:028', true)

local flow Sub_Event70():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:025', true)

flow UnderOrder():
    switch MainNpc.WherearenNpcOrderRelationKind():
        case 0:
            if (not MainNpc.WherearenIsNpcHouseExtended()) and (System.EventFlags['cWherearenPlayer:Unlock_Extension']):
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:002_01', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        run Sub_Event229()
                    case 1:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:006', false)
                        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:007', false)
                            MainNpc.WherearenExpandNpcHouse()
                            run NNPC_Spot_WherearenGarden::Omakase()
                            EventFlowSystemActor.WherearenSetNpcOrderStartStage('cNpcRoomNo1')
                            System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_House'] = true
                            EventFlowSystemActor.SoundTriggerEmit('Demo_Oshigoto_Wipe', -1)
                            EventFlowSystemActor.WaitFrame(6)
                            EventFlowSystemActor.NextLPFadeTime(0.7300000190734863)
                            EventFlowSystemActor.SoundSceneChangeFadeOutDucking(10)
                            EventFlowSystemActor.SystemRequestChangeStage('cWherearenNpcStageSelected', 'cOrderWherearen', 'cOrderWherearen', 'cBlack', 1.0, 1.0)
                        else:
                            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:008', false)
                    case 2:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:005', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:002', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run Sub_Event229()
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:005', false)
        case 1:
            switch EventFlowSystemActor.WherearenNpcOrderType():
                case 1:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:139', false)
                case 2, 3:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:140', false)
                default:
                    return
        default:
            return

flow UnderShooting():
    if System.EventFlags['cWherearenPlayer:SeqHousePhotoTutorialDone']:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:018', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            if EventFlowSystemActor.WherearenNpcOrderType() in (0, 2, 3):
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:021', true)
            else:
                run NNPC_Spot_WherearenGarden::ShareHouseTag()
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:021_01', false)
            run WorkDoneReturnOffice()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenGarden:020', false)
    else:
        run NNPC_Spot_WherearenEvent_Once::HousePhoto_Done()

flow WorkDoneReturnOffice():
    fork:
        branch:
            EventFlowSystemActor.MessageSuspend()
            EventFlowSystemActor.WaitFrame(10)
            Player.CharacterEmoticonAction('Greeting', true, '', 0, false)
            EventFlowSystemActor.WaitFrame(30)
            if not EventFlowSystemActor.IsWherearenWorkMode():
                MainNpc.NpcAISetting(9, false)
                MainNpc.NpcAISetting(5, false)
                EventFlowSystemActor.ChangeWherearenWorkMode(false, true)
        branch:
            EventFlowSystemActor@Npc.WaitFrame(10)
            if EventFlowSystemActor@Npc.RandomChoice2(2) == 0:
                MainNpc.CharacterEmoticonAction('Hello', true, '', 0, false)
            else:
                MainNpc.CharacterEmoticonAction('Greeting', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(15)
    run Demo_Common_Wherearen::WorkDoneReturnOffice()

