flow `0_FlagSettings`():
    if System.EventFlags['cLand:ValidateVillageSave']:
        System.EventFlags['cLandTemp:CalendarEventStop'] = true
        if EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
            System.EventFlags['cPlayer:ThisPCcreatedbeforeOfficeUpgrading'] = true
        if EventFlowSystemActor.MuseumLevel() != `BlathersNotMovedIn`:
            System.EventFlags['cPlayer:2P_CreatedAfterOwlMoving'] = true
    else:
        System.EventFlags['cPlayer:ThisPCcreatedbeforeOfficeUpgrading'] = true
    switch EventFlowSystemActor.ShopLevel():
        case `InResServiceTent`:
            System.EventFlags['cPlayer:KaburibaConditionFlag'] = false
        case `NooksCrannyInitial`:
            if EventFlowSystemActor.FacilityOpenPastDays('cMarket1', 8):
                System.EventFlags['cPlayer:KaburibaConditionFlag'] = false
        default:
            return

flow `0_FlagSettings_ForMoving`():
    System.EventFlags['cPlayer:PlayerProducedByPlayerMoving'] = true
    if System.EventFlags['cPlayer:EnableEmoticonUI']:
        System.EventFlags['cPlayer:PlayerMovingWithEmoticonUI'] = true
        System.EventFlags['cPlayer:EnableEmoticonUI'] = false
    if System.EventFlags['cPlayer:WHEREAREN_Unlock_DustCloth_01']:
        if System.EventFlags['cPlayer:WHEREAREN_Unlock_DustCloth_02']:
            System.EventFlags['cPlayer:PMovingTmpDustCloth'] = 2
        else:
            System.EventFlags['cPlayer:PMovingTmpDustCloth'] = 1
        System.EventFlags['cPlayer:WHEREAREN_Unlock_DustCloth_01'] = false
        System.EventFlags['cPlayer:WHEREAREN_Unlock_DustCloth_02'] = false
    if not System.EventFlags['cLand:ValidateVillageSave']:
        System.EventFlags['cLand:IslandProducedByPlayerMoving'] = true

flow Apply():
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:1003_02', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run Normal_CharacterMaking()
    else:
        run Tutorials_Prologue1_Charactermaking_PlayerMoving::Root()

flow BackCut0():
    EventFlowSystemActor.CameraSetDemoParam('Cut0End', 'cDefault', 'CameraTag:Root', false, false, false, 0)
    MainNpc.LookAtPos(2, 0.0, 0.0, 0.0)
    SubNpc.LookAtPos(2, 0.0, 0.0, 0.0)

flow Charactermaking():
    System.EventFlags['cPlayer:CharacterCreationFlag'] = true
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:005_01', true)
    EventFlowSystemActor.UICharactermakingHandling('cFirstTime')
    EventFlowSystemActor.SaveSetFromUIResult('cCharaMakeResult')
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:005_02', false)

flow Continue_AfterMoving():
    run `0_FlagSettings`()
    run `0_FlagSettings_ForMoving`()
    run Event181()

flow Cut0():
    EventFlowSystemActor.UIPrologueBGAppear()
    EventFlowSystemActor.CameraSetDemoParam('Cut0Start', '', 'CameraTag:Root', false, false, false, 0)
    EventFlowSystemActor.WaitFrame(120)
    EventFlowSystemActor.UIPrologueBGDisappear()
    EventFlowSystemActor.SoundDuckingOn(29)
    EventFlowSystemActor.CameraSetDemoParam('Cut0End', 'Cut0', 'CameraTag:Root', false, false, false, 0)
    EventFlowSystemActor.WaitFrame(60)
    fork:
        branch:
            MainNpc.NpcRailMove(0, true, false, -1, -1, 1)
            MainNpc.TurnBody(12, -5.0)
        branch:
            EventFlowSystemActor.WaitFrame(30)
            SubNpc.NpcRailMove(1, true, false, -1, -1, 1)
            SubNpc.TurnBody(12, 5.0)
    EventFlowSystemActor.WaitFrame(10)

flow EndCharacterMaking():
    EventFlowSystemActor.SoundTriggerEmit('AirportAnnounce', -1)
    run ToCut1()
    EventFlowSystemActor.WaitFrame(2)
    EventFlowSystemActor.SwapSpeaker('cAnnounce', true)
    EventFlowSystemActor.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:025', false)
    MainNpc.LookAtPos(1, 0.0, 11.0, 10.0)
    SubNpc.LookAtPos(1, 0.0, 11.0, 10.0)
    if System.EventFlags['cLand:ValidateVillageSave']:
        EventFlowSystemActor.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:025_02', false)
    else:
        EventFlowSystemActor.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:025_01', true)
    EventFlowSystemActor.SwapSpeaker('cNone', true)
    EventFlowSystemActor.WaitFrame(10)
    run BackCut0()
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:026', true)
    MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    SubNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)
    EventFlowSystemActor.BGMPropertyControl(54)
    System.EventFlags['cPlayer:DoneCharacterCreation'] = true
    System.EventFlags['cLandTemp:EntryGame'] = true
    EventFlowSystemActor.SoundDuckingOff(29)
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
    run PV()

flow EnteringNameAndBday():
    EventFlowSystemActor.SoundDuckingOn(41)
    EventFlowSystemActor.UISoftwareKeyboardHandling('cName', true)
    EventFlowSystemActor.SoundDuckingOff(41)
    EventFlowSystemActor.SaveSetFromUIResult('cPlayerName')
    EventFlowSystemActor.SetTagFromUIResult('cPlayerNameNoGender', 0)
    EventFlowSystemActor.UIDateHandling('cOpeningBirthday')
    EventFlowSystemActor.SaveSetFromUIResult('cBirthDay')
    EventFlowSystemActor.WaitFrame(10)
    MainNpc.TurnBody(12, 40.0)
    MainNpc.LookAtPos(1, 0.0, 1.0, 0.0)
    SubNpc.LookAtPos(1, 5.0, 4.0, 0.0)
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.RequestSimple('NpcSpTyping', false)
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:003_03', false)
    EventFlowSystemActor.WaitFrame(20)
    MainNpc.LookAtPos(2, 0.0, 0.0, 0.0)
    MainNpc.TurnBody(12, -5.0)
    SubNpc.LookAtPos(2, 0.0, 0.0, 0.0)
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:003_05', false)

flow From_RestartMoving():
    EventFlowSystemActor.SaveSwitchMovedOneToVillager()
    EventFlowSystemActor.NoticeGameStartForPlayReport()
    run `0_FlagSettings`()
    run `0_FlagSettings_ForMoving`()
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:2051', false)
    if System.EventFlags['cLand:ValidateVillageSave']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:2053', true)
        run Tutorials_Prologue1_Charactermaking_PlayerMoving::CheckNALink()
        run From_RestartMoving_OtherP()
    else:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:2052', false)
        run Tutorials_Prologue1_Charactermaking_PlayerMoving::CheckNALink()
        run From_RestartMoving_MainP()

flow From_RestartMoving_MainP():
    run Event172()

flow From_RestartMoving_OtherP():
    run Event180()

flow Normal_CharacterMaking():
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:1003_02_01', false)
    EventFlowSystemActor.EntryPlayerVillager()
    EventFlowSystemActor.NoticeGameStartForPlayReport()
    run EnteringNameAndBday()
    run Charactermaking()
entrypoint Event181:
    if System.EventFlags['cLand:ValidateVillageSave']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:103', true)
entrypoint Event180:
        EventFlowSystemActor.ClearAllNpcOtherPlayerMoveInFlag()
    else:
entrypoint Event172:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:006', false)
        run Tutorials_Prologue1_Areacheck::Root()
        run TerrainSelect()
    run EndCharacterMaking()

flow PV():
    EventFlowSystemActor.SoundTriggerEmit('Env_PlaneInside', 1)
    EventFlowSystemActor.WaitFrame(60)
    switch EventFlowSystemActor.EnvTimeZone():
        case `05:00-07:59`, `08:00-11:59`:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:027_01', false)
        case `12:00-15:59`, `16:00-18:59`:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:027_02', false)
        case `19:00-23:59`, `00:00-04:59`:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:027_03', false)
    if System.EventFlags['cLand:ValidateVillageSave']:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:028_01', false)
        EventFlowSystemActor.ReserveNpcCommand('PrologueTanukichiNewVillager')
    else:
        MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:028', false)
        EventFlowSystemActor.EnvSetDemoTime(14, 0, 0)
        EventFlowSystemActor.TimeLock('cLockDemo')
        System.EventFlags['cPlayer:MakeVillagePlayerFlag'] = true
        System.EventFlags['cLandTemp:IsFirstPrologue'] = true
        System.EventFlags['cLand:OpeningSeqBGMChangeCounter'] = 1
        EventFlowSystemActor.ReserveNpcCommand('PrologueTanukichi')
    EventFlowSystemActor.SoundFade(1)
    EventFlowSystemActor.WaitFrame(60)
    EventFlowSystemActor.SystemRequestChangeStage('cOpeningMovie', 'cNormalFader', 'cCircle', 'cBlack', 1.0, 1.0)

flow Root():
    run `0_FlagSettings`()
    EventFlowSystemActor.BGMPropertyControl(55)
    run Cut0()
    EventFlowSystemActor.WaitFrame(20)
    if EventFlowSystemActor.HasMovedOneSaveData():
        switch EventFlowSystemActor.EnvTimeZone():
            case `05:00-07:59`, `08:00-11:59`:
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:001_01', false)
            case `12:00-15:59`, `16:00-18:59`:
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:001_02', false)
            case `19:00-23:59`, `00:00-04:59`:
                MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:001_03', false)
        if System.EventFlags['cLand:ValidateVillageSave']:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:101', false)
            SubNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:002_02', false)
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:102', false)
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:102_02', false)
        else:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:002_01', false)
            SubNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:002_02', false)
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:003_01', false)
        run Apply()
    else:
        run From_RestartMoving()

flow TerrainSelect():
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:021', true)
    EventFlowSystemActor.UIMapSelectHandling()
    EventFlowSystemActor.SaveSetFromUIResult('cVillage')
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:022', false)
    MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:023', false)
    switch EventFlowSystemActor.GeneralTalkChoice4():
        case 0, 1, 2, 3:
            MainNpc.OpenMessageWindow('Tutorials/Tutorials_Prologue1_Airport:024', true)

flow ToCut1():
    EventFlowSystemActor.CameraSetDemoParam('Cut1', 'cDefault', 'CameraTag:Root', false, false, false, 0)
    EventFlowSystemActor.WaitFrame(40)

