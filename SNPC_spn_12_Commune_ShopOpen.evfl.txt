flow Alp_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    Npc_2.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:501', false)
    if System.EventFlags['cPlayer:AlwJuneBrideTalkBeforeFlag']:
        if System.EventFlags['cPlayer:AlwJuneBrideQuestClearFlag']:
            Npc_2.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:502_01', false)
        elif ((EventFlowSystemActor.TermEventNow('JuneBride', false)) or (EventFlowSystemActor.EnvCheckBetweenDate(7, 1, 7, 7, 'cGrowUpTime'))) and (System.EventFlags['cPlayer:AlwJuneBrideDayCount'] > 0):
            Npc_2.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:502_02', false)
        else:
            Npc_2.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:502_03', false)
    else:
        Npc_2.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:502', false)
    Npc_2.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:503', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:504', false)
    if System.EventFlags['cPlayer:AlpJuneBrideTalkBeforeFlag']:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:505_01', false)
    else:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:505', false)
    if System.EventFlags['cPlayer:AlpJuneBrideTalkBeforeFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:506_01', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:506', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:507', true)
    System.EventFlags['cPlayer:DoneCommuneAlpOpenEvent'] = true
    System.EventFlags['cPlayer:TalkAlpCommuneOpenEvent'] = true
    System.EventFlags['cPlayer:AlwJuneBrideTalkBeforeFlag'] = true
    System.EventFlags['cPlayer:AlpJuneBrideTalkBeforeFlag'] = true
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_Alp')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cAlp')
    SubflowResults[0] = 5
    run FeedOut_4()

flow Alp_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('alp', 1)
    MainNpc.NpcAITalkSubCastEntry('alw', 2)

flow Bpt_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:301', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:302', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:303', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:304', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:305', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:306', true)
    System.EventFlags['cPlayer:DoneCommuneBptOpenEvent'] = true
    System.EventFlags['cPlayer:TalkBptCommuneOpenEvent'] = true
    System.EventFlags['cPlayer:BptFirstTalk'] = true
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_Bpt')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cBpt')
    SubflowResults[0] = 3
    run FeedOut()

flow Bpt_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('bpt', 1)

flow Cml_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:101', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:102', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:103', true)
    System.EventFlags['cPlayer:DoneCommuneCmlOpenEvent'] = true
    System.EventFlags['cPlayer:TalkCmlCommuneOpenEvent'] = true
    System.EventFlags['cPlayer:RollanTalkBeforeFlag'] = true
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_Cml')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cCml')
    SubflowResults[0] = 1
    run FeedOut()

flow Cml_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('cml', 1)

flow FeedOut():
    System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
    run `00_Demo_Fade`::FadeOut_Cmn(FadeType='cCircle', FadeColor='cBlack', FadeSpeed='cNormal', SoundDucking='cWorldDucking')
    Player.TurnNeck(11, false)
    Player.TurnBody(11, 0.0)
    Player.PlayerDemoTurn('cSouth')
    Player.PlayerWaitTurn()
    EventFlowSystemActor.NpcWarpCommune()
    if EventFlowSystemActor.FlagSystemIntValue3(3, 'cPlayerTemp:SpnCheckPlace') not in (0, 1):
        EventFlowSystemActor.PooWarpCommune(true)
    run AI_NPC_Spn_Commune::Spn_Pos()
    MainNpc.SetupWorkMotionForSpnPoo()
    run PlayerJumpAfterEv()
    SubNpc.NpcWarpCreatePos()
    SubNpc.TurnNeck(11, true)
    EventFlowSystemActor.StoreNormalCamera(true, '')
    EventFlowSystemActor.WaitFrame(30)
    run `00_Demo_Fade`::FadeIn_Cmn(IsWait=true)

flow FeedOut_4():
    System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
    run `00_Demo_Fade`::FadeOut_Cmn(FadeType='cCircle', FadeColor='cBlack', FadeSpeed='cNormal', SoundDucking='cWorldDucking')
    Player.TurnNeck(11, false)
    Player.TurnBody(11, 0.0)
    Player.PlayerDemoTurn('cSouth')
    Player.PlayerWaitTurn()
    EventFlowSystemActor.NpcWarpCommune()
    if EventFlowSystemActor.FlagSystemIntValue3(3, 'cPlayerTemp:SpnCheckPlace') not in (0, 1):
        EventFlowSystemActor.PooWarpCommune(true)
    run AI_NPC_Spn_Commune::Spn_Pos()
    MainNpc.SetupWorkMotionForSpnPoo()
    run PlayerJumpAfterEv()
    SubNpc.NpcWarpCreatePos()
    Npc_2.NpcWarpCreatePos()
    SubNpc.TurnNeck(11, true)
    Npc_2.TurnNeck(11, true)
    EventFlowSystemActor.AlpSetupKeepBuckBox()
    EventFlowSystemActor.StoreNormalCamera(true, '')
    EventFlowSystemActor.WaitFrame(30)
    run `00_Demo_Fade`::FadeIn_Cmn(IsWait=true)

flow Fox_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:201', false)
    if System.EventFlags['cPlayer:TunekichiTalkBefore']:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:202_01', false)
    else:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:202', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:203', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:204', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:205', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:206', true)
    System.EventFlags['cPlayer:DoneCommuneFoxOpenEvent'] = true
    System.EventFlags['cPlayer:TalkFoxCommuneOpenEvent'] = true
    System.EventFlags['cPlayer:FoxCommuneTalkLotteryTodayFlag'] = true
    System.EventFlags['cPlayer:TunekichiTalkBefore'] = true
    if System.EventFlags['cPlayer:FoxTalkOnlyStandShopFlag']:
        System.EventFlags['cPlayer:FoxTalkOnlyStandShopFlag'] = false
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_Fox')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cFox')
    SubflowResults[0] = 2
    run FeedOut()

flow Fox_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('fox', 1)

flow PlayerJumpAfterEv():
    switch SubflowResults@7[0]:
        case 0:
            run Demo_Common_Commune::SloOpen_PlayerJumpPos()
        case 1:
            run Demo_Common_Commune::CmlOpen_PlayerJumpPos()
        case 2:
            run Demo_Common_Commune::FoxOpen_PlayerJumpPos()
        case 3:
            run Demo_Common_Commune::BptOpen_PlayerJumpPos()
        case 4:
            run Demo_Common_Commune::SkkOpen_PlayerJumpPos()
        case 5:
            run Demo_Common_Commune::AlpOpen_PlayerJumpPos()
        case 6:
            run Demo_Common_Commune::TtlOpen_PlayerJumpPos()
            SubNpc.TtlSetItemTool()

flow Skk_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:401', false)
    if System.EventFlags['cPlayer:SkkTalkBeforeFlag']:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:402_01', false)
    else:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:402', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:403', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:404', true)
    System.EventFlags['cPlayer:DoneCommuneSkkOpenEvent'] = true
    System.EventFlags['cPlayer:TalkSkkCommuneOpenEvent'] = true
    System.EventFlags['cPlayer:SkkTalkBeforeFlag'] = true
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_Skk')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cSkk')
    SubflowResults[0] = 4
    run FeedOut()

flow Skk_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('skk', 1)

flow Slo_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:001', false)
    if System.EventFlags['cPlayer:ReijiTalkBeforeFlag']:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:002_01', false)
    else:
        SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:002', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:003', true)
    System.EventFlags['cPlayer:DoneCommuneSloOpenEvent'] = true
    System.EventFlags['cPlayer:TalkSloCommuneOpenEvent'] = true
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_Slo')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cSlo')
    SubflowResults[0] = 0
    run FeedOut()

flow Slo_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('slo', 1)

flow Ttl_ShopOpen():
    MainNpc.TurnBody(10, 180.0)
    SubNpc.TurnBody(10, 180.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:601', false)
    SubNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:602', false)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_12_Commune_ShopOpen:603', true)
    System.EventFlags['cPlayer:DoneCommuneTtlOpenEvent'] = true
    System.EventFlags['cPlayer:TalkTtlCommuneOpenEvent'] = true
    EventFlowSystemActor.SetMemoryEventLand('cBlancoEventLand:LE_CommuneShopBuilt_TtlA')
    EventFlowSystemActor.PlayReporterOpenCommuneShop('cTtl')
    SubflowResults[0] = 6
    run FeedOut()

flow Ttl_ShopOpen_Init():
    MainNpc.NpcAITalkSubCastEntry('ttl', 1)

