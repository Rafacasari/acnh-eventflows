flow About_MyHome_v200():
    if System.EventFlags['cPlayer:RcoMoveHouseReserved']:
        if System.EventFlags['cPlayer:PlayerMovingOrderHouseMoveInIsland']:
            if System.EventFlags['cPlayer:ReturnMyHomeMoving8000PMoving']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1005_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1005', false)
            System.EventFlags['cPlayer:RcoMoveHouseReserved'] = false
            System.EventFlags['cPlayer:PlayerMovingOrderHouseMoveInIsland'] = false
        else:
            run SNPC_rco_10_Common_MoveHouse::MoveMyHouseOngoing()
    elif System.EventFlags['cPlayer:RcoChangeHouseDesignReserved']:
        if System.EventFlags['cPlayer:PlayerMovingOrderChangeHouseDesign']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1001', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1002_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1003', false)
            System.EventFlags['cPlayer:PlayerMovingOrderChangeHouseDesign'] = false
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:010', false)
    elif System.EventFlags['cPlayer:RcoOrderedHouseBuilt']:
        if System.EventFlags['cPlayer:PlayerMovingOrderHouseBuilt']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1001', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1002', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1003', false)
            System.EventFlags['cPlayer:PlayerMovingOrderHouseBuilt'] = false
        else:
            switch EventFlowSystemActor.PlayerHouseLevel():
                case `PlacedTent`:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:261_01', false)
                case `BaseHouse`, `HouseExpansion1`, `BackRoom`, `LeftRoom`, `RightRoom`, `SecondFloor`, `Basement`:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:261', false)
                default:
                    return
    elif not System.EventFlags['cPlayer:RcoStorageExpansionReserved']:
        run RcoChkAboutMyHomeSel()
        switch SubflowResults@8[0]:
            case 0, 1, 2, 3, 4, 5:
                run NotOpenStorageExpansion()
            case 6:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1192', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        run SNPC_rco_10_Common_ExpandHouseStorage::Root()
                    case 1:
                        run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                    case 2:
                        run Rco_AboutMyHome_Cancel()
            case 7:
                if System.EventFlags['cPlayer:RcoTalkAboutMoveMyHome']:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1191', false)
                    switch EventFlowSystemActor.GeneralTalkChoice4():
                        case 0:
                            run SNPC_rco_10_Common_ExpandHouseStorage::Root()
                        case 1:
                            run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                        case 2:
                            run SNPC_rco_10_Common_MoveHouse::Root()
                        case 3:
                            run Rco_AboutMyHome_Cancel()
                else:
                    run RcoChkTalkAboutMoveMyHome()
    elif System.EventFlags['cPlayer:PlayerMovingReservedStorageExpand']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1001', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1021', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1003', false)
        System.EventFlags['cPlayer:PlayerMovingReservedStorageExpand'] = false
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1116', false)

flow ChkAboutStorageExpansion():
    if not System.EventFlags['cPlayer:RcoStorageExpansionLevel']:
        run SelEnable_ExpandStorage()
    elif EventFlowSystemActor.FlagSystemIntValue4(4, 'cPlayer:RcoStorageExpansion_v200_AddLevel') in (0, 1, 2):
        run SelEnable_ExpandStorage()
    elif EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
        SubflowResults[0] = 1
    else:
        SubflowResults[0] = 4

flow MoveOpen_NotOpenStorageExpansion():
    switch SubflowResults@6[0]:
        case 3:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:056', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run RcoCheckUpgradeMyHome()
                case 1:
                    run SNPC_rco_10_Common_MoveHouse::Root()
                case 2:
                    run Rco_AboutMyHome_Cancel()
        case 4:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:058', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                case 1:
                    run SNPC_rco_10_Common_MoveHouse::Root()
                case 2:
                    run Rco_AboutMyHome_Cancel()
        case 5:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:057', false)
            switch EventFlowSystemActor.GeneralTalkChoice4():
                case 0:
                    run RcoCheckUpgradeMyHome()
                case 1:
                    run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                case 2:
                    run SNPC_rco_10_Common_MoveHouse::Root()
                case 3:
                    run Rco_AboutMyHome_Cancel()
        default:
            return

flow NotOpenStorageExpansion():
    switch SubflowResults@6[0]:
        case 0:
            run RcoCheckUpgradeMyHome()
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:053', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run SNPC_rco_10_Common_ChangeHouseDesign::Root()
            else:
                run Rco_AboutMyHome_Cancel()
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:052', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0:
                    run RcoCheckUpgradeMyHome()
                case 1:
                    run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                case 2:
                    run Rco_AboutMyHome_Cancel()
        case 3:
            if System.EventFlags['cPlayer:RcoTalkAboutMoveMyHome']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:055', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        run RcoCheckUpgradeMyHome()
                    case 1:
                        run SNPC_rco_10_Common_MoveHouse::Root()
                    case 2:
                        run Rco_AboutMyHome_Cancel()
            else:
                run RcoChkTalkAboutMoveMyHome()
        case 4:
            if System.EventFlags['cPlayer:RcoTalkAboutMoveMyHome']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:051', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                    case 1:
                        run SNPC_rco_10_Common_MoveHouse::Root()
                    case 2:
                        run Rco_AboutMyHome_Cancel()
            else:
                run RcoChkTalkAboutMoveMyHome()
        case 5:
            if System.EventFlags['cPlayer:RcoTalkAboutMoveMyHome']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:054', false)
                switch EventFlowSystemActor.GeneralTalkChoice4():
                    case 0:
                        run RcoCheckUpgradeMyHome()
                    case 1:
                        run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                    case 2:
                        run SNPC_rco_10_Common_MoveHouse::Root()
                    case 3:
                        run Rco_AboutMyHome_Cancel()
            else:
                run RcoChkTalkAboutMoveMyHome()

flow RcoCheckUpgradeMyHome():
    if System.EventFlags['cPlayer:PlayerLoanRepaying']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:262', false)
    else:
        run SNPC_rco_10_Common_UpgradeMyhome::Root()

flow RcoChkAboutMyHomeSel():
    switch EventFlowSystemActor.PlayerHouseLevel():
        case `PlacedTent`:
            SubflowResults[0] = 0
        case `BaseHouse`, `HouseExpansion1`, `BackRoom`:
            if EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
                SubflowResults[0] = 0
            else:
                SubflowResults[0] = 3
        case `LeftRoom`, `RightRoom`, `SecondFloor`:
            if EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
                SubflowResults[0] = 2
            else:
                SubflowResults[0] = 5
        case `Basement`:
            run ChkAboutStorageExpansion()
        default:
            return

flow RcoChkTalkAboutMoveMyHome():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:012', false)
    System.EventFlags['cPlayer:RcoTalkAboutMoveMyHome'] = true
    switch SubflowResults@8[0]:
        case 0, 1, 2, 3, 4, 5:
            run MoveOpen_NotOpenStorageExpansion()
        case 7:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1193', false)
            switch EventFlowSystemActor.GeneralTalkChoice4():
                case 0:
                    run SNPC_rco_10_Common_ExpandHouseStorage::Root()
                case 1:
                    run SNPC_rco_10_Common_ChangeHouseDesign::Root()
                case 2:
                    run SNPC_rco_10_Common_MoveHouse::Root()
                case 3:
                    run Rco_AboutMyHome_Cancel()
        default:
            return

flow Rco_AboutMyHome_Cancel():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:101', false)
    if EventFlowSystemActor.OfficeLevel() == `ResServiceBuilding`:
        run SNPC_rco_00_Common::Rco_Office_CmnSelAgain()

flow Root():
    if EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
        run About_MyHome_v200()
    elif System.EventFlags['cPlayer:RcoCordinateNpcHouseSelEnable']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:1200', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                run About_MyHome_v200()
            case 1:
                run SNPC_rco_11_CoordinateNpcHouse_Office::Root()
            case 2:
                run Rco_AboutMyHome_Cancel()
    else:
        run About_MyHome_v200()

flow SelEnable_ExpandStorage():
    if EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
        SubflowResults[0] = 6
    else:
        SubflowResults[0] = 7

