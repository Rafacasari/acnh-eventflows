flow Spn_FirstJuneBride():
    System.EventFlags['cPlayer:SpnFirstTalkedAtCommuneIsland'] = true
    System.EventFlags['cPlayer:SpnTalkAtCommuneToday'] = true
    EventFlowSystemActor.CameraSetDemoParam('DemoJB_Cut1', 'cDefault', 'Npc:spn', false, false, false, 0)
    MainNpc.TurnBody(1, 0.0)
    Npc_1.TurnBody(0, 0.0)
    Npc_2.TurnBody(0, 0.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:000_01', false)
    fork:
        branch:
            Npc_1.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:000_02', false)
        branch:
            EventFlowSystemActor.WaitFrame(30)
            Npc_2.CharacterEmoticonAction('Worried', true, '', 0, false)
    EventFlowSystemActor.BGMPropertyControl(175)
    EventFlowSystemActor.WaitFrame(10)
    MainNpc.CharacterEmoticonAction('Shocked', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(15)
    MainNpc.TurnBody(10, 0.0)
    if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
        fork:
            branch:
                if System.EventFlags['cPlayer:StandByPhoneCallJuneBrideSpn']:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_00', false)
            branch:
                EventFlowSystemActor@alw.WaitFrame(10)
                Npc_1.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor.WaitFrame(10)
                Npc_2.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor@poo.WaitFrame(10)
                Npc_3.TurnBody(10, 0.0)
        fork:
            branch:
                MainNpc.TurnBody(1, 0.0)
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_01', false)
            branch:
                EventFlowSystemActor.WaitFrame(10)
                Npc_1.CharacterEmoticonAction('Greeting', true, '', 0, false)
            branch:
                Player.TurnBody(1, 0.0)
            branch:
                EventFlowSystemActor@BGM.WaitFrame(30)
                EventFlowSystemActor@BGM.BGMPropertyControl(91)
            branch:
                Npc_3.TurnBody(1, 0.0)
        fork:
            branch:
                MainNpc.TurnBody(2, 0.0)
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_02', false)
            branch:
                EventFlowSystemActor.WaitFrame(10)
                Npc_2.CharacterEmoticonAction('Greeting', true, '', 0, false)
            branch:
                Player.TurnBody(2, 0.0)
            branch:
                Npc_3.TurnBody(2, 0.0)
        fork:
            branch:
                MainNpc.TurnBody(10, 0.0)
            branch:
                Npc_3.TurnBody(10, 0.0)
        run Sub_grp_Event52()
    else:
        fork:
            branch:
                if System.EventFlags['cPlayer:StandByPhoneCallJuneBrideSpn']:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_00', false)
            branch:
                EventFlowSystemActor@alw.WaitFrame(10)
                Npc_1.TurnBody(10, 0.0)
            branch:
                EventFlowSystemActor.WaitFrame(10)
                Npc_2.TurnBody(10, 0.0)
        fork:
            branch:
                MainNpc.TurnBody(1, 0.0)
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_01', false)
            branch:
                EventFlowSystemActor.WaitFrame(10)
                Npc_1.CharacterEmoticonAction('Greeting', true, '', 0, false)
            branch:
                Player.TurnBody(1, 0.0)
            branch:
                EventFlowSystemActor@BGM.WaitFrame(30)
                EventFlowSystemActor@BGM.BGMPropertyControl(91)
        fork:
            branch:
                MainNpc.TurnBody(2, 0.0)
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_02', false)
            branch:
                EventFlowSystemActor.WaitFrame(10)
                Npc_2.CharacterEmoticonAction('Greeting', true, '', 0, false)
            branch:
                Player.TurnBody(2, 0.0)
        MainNpc.TurnBody(10, 0.0)
        run Sub_grp_Event52()

flow Spn_FirstJuneBride_Init():
    if (EventFlowSystemActor.TermEventNow('JuneBride', false)) and (System.EventFlags['cPlayer:CommuneIslandAvailable']) and (not System.EventFlags['cPlayer:SpnJuneBrideTalkEventFrag']):
        MainNpc.NpcAITalkSubCastEntry('alw', 1)
        MainNpc.NpcAITalkSubCastEntry('alp', 2)
        if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
            MainNpc.NpcAITalkSubCastEntry('pooB', 3)

local flow Sub_Event60():
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.MessageSuspend()
    System.EventFlags['cPlayer:SpnExpandEventAfterJuneBride'] = true
    EventFlowSystemActor.SystemRequestChangeStage('cFirstJuneBrideStudio', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)

local flow Sub_grp_Event52():
    fork:
        branch:
            Player.TurnBody(0, 0.0)
        branch:
            Npc_1.TurnNeck(2, false)
            Npc_1.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
        branch:
            Npc_2.TurnNeck(1, false)
            Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
    if System.EventFlags['cPlayer:AlwJuneBrideDayAlreadyCount'] < 1:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_03', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:029', false)
    fork:
        branch:
            if System.EventFlags['cPlayer:AlwJuneBrideDayAlreadyCount'] < 1:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:002', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:030', false)
        branch:
            Npc_1.TurnBody(10, 0.0)
            Npc_1.CharacterEmoticonAction('EmotEnd', true, '', 0, true)
        branch:
            Npc_2.TurnBody(10, 0.0)
            Npc_2.CharacterEmoticonAction('EmotEnd', true, '', 0, true)
    switch EventFlowSystemActor.GeneralTalkChoice2():
        case 0, 1:
            if System.EventFlags['cLand:CompleteCommuneExpandEvent']:
                fork:
                    branch:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:003', true)
                    branch:
                        Npc_1.CharacterEmoticonAction('Smiling', true, '', 0, true)
                    branch:
                        Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
                    branch:
                        Npc_3.CharacterEmoticonAction('Smiling', true, '', 0, true)
                run Sub_Event60()
            else:
                fork:
                    branch:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:003', true)
                    branch:
                        Npc_1.CharacterEmoticonAction('Smiling', true, '', 0, true)
                    branch:
                        Npc_2.CharacterEmoticonAction('FaintSmile', true, '', 0, true)
                run Sub_Event60()

