flow AboutBuildMuseumTent_Force():
    run RcoTent_Force_PlayerPos()
    System.EventFlags['cPlayerTemp:RcoTalkSceneFlag'] = true
    run RcoTentAboutBuildMuseumTent()

flow AboutBuildMuseumTent_Force_Init():
    run RcoTent_Force_DisableTalkCamera()

flow CancelRemakeTrial():
    DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:102', false)
    System.EventFlags['cPlayerTemp:RcoAccessWorkingTable'] = false

flow DoRemakeTrial(ItemPrice: int = 0):
    DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:103', true)
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
    EventFlowSystemActor.WaitFrame(45)
    EventFlowSystemActor.FadeIn(true)
    DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:201', false)
    DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:202', false)
    if System.EventFlags['cPlayer:UseCloset']:
        DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:203_01', false)
    else:
        DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:203_02', false)
    DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:204', false)
    if not EventFlowSystemActor.PlayerHasCraftRecipe('', 3436):
        DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:205_01', true)
        run Demo_Common_PhoneCall::SendingDataOneWay_DynamicJoin()
        DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:205_02', false)
        EventFlowSystemActor.PlayerSetCraftRecipe('', 3436)
        DynamicCast_rco.SmartPhone(1)
    DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:206', false)
    System.EventFlags['cPlayer:RcoRemakeTrialOngoing'] = true
    System.EventFlags['cPlayerTemp:RcoAccessWorkingTable'] = false
    EventFlowSystemActor.ExitFlowchart()

flow RcoAskRemakeTrial(ItemPrice: int = 0):
    EventFlowSystemActor.NpcEventItemSet(3436, 'cTalk', 0, ItemPrice)
    DynamicCast_rco.RcoStandUpChair()
    if not System.EventFlags['cPlayer:RcoRemakeTrialOngoing']:
        DynamicCast_rco.NpcWaitTalkPrepare()
        DynamicCast_rco.TurnBody(10, 0.0)
        DynamicCast_rco.NpcWaitTurn()
        System.EventFlags['cPlayer:RcoTalkAboutRemakeTrial'] = false
        System.EventFlags['cPlayer:RcoHeardInviteRemakeWS'] = true
        fork:
            branch:
                if System.EventFlags['cPlayerTemp:RcoAccessWorkingTable']:
                    Player.PlayerChangeStateDemoTalk()
                    Player.TurnBody(0, 0.0)
            branch:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:101', false)
        switch EventFlowSystemActor.GeneralTalkChoice3():
            case 0:
                run DoRemakeTrial(ItemPrice=ItemPrice)
            case 1:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:104', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run DoRemakeTrial()
                else:
                    run CancelRemakeTrial()
            case 2:
                run CancelRemakeTrial()
    elif EventFlowSystemActor.HasTargetItem(3436, 1):
        if System.EventFlags['cPlayer:RcoRemakeTrialGetFurniture']:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:111', false)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:115', false)
        else:
            System.EventFlags['cPlayer:RcoRemakeTrialGetFurniture'] = true
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:113', false)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:114_01', false)
        if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:114_02', false)
            System.EventFlags['cPlayer:RemakeWs_TalkWhenItemFull'] = true
        else:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:116', false)
    else:
        DynamicCast_rco.NpcWaitTalkPrepare()
        DynamicCast_rco.TurnBody(10, 0.0)
        DynamicCast_rco.NpcWaitTurn()
        fork:
            branch:
                if System.EventFlags['cPlayerTemp:RcoAccessWorkingTable']:
                    Player.PlayerChangeStateDemoTalk()
                    Player.TurnBody(0, 0.0)
            branch:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:111', false)
        DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:112', false)
        System.EventFlags['cPlayerTemp:RcoAccessWorkingTable'] = false

flow RcoDIYongoing():
    if not EventFlowSystemActor.HasTargetItem(2500, 5):
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:911', false)
    elif System.EventFlags['cPlayer:RcoDIYtrialGetMaterial']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:207', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:921', true)
        System.EventFlags['cPlayer:RcoDIYtrialGetMaterial'] = true

flow RcoRemakeTrialIntro():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:000', false)
    if (System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']) and (System.EventFlags['cPlayer:EnableDiyRemake']):
        if System.EventFlags['cPlayer:PAnnouceHeardRemakeWsNewsToday']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:011', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:011_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:012', false)
        if ((System.EventFlags['cPlayer:RemakeWithRcoOfficeBeforeWS']) and (EventFlowSystemActor.SystemCheckNowStage('cIdrOffice'))) or ((System.EventFlags['cPlayer:RemakeWithRcoTentBeforeWS']) and (EventFlowSystemActor.SystemCheckNowStage('cIdrTanukichi'))):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:013_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:014', false)
        System.EventFlags['cPlayer:RcoTalkAboutRemakeTrial'] = false
        System.EventFlags['cPlayer:RcoHeardInviteRemakeWS'] = true
        EventFlowSystemActor.SelectRewardItemDirect(2513, 50, 'cVillageRemakePattern', 0)
        EventFlowSystemActor.SystemMailSend('cRco', 'MAIL_SNpc_rco', 9, 'cNone', 'cFastTomorrow', 'cReward', false, false)
    else:
        if System.EventFlags['cPlayer:WHEREAREN_RcoHeardRemakeWS']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:001_03', false)
        else:
            if System.EventFlags['cPlayer:PAnnouceHeardRemakeWsNewsToday']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:001_01', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:001_02', false)
        System.EventFlags['cPlayer:RcoEnableRemakeTrial'] = true
        System.EventFlags['cPlayer:RcoTalkAboutRemakeTrial'] = false
        System.EventFlags['cPlayer:RcoHeardInviteRemakeWS'] = true

flow RcoRemakeTrialIntro_Force():
    run RcoTent_Force_PlayerPos()
    System.EventFlags['cPlayerTemp:RcoTalkSceneFlag'] = true
    run RcoRemakeTrialIntro()

flow RcoRemakeTrialIntro_Force_Init():
    run RcoTent_Force_DisableTalkCamera()

flow RcoTentAboutBuildMuseumTent():
    System.EventFlags['cPlayer:RcoTalkAfterMuseumTent'] = false
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:016', false)
    switch EventFlowSystemActor.GeneralTalkChoice2():
        case 0, 1:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:017', false)
            if not System.EventFlags['cPlayer:RcoPaid1stCharge']:
                if System.EventFlags['cLand:TodayStartTown1P']:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:018_01', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:018_02', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:019', false)

flow RcoTentAboutMyhome():
    if (System.EventFlags['cPlayer:PlayerProducedByPlayerMoving']) and (System.EventFlags['cPlayer:NotBuilt2PMyHomeAfterMoving']):
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:410', false)
    elif System.EventFlags['cPlayer:RcoPaid1stCharge']:
        run SNPC_rco_10_Common_AboutMyHome::Root()
    elif EventFlowSystemActor.PlayerHouseLevel() == `Homeless`:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:400', false)
    else:
        EventFlowSystemActor.UISonkatsuPointAppear()
        EventFlowSystemActor.SetTagFromSystem('cFlow', 'cDegit', 0, 5000, '')
        if EventFlowSystemActor.HasLifeSupportPoint(5000, 'Now'):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:402', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:404', false)
                EventFlowSystemActor.LifeSupportPointCountDown(-5000, false)
                System.EventFlags['cPlayer:RcoPaid1stCharge'] = true
                System.EventFlags['cLifeSupportAchievement:PayImmigrationCost'] += 1
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:405', false)
                EventFlowSystemActor.UISonkatsuPointDisappear()
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:406', false)
                switch EventFlowSystemActor.GeneralTalkChoice3():
                    case 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_01', false)
                    case 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_02', false)
                    case 2:
                        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_03', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_05', false)
                if System.EventFlags['cLand:RcmImmQuestComplete']:
                    System.EventFlags['cPlayer:ObjRcoMachineHeardFenceRecipe'] = true
                if System.EventFlags['cLand:OpeningSeqBGMChangeCounter'] <= 8:
                    System.EventFlags['cLand:OpeningSeqBGMChangeCounter'] = 8
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:403', false)
                EventFlowSystemActor.UISonkatsuPointDisappear()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:401', false)
            EventFlowSystemActor.UISonkatsuPointDisappear()

flow RcoTentAskDIYtrial():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:201', false)
    switch EventFlowSystemActor.GeneralTalkChoice3():
        case 0:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:204', true)
            EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
            EventFlowSystemActor.WaitFrame(45)
            EventFlowSystemActor.FadeIn(true)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:205', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:206', false)
            System.EventFlags['cPlayer:RcoHeardDetailDIYtrial'] = true
            System.EventFlags['cPlayer:RcoDIYtrialOngoing'] = true
        case 1:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:202', false)
        case 2:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:203', false)

flow RcoTentFishInsect(MultiComplete: bool = false, CompleteRoomType: int = 0):
    if System.EventFlags['cPlayer:RcoTentDonation']:
        if System.EventFlags['cPlayerTemp:RcoDonationNow']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:001_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:001_02', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:001_01', false)
    EventFlowSystemActor.UIItemSelectWindowHandling('cItemFilter', 65534, '', 'RcoDonationForMuseum', 'cItemSelect', false)
    if EventFlowSystemActor.UIResultMenuDecide():
        MainNpc.SetDeliveryItem(4, false)
        EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
        MainNpc.NpcDelivery(0, 'Keep')
        if MainNpc.OwlIsDonation('cUISelect'):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:003_01', false)
            MainNpc.NpcDelivery(10, 'Default')
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:004', false)
            if System.EventFlags['cPlayer:RcoTentDonation']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:005_03', false)
            else:
                if System.EventFlags['cPlayer:RcoTentDonatinDeclined']:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:005_02', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:005_01', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OwlDonationDone(MultiComplete, CompleteRoomType)
                if EventFlowSystemActor.MuseumDonationNumCheck(5):
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:006_01', true)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:006_01', false)
                MainNpc.NpcDelivery(3, 'Default')
                System.EventFlags['cPlayer:RcoTentDonation'] = true
                System.EventFlags['cPlayerTemp:RcoDonationNow'] = true
                run SNPC_rco_51_DonationReward::Root()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:010', false)
                MainNpc.NpcDelivery(10, 'Default')
                System.EventFlags['cPlayer:RcoTentDonatinDeclined'] = true
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:002', false)

flow RcoTentImmQuestIntroNotForce():
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:000_01', false)
    run Demo_Common_PhoneCall::CallIn()
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:000_02', false)
entrypoint Event7:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:001', true)
    run Demo_Common_PhoneCall::FinishCall()
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:002', false)
    switch EventFlowSystemActor.GeneralTalkChoice2():
        case 0, 1:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:003', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:004', true)
            EventFlowSystemActor.WaitFrame(10)
            MainNpc.CharacterEmoticonAction('Sighing', false, '', 0, false)
            EventFlowSystemActor.WaitFrame(70)
            MainNpc.CharacterEmoticonAction('Shocked', false, '', 0, false)
            EventFlowSystemActor.WaitFrame(30)
            MainNpc.CharacterEmoticonAction('IdeaBulb', false, '', 0, false)
            EventFlowSystemActor.WaitFrame(30)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:005', false)
            switch EventFlowSystemActor.GeneralTalkChoice3():
                case 0, 1, 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:006', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:007', false)
                    System.EventFlags['cPlayer:ImmQRunningForPlayer'] = true
                    System.EventFlags['cLand:RcmImmQuestRunning'] = true
                    System.EventFlags['cPlayer:RcoImmQClear1QuestToday'] = true

flow RcoTentImmQuestIntro_Force():
    run RcoTent_Force_PlayerPos()
    System.EventFlags['cPlayerTemp:RcoTalkSceneFlag'] = true
    run Event7()

flow RcoTentImmQuestIntro_Force_Init():
    run RcoTent_Force_DisableTalkCamera()

flow RcoTentWhatShoudIdo():
    run SNPC_rco_10_Common_WhatShouldIDo::Root()

flow RcoTent_Force_DisableTalkCamera():
    if EventFlowSystemActor.SystemCheckNowStage('cIdrTanukichi'):
        MainNpc.NpcAISetting(4, false)

flow RcoTent_Force_PlayerPos():
    if EventFlowSystemActor.SystemCheckNowStage('cIdrTanukichi'):
        Player.PlayerMoveToTarget(false, 157.0, 170.0, 0.0, 0.0, false, '')
        MainNpc.TalkCamera(true, 'cTalk', 0)

