flow DIY_AfterItemGet():
    MainNpc.EventFlags['cNpcMemory:GotRecipeorMaterial'] = true
    System.EventFlags['cPlayerTemp:GotRecipeorMaterial'] = true
    MainNpc.EventFlags['cNpcMemory:TalkDIY'] = true
    MainNpc.AddMemoryEventPlayerForNpc('Present_FromNNPC')
    EventFlowSystemActor.ExitFlowchart()

flow DIY_GetItem():
    if MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] == 1:
        EventFlowSystemActor.SelectRewardItemDirect(4525, 5, 'cVillageRemakePattern', 0)
        run Sub_Event42()
    elif MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] == 2:
        EventFlowSystemActor.SelectRewardItemDirect(13197, 1, 'cVillageRemakePattern', 0)
        run Sub_Event42()

flow DIY_GetItem_Ornament():
    if MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] == 3:
        EventFlowSystemActor.SelectRewardItemDirect(5732, 3, 'cVillageRemakePattern', 0)
        run Sub_Event22()
    elif MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] == 4:
        EventFlowSystemActor.SelectRewardItemDirect(5731, 3, 'cVillageRemakePattern', 0)
        run Sub_Event22()
    elif MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] == 5:
        EventFlowSystemActor.SelectRewardItemDirect(5730, 3, 'cVillageRemakePattern', 0)
        run Sub_Event22()

flow DIY_Item_Full():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:010', false)
    MainNpc.EventFlags['cNpcMemory:GotMaterialItemFull'] = true
    EventFlowSystemActor.ExitFlowchart()

flow DIY_Ornament():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:040', false)
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:041', false)
    if EventFlowSystemActor.PercentChoice(25):
        MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] = 3
        EventFlowSystemActor.SelectRewardItemDirect(5732, 3, 'cVillageRemakePattern', 0)
    else:
        if EventFlowSystemActor.RandomChoice2(2) == 0:
            MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] = 4
            EventFlowSystemActor.SelectRewardItemDirect(5731, 3, 'cVillageRemakePattern', 0)
        else:
            MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] = 5
            EventFlowSystemActor.SelectRewardItemDirect(5730, 3, 'cVillageRemakePattern', 0)
entrypoint Event85:
    MainNpc.SetDeliveryItem(1, true)
    if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 65534):
        MainNpc.MessageSuspend()
        MainNpc.NpcDelivery(1, 'Default')
        MainNpc.SetItemName(1, 0, 1)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:042', false)
        run DIY_AfterItemGet()
    else:
        run DIY_Item_Full()

flow DIY_PumpkinFtr():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:033', false)
    if EventFlowSystemActor.PercentChoice(70):
        MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] = 1
        EventFlowSystemActor.SelectRewardItemDirect(4525, 5, 'cVillageRemakePattern', 0)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:034', false)
    else:
        MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] = 2
        EventFlowSystemActor.SelectRewardItemDirect(13197, 1, 'cVillageRemakePattern', 0)
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:036', false)
entrypoint Event23:
    MainNpc.SetDeliveryItem(1, true)
    if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 65534):
        EventFlowSystemActor.MessageSuspend()
        MainNpc.NpcDelivery(1, 'Default')
        if MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] != 1:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:037', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:035', false)
        run DIY_AfterItemGet()
    else:
        run DIY_Item_Full()

flow Root():
    if MainNpc.IsInTheActOfDIY():
        run NNPC_FreeH_Progress::Conceal_NpcHouseBuilt()
        MainNpc.SetItemName(16, 0, 0)
        if not MainNpc.EventFlags['cNpcMemory:GotRecipeorMaterial']:
            if MainNpc.EventFlags['cNpcMemory:GotMaterialItemFull']:
                run DIY_GetItem()
                run DIY_GetItem_Ornament()
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:021', false)
                run Sub_Event51()
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:001', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:002', false)
                    if MainNpc.IsNpcDIYRecipeCollected():
                        if MainNpc.IsDIYHalloweenItem():
                            run DIY_PumpkinFtr()
                        else:
                            if MainNpc.IsDIYOrnamentItem():
                                run DIY_Ornament()
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:008', false)
                        switch EventFlowSystemActor.GeneralTalkChoice2():
                            case 0, 1:
                                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:009', false)
                                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:019', false)
                                run Sub_Event51()
                    else:
                        MainNpc.EventFlags['cNpcMemory:HalloweenDIYGetItem'] = 0
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:003', false)
                        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:017', false)
                            run Sub_Event51()
                        else:
                            run Sub_Event65()
                else:
                    run Sub_Event65()

local flow Sub_Event22():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:043', false)
    run Event85()

local flow Sub_Event42():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:032', false)
    run Event23()

local flow Sub_Event51():
    MainNpc.NpcSetRewardRecipe(65534, true)
    MainNpc.SetDeliveryItem(1, true)
    if EventFlowSystemActor.ShoppingCapacity('cNpcTrade', 65534):
        EventFlowSystemActor.MessageSuspend()
        MainNpc.NpcDelivery(1, 'Default')
        if MainNpc.IsDIYHalloweenItem():
            if (EventFlowSystemActor.RandomChoice2(2) != 0) and (not MainNpc.IsDIYItemFenceHalloween()) and (System.EventFlags['cPlayer:EnableDiyRemake']):
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:031', false)
                run DIY_AfterItemGet()
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:030', false)
                run DIY_AfterItemGet()
        elif MainNpc.IsNpcDIYRecipeCollected():
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:020', false)
            run DIY_AfterItemGet()
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:018', false)
            run DIY_AfterItemGet()
    else:
        run DIY_Item_Full()

local flow Sub_Event65():
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/React/BO_React_DIY:007', false)
    EventFlowSystemActor.ExitFlowchart()

