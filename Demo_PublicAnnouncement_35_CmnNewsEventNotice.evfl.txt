flow EvNotice_Carnival():
    System.EventFlags['cPlayer:PublicAnnoucement_EvNotice_Carnival'] = true
    EventFlowSystemActor.SetTagFromSystem('cCarnivalMonth', 'cDegit', 0, 0, '')
    EventFlowSystemActor.SetTagFromSystem('cCarnivalDay', 'cDegit', 1, 0, '')
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'Carnival', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_11_04', false)
    elif EventFlowSystemActor.CheckNearEvent(2, 2, 'Carnival', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_11_03', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_11_02', false)

flow EvNotice_Fireworks():
    System.EventFlags['cPlayer:PAnnounceFireWorksEvNotice'] = true
    if SubflowResults@2[0] == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:047', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_06_13', false)

flow EvNotice_Fishing():
    if System.EventFlags['cLand:FishFesFinished']:
        switch EventFlowSystemActor.EnvMonth():
            case `January`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Jan'] = true
                if EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
                    run EvNotice_Fishing_Winter()
                else:
                    run EvNotice_Fishing_Summer()
            case `April`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Apr'] = true
                if EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
                    run EvNotice_Fishing_Spring()
                else:
                    run EvNotice_Fishing_Autumn()
            case `July`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Jul'] = true
                if EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
                    run EvNotice_Fishing_Summer()
                else:
                    run EvNotice_Fishing_Winter()
            case `October`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Oct'] = true
                if EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
                    run EvNotice_Fishing_Autumn()
                else:
                    run EvNotice_Fishing_Spring()
            default:
                return
    else:
        if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_10', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_09', false)
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13', false)
        switch EventFlowSystemActor.EnvMonth():
            case `January`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Jan'] = true
            case `April`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Apr'] = true
            case `July`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Jul'] = true
            case `October`:
                System.EventFlags['cPlayer:PAnnounceFishingEvNotice_Oct'] = true
            default:
                return

flow EvNotice_Fishing_Autumn():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_06', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_05', false)
    run Sub_Event98()

flow EvNotice_Fishing_Spring():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_02', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_01', false)
    run Sub_Event98()

flow EvNotice_Fishing_Summer():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_04', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_03', false)
    run Sub_Event98()

flow EvNotice_Fishing_Winter():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_08', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13_07', false)
    run Sub_Event98()

flow EvNotice_Insect():
    run EvNotice_Insect_FlagSet()
    if not System.EventFlags['cLand:InsectFesFinished']:
        if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_08', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_07', false)
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14', false)
    elif EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
        switch EventFlowSystemActor.EnvMonth():
            case `June`:
                run EvNotice_Insect_1st()
            case `July`, `August`:
                run EvNotice_Insect_2nd3rd()
            case `September`:
                run EvNotice_Insect_Last()
            default:
                return
    else:
        switch EventFlowSystemActor.EnvMonth():
            case `January`:
                run EvNotice_Insect_2nd3rd()
            case `February`:
                run EvNotice_Insect_Last()
            case `November`:
                run EvNotice_Insect_1st()
            case `December`:
                run EvNotice_Insect_2nd3rd()
            default:
                return

flow EvNotice_Insect_1st():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_02', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_01', false)
    run Sub_Event137()

flow EvNotice_Insect_2nd3rd():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_04', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_03', false)
    run Sub_Event137()

flow EvNotice_Insect_FlagSet():
    if EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
        switch EventFlowSystemActor.EnvMonth():
            case `June`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_1'] = true
            case `July`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_2'] = true
            case `August`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_3'] = true
            case `September`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_4'] = true
            default:
                return
    else:
        switch EventFlowSystemActor.EnvMonth():
            case `January`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_3'] = true
            case `February`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_4'] = true
            case `November`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_1'] = true
            case `December`:
                System.EventFlags['cPlayer:PAnnounceInsectEvNotice_2'] = true
            default:
                return

flow EvNotice_Insect_Last():
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'FishingConvention', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_06', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14_05', false)
    run Sub_Event137()

flow EvNotice_Mayday():
    System.EventFlags['cPlayer:PAnnounceMayDayTour'] = true
    if SubflowResults@2[0] == 0:
        if EventFlowSystemActor.EnvCheckBetweenDate(4, 29, 4, 29, 'cGrowUpTime'):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:042_01', false)
        elif EventFlowSystemActor.EnvCheckBetweenDate(5, 1, 5, 1, 'cNowTime'):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:042_02', false)
    elif EventFlowSystemActor.EnvCheckBetweenDate(4, 29, 4, 29, 'cGrowUpTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_02_01', false)
    elif EventFlowSystemActor.EnvCheckBetweenDate(5, 1, 5, 1, 'cNowTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_02_02', false)
    elif EventFlowSystemActor.EnvCheckBetweenDate(5, 7, 5, 7, 'cNowTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_02_04', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_02_03', false)

flow EvNotice_Museum():
    System.EventFlags['cPlayer:PAnnounceStampRally'] = true
    if SubflowResults@2[0] == 0:
        if EventFlowSystemActor.EnvSameDate('cInternationalMuseum', 'cGrowUpTime'):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:045_01', false)
        elif EventFlowSystemActor.EnvSameDate('cEndOfTheMonth', 'cGrowUpTime'):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:045_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:045_02', false)
    elif EventFlowSystemActor.EnvSameDate('cInternationalMuseum', 'cGrowUpTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_05_01', false)
    elif EventFlowSystemActor.EnvSameDate('cEndOfTheMonth', 'cGrowUpTime'):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_05_03', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_05_02', false)

flow EvNotice_NewyearEve():
    System.EventFlags['cPlayer:PAnnounceCountdownEvNotice'] = true
    if EventFlowSystemActor.CheckNearEvent(1, 1, 'Countdown', false):
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_12_02', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_12_01', false)

flow EvNotice_ThanksGiving():
    EventFlowSystemActor.SetTagFromSystem('cHarvestFestivalDay', 'cDegit', 0, 0, '')
    if EventFlowSystemActor.EnvWeatherArea() == `cWeatherArea_North`:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_11', false)
        if EventFlowSystemActor.CheckNearEvent(1, 1, 'HarvestFestival', false):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_15', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_13', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_12', false)
        if EventFlowSystemActor.CheckNearEvent(1, 1, 'HarvestFestival', false):
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_16', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_14', false)
    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_09_17', false)
    System.EventFlags['cPlayer:AnnounceBeforeHarvest'] = true

flow Root():
    if SubflowResults@4[4] == 0:
        if SubflowResults@2[0] == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:500_02', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:009_02', false)
    else:
        if SubflowResults@2[0] == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_00_Rco:500_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:009_01', false)
    SubflowResults[4] = 1
    switch SubflowResults@8[16]:
        case 1:
            run EvNotice_Museum()
        case 2:
            run EvNotice_Fireworks()
        case 3:
            run EvNotice_Fishing()
        case 4:
            run EvNotice_Insect()
        case 5:
            run EvNotice_NewyearEve()
        case 6:
            run EvNotice_Carnival()
        case 7:
            run EvNotice_ThanksGiving()
        default:
            return

local flow Sub_Event137():
    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_14', false)

local flow Sub_Event98():
    MainNpc.OpenMessageWindow('TalkSNpc/PublicAnnouncement/SP_PublicAnnouncement_01_Sza:008_13', false)

